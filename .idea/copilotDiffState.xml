<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/src/main/java/com/smat/ins/view/bean/TaskSearchBean.java">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/java/com/smat/ins/view/bean/TaskSearchBean.java" />
              <option name="originalContent" value="package com.smat.ins.view.bean;&#10;&#10;import java.io.Serializable;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;import java.util.Set;&#10;import java.util.Map;&#10;import java.util.LinkedHashMap;&#10;import java.util.HashMap;&#10;&#10;import javax.annotation.PostConstruct;&#10;import javax.faces.view.ViewScoped;&#10;import javax.inject.Inject;&#10;import javax.inject.Named;&#10;&#10;import com.smat.ins.model.entity.Company;&#10;import com.smat.ins.model.entity.EmpCertification;&#10;import com.smat.ins.model.entity.EquipmentCategory;&#10;import com.smat.ins.model.entity.EquipmentInspectionForm;&#10;import com.smat.ins.model.entity.InspectionFormWorkflow;&#10;import com.smat.ins.model.entity.ServiceType;&#10;import com.smat.ins.model.entity.Task;&#10;import com.smat.ins.model.entity.UserAlias;&#10;import com.smat.ins.model.service.CompanyService;&#10;import com.smat.ins.model.service.EmpCertificationService;&#10;import com.smat.ins.model.service.EquipmentCategoryService;&#10;import com.smat.ins.model.service.EquipmentInspectionFormService;&#10;import com.smat.ins.model.service.ServiceTypeService;&#10;import com.smat.ins.model.service.TaskService;&#10;import com.smat.ins.model.service.UserAliasService;&#10;import com.smat.ins.util.BeanUtility;&#10;import org.apache.poi.ss.usermodel.*;&#10;import org.apache.poi.xssf.usermodel.XSSFWorkbook;&#10;import javax.faces.context.FacesContext;&#10;import javax.servlet.http.HttpServletResponse;&#10;import java.io.ByteArrayOutputStream;&#10;import java.io.IOException;&#10;import java.text.SimpleDateFormat;&#10;import java.util.Date;&#10;import java.util.List;&#10;&#10;&#10;@Named&#10;@ViewScoped&#10;public class TaskSearchBean implements Serializable {&#10;&#10;    private static final long serialVersionUID = 1L;&#10;&#10;    // Search criteria fields&#10;    private String taskDescription;&#10;    private Boolean isCompleted;&#10;    private Boolean isDone;&#10;    private Date fromDate;&#10;    private Date toDate;&#10;    private UserAlias assignee;&#10;&#10;    // New search criteria fields&#10;    private Company company;&#10;    private EquipmentCategory equipmentCategory;&#10;    private ServiceType serviceType;&#10;    private UserAlias assigner;&#10;    private Date completedFromDate;&#10;    private Date completedToDate;&#10;    private Date doneFromDate;&#10;    private Date doneToDate;&#10;    private String taskStatus; // Combined status filter&#10;    private String workOrderFilter; // search by work order / correspondence id or jobNo&#10;&#10;    // Results&#10;    private List&lt;Task&gt; searchResults = new ArrayList&lt;&gt;();&#10;    // cached grouped results by work order (computed on demand)&#10;    private Map&lt;String, List&lt;Task&gt;&gt; groupedResultsByWorkOrder;&#10;    private List&lt;UserAlias&gt; userAliasList = new ArrayList&lt;&gt;();&#10;    private List&lt;Company&gt; companyList = new ArrayList&lt;&gt;();&#10;    private List&lt;EquipmentCategory&gt; equipmentCategoryList = new ArrayList&lt;&gt;();&#10;    private List&lt;ServiceType&gt; serviceTypeList = new ArrayList&lt;&gt;();&#10;&#10;    // Services&#10;    private TaskService taskService;&#10;    private UserAliasService userAliasService;&#10;    private CompanyService companyService;&#10;    private EquipmentCategoryService equipmentCategoryService;&#10;    private ServiceTypeService serviceTypeService;&#10;    private EquipmentInspectionFormService equipmentInspectionFormService;&#10;    private EmpCertificationService empCertificationService;&#10;&#10;    @Inject&#10;    private LoginBean loginBean;&#10;&#10;    @PostConstruct&#10;    public void init() {&#10;        taskService = (TaskService) BeanUtility.getBean(&quot;taskService&quot;);&#10;        userAliasService = (UserAliasService) BeanUtility.getBean(&quot;userAliasService&quot;);&#10;        companyService = (CompanyService) BeanUtility.getBean(&quot;companyService&quot;);&#10;        equipmentCategoryService = (EquipmentCategoryService) BeanUtility.getBean(&quot;equipmentCategoryService&quot;);&#10;        serviceTypeService = (ServiceTypeService) BeanUtility.getBean(&quot;serviceTypeService&quot;);&#10;        equipmentInspectionFormService = (EquipmentInspectionFormService) BeanUtility&#10;                .getBean(&quot;equipmentInspectionFormService&quot;);&#10;        empCertificationService = (EmpCertificationService) BeanUtility.getBean(&quot;empCertificationService&quot;);&#10;        try {&#10;            userAliasList = userAliasService.findAll();&#10;            companyList = companyService.findAll();&#10;            equipmentCategoryList = equipmentCategoryService.findAll();&#10;            serviceTypeList = serviceTypeService.findAll();&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void searchTasks() {&#10;        try {&#10;            // Get all tasks first (you might want to implement more specific search methods&#10;            // in TaskService)&#10;            searchResults = taskService.findAll();&#10;&#10;            // Apply filters in memory (or better, implement these filters in your DAO)&#10;            if (taskDescription != null &amp;&amp; !taskDescription.isEmpty()) {&#10;                searchResults.removeIf(task -&gt; task.getTaskDescription() == null&#10;                        || !task.getTaskDescription().toLowerCase().contains(taskDescription.toLowerCase()));&#10;            }&#10;&#10;            if (isCompleted != null) {&#10;                searchResults.removeIf(task -&gt; !isCompleted.equals(task.getIsCompleted()));&#10;            }&#10;&#10;            if (isDone != null) {&#10;                searchResults.removeIf(task -&gt; !isDone.equals(task.getIsDone()));&#10;            }&#10;&#10;            if (fromDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().before(fromDate));&#10;            }&#10;&#10;            if (toDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().after(toDate));&#10;            }&#10;&#10;            if (assignee != null) {&#10;                searchResults.removeIf(task -&gt; task.getUserAliasByAssignTo() == null&#10;                        || !assignee.getId().equals(task.getUserAliasByAssignTo().getId()));&#10;            }&#10;&#10;            // New filters&#10;            if (company != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompany() == null || !company.getId().equals(task.getCompany().getId()));&#10;            }&#10;&#10;            if (equipmentCategory != null) {&#10;                searchResults.removeIf(task -&gt; task.getEquipmentCategory() == null&#10;                        || !equipmentCategory.getId().equals(task.getEquipmentCategory().getId()));&#10;            }&#10;&#10;            if (serviceType != null) {&#10;                searchResults.removeIf(task -&gt; task.getServiceType() == null&#10;                        || !serviceType.getId().equals(task.getServiceType().getId()));&#10;            }&#10;&#10;            if (assigner != null) {&#10;                searchResults.removeIf(task -&gt; task.getUserAliasByAssigner() == null&#10;                        || !assigner.getId().equals(task.getUserAliasByAssigner().getId()));&#10;            }&#10;&#10;            if (completedFromDate != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().before(completedFromDate));&#10;            }&#10;&#10;            if (completedToDate != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().after(completedToDate));&#10;            }&#10;&#10;            if (doneFromDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().before(doneFromDate));&#10;            }&#10;&#10;            if (doneToDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().after(doneToDate));&#10;            }&#10;&#10;            // Task status filter&#10;            if (taskStatus != null &amp;&amp; !taskStatus.isEmpty()) {&#10;                switch (taskStatus) {&#10;                    case &quot;pending&quot;:&#10;                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                    case &quot;completed&quot;:&#10;                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsCompleted()));&#10;                        break;&#10;                    case &quot;done&quot;:&#10;                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                    case &quot;in_progress&quot;:&#10;                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                }&#10;            }&#10;            // Work order filter (search by correspondence id or jobNo)&#10;            if (workOrderFilter != null &amp;&amp; !workOrderFilter.trim().isEmpty()) {&#10;                final String filter = workOrderFilter.trim().toLowerCase();&#10;                searchResults.removeIf(task -&gt; {&#10;                    try {&#10;                        String w = getWorkOrderForTask(task);&#10;                        return w == null || !w.toLowerCase().contains(filter);&#10;                    } catch (Exception e) {&#10;                        return true;&#10;                    }&#10;                });&#10;            }&#10;&#10;            // reset grouped cache so UI will recompute&#10;            groupedResultsByWorkOrder = null;&#10;&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            // Handle error&#10;        }&#10;    }&#10;&#10;    // الدالة العامة التي تُرجع تسمية الحالة (تُستخدم في الـ XHTML)&#10;    public String getInspectionFormWorkflowStatus(Task task) {&#10;        TaskStatus status = resolveTaskStatus(task);&#10;        return status != null ? status.getLabel() : TaskStatus.PENDING.getLabel();&#10;    }&#10;&#10;    private TaskStatus resolveTaskStatus(Task task) {&#10;        if (task == null) return TaskStatus.PENDING;&#10;&#10;        try {&#10;            // 1) Finished (طباعة/إغلاق نهائي)&#10;            if (task.getDoneDate() != null) return TaskStatus.FINISHED;&#10;&#10;            // 2) Completed (مهام مكتملة لكن ربما لم تُطبع بعد)&#10;            if (task.getCompletedDate() != null) return TaskStatus.COMPLETED;&#10;&#10;            // 3) افتح workflows المتعلّقة بالتفتيش أولاً (equipment)&#10;            try {&#10;                if (task.getInspectionFormWorkflows() != null &amp;&amp; !task.getInspectionFormWorkflows().isEmpty()) {&#10;                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                    Set&lt;com.smat.ins.model.entity.InspectionFormWorkflow&gt; flows = task.getInspectionFormWorkflows();&#10;                    for (com.smat.ins.model.entity.InspectionFormWorkflow wf : flows) {&#10;                        if (wf == null || wf.getWorkflowDefinition() == null || wf.getWorkflowDefinition().getStep() == null) continue;&#10;                        String name = wf.getWorkflowDefinition().getStep().getEnglishName();&#10;                        if (name == null) continue;&#10;                        String ln = name.toLowerCase();&#10;&#10;                        // Inspect / Submitted =&gt; Inspected&#10;                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;&#10;                        // Any review-related wording =&gt; Inspected (Under review)&#10;                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                        }&#10;&#10;                        // Approved/Completed/Finished =&gt; Completed (or Finished if explicit)&#10;                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;&#10;                        // Rejected =&gt; Rejected&#10;                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;&#10;                        // Legacy fixed/repair wording =&gt; treat as Finished now&#10;                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- changed: map legacy fixed -&gt; Finished&#10;                        }&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore and fallback */ }&#10;&#10;            // 4) EmpCertification workflows (Employee training)&#10;            try {&#10;                if (task.getEmpCertificationWorkflows() != null &amp;&amp; !task.getEmpCertificationWorkflows().isEmpty()) {&#10;                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                    Set&lt;com.smat.ins.model.entity.EmpCertificationWorkflow&gt; ewfs = task.getEmpCertificationWorkflows();&#10;                    for (com.smat.ins.model.entity.EmpCertificationWorkflow ew : ewfs) {&#10;                        if (ew == null || ew.getWorkflowDefinition() == null || ew.getWorkflowDefinition().getStep() == null) continue;&#10;                        String name = ew.getWorkflowDefinition().getStep().getEnglishName();&#10;                        if (name == null) continue;&#10;                        String ln = name.toLowerCase();&#10;&#10;                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;&#10;                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                        }&#10;&#10;                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;&#10;                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;&#10;                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- changed here too&#10;                        }&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore and fallback */ }&#10;&#10;            // 5) Fallback: check related forms loaded via services&#10;            try {&#10;                EmpCertification empCert = empCertificationService.getBy(task.getId());&#10;                if (empCert != null) {&#10;                    if (empCert.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                    if (empCert.getSysUserByInspectedBy() != null) return TaskStatus.INSPECTED;&#10;                    if (empCert.getStatus() != null &amp;&amp; !empCert.getStatus().trim().isEmpty()) {&#10;                        String st = empCert.getStatus().toLowerCase();&#10;                        if (st.contains(&quot;approved&quot;) || st.contains(&quot;completed&quot;) || st.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;                        if (st.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;                        if (st.contains(&quot;fixed&quot;) || st.contains(&quot;repaired&quot;) || st.contains(&quot;repair completed&quot;) || st.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- legacy -&gt; finished&#10;                        }&#10;                        if (st.contains(&quot;review&quot;) || st.contains(&quot;under review&quot;)) return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            try {&#10;                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                if (eif != null) {&#10;                    if (eif.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                    if (eif.getSysUserByInspectionBy() != null) return TaskStatus.INSPECTED;&#10;                    // optionally check textual fields on the form if you have a status field there&#10;                }&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            // 6) If assigned to someone -&gt; Assigned&#10;            if (task.getUserAliasByAssignTo() != null) return TaskStatus.ASSIGNED;&#10;&#10;        } catch (Exception ex) {&#10;            ex.printStackTrace();&#10;        }&#10;&#10;        // Default&#10;        return TaskStatus.PENDING;&#10;    }&#10;&#10;&#10;&#10;&#10;&#10;    public void clearSearch() {&#10;        taskDescription = null;&#10;        isCompleted = null;&#10;        isDone = null;&#10;        fromDate = null;&#10;        toDate = null;&#10;        assignee = null;&#10;&#10;        // Clear new filters&#10;        company = null;&#10;        equipmentCategory = null;&#10;        serviceType = null;&#10;        assigner = null;&#10;        completedFromDate = null;&#10;        completedToDate = null;&#10;        doneFromDate = null;&#10;        doneToDate = null;&#10;        taskStatus = null;&#10;    workOrderFilter = null;&#10;        searchResults.clear();&#10;        groupedResultsByWorkOrder = null;&#10;    }&#10;&#10;    public String getReviewerTask(Task task) {&#10;        if (task.getEquipmentCategory() != null) {&#10;            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;            if (equipmentInspectionForm != null)&#10;                if (equipmentInspectionForm.getSysUserByReviewedBy() != null)&#10;                    return equipmentInspectionForm.getSysUserByReviewedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        } else {&#10;            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;            if (empCertification != null)&#10;                if (empCertification.getSysUserByReviewedBy() != null)&#10;                    return empCertification.getSysUserByReviewedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        }&#10;&#10;        return &quot;Not assigned&quot;;&#10;    }&#10;    public static enum TaskStatus {&#10;        PENDING(&quot;Pending&quot;),&#10;        ASSIGNED(&quot;Assigned&quot;),&#10;        INSPECTED(&quot;Inspected&quot;),&#10;        INSPECTED_UNDER_REVIEW(&quot;Inspected (Under review)&quot;),&#10;        REVIEWED(&quot;Reviewed&quot;),&#10;        COMPLETED(&quot;Completed&quot;),&#10;        FINISHED(&quot;Finished&quot;),&#10;        REJECTED(&quot;Rejected&quot;),&#10;        ON_HOLD(&quot;On Hold&quot;),&#10;        CANCELLED(&quot;Cancelled&quot;),&#10;        RESOLVED(&quot;Resolved&quot;); // اختياري إن كنت تستعمله&#10;&#10;        private final String label;&#10;        TaskStatus(String label) { this.label = label; }&#10;        public String getLabel() { return label; }&#10;        @Override public String toString() { return label; }&#10;    }&#10;    public String getIconForStatusLabel(String statusLabel) {&#10;        if (statusLabel == null) return &quot;pi-clock&quot;;&#10;        String s = statusLabel.toLowerCase();&#10;        if (s.contains(&quot;assigned&quot;)) return &quot;pi-user-plus&quot;;&#10;        if (s.contains(&quot;inspected&quot;) &amp;&amp; s.contains(&quot;under review&quot;)) return &quot;pi-eye&quot;;&#10;        if (s.contains(&quot;inspected&quot;)) return &quot;pi-search&quot;;&#10;        if (s.contains(&quot;reviewed&quot;)) return &quot;pi-check&quot;;&#10;        if (s.contains(&quot;completed&quot;)) return &quot;pi-check&quot;;&#10;        if (s.contains(&quot;finished&quot;) || s.contains(&quot;done&quot;)) return &quot;pi-check-circle&quot;; // covers legacy fixed -&gt; finished&#10;        if (s.contains(&quot;resolved&quot;)) return &quot;pi-check-circle&quot;;&#10;        if (s.contains(&quot;rejected&quot;)) return &quot;pi-times&quot;;&#10;        if (s.contains(&quot;hold&quot;) || s.contains(&quot;on hold&quot;)) return &quot;pi-pause&quot;;&#10;        if (s.contains(&quot;cancel&quot;)) return &quot;pi-ban&quot;;&#10;        return &quot;pi-clock&quot;;&#10;    }&#10;&#10;    public String getStatusCssClass(String statusLabel) {&#10;        if (statusLabel == null) return &quot;status-badge pending&quot;;&#10;        // normalize to safe token: lowercase, non-alnum -&gt; dash, collapse dashes&#10;        String token = statusLabel.toLowerCase()&#10;                .replaceAll(&quot;[^a-z0-9]+&quot;, &quot;-&quot;)   // replace non-alphanumeric with hyphen&#10;                .replaceAll(&quot;^-+|-+$&quot;, &quot;&quot;)       // trim leading/trailing hyphens&#10;                .replaceAll(&quot;-{2,}&quot;, &quot;-&quot;);       // collapse multiple hyphens&#10;        if (token.isEmpty()) token = &quot;pending&quot;;&#10;        return &quot;status-badge &quot; + token; // e.g. &quot;status-badge inspected-under-review&quot;&#10;    }&#10;&#10;    public String getInspectorTask(Task task) {&#10;        if (task.getEquipmentCategory() != null) {&#10;            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;            if (equipmentInspectionForm != null)&#10;                if (equipmentInspectionForm.getSysUserByInspectionBy() != null)&#10;                    return equipmentInspectionForm.getSysUserByInspectionBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        } else {&#10;            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;            if (empCertification != null)&#10;                if (empCertification.getSysUserByInspectedBy() != null)&#10;                    return empCertification.getSysUserByInspectedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        }&#10;&#10;        return &quot;Not assigned&quot;;&#10;    }&#10;    public void exportToExcel() {&#10;        try {&#10;            // Create workbook&#10;            Workbook workbook = new XSSFWorkbook();&#10;            Sheet sheet = workbook.createSheet(&quot;Tasks Report&quot;);&#10;&#10;            // Create header style&#10;            CellStyle headerStyle = workbook.createCellStyle();&#10;            Font headerFont = workbook.createFont();&#10;            headerFont.setBold(true);&#10;            headerFont.setColor(IndexedColors.WHITE.getIndex());&#10;            headerStyle.setFont(headerFont);&#10;            headerStyle.setFillForegroundColor(IndexedColors.DARK_BLUE.getIndex());&#10;            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);&#10;            headerStyle.setBorderBottom(BorderStyle.THIN);&#10;            headerStyle.setBorderTop(BorderStyle.THIN);&#10;            headerStyle.setBorderLeft(BorderStyle.THIN);&#10;            headerStyle.setBorderRight(BorderStyle.THIN);&#10;            headerStyle.setAlignment(HorizontalAlignment.CENTER);&#10;&#10;            // Create data style&#10;            CellStyle dataStyle = workbook.createCellStyle();&#10;            dataStyle.setBorderBottom(BorderStyle.THIN);&#10;            dataStyle.setBorderTop(BorderStyle.THIN);&#10;            dataStyle.setBorderLeft(BorderStyle.THIN);&#10;            dataStyle.setBorderRight(BorderStyle.THIN);&#10;&#10;            // Create date style&#10;            CellStyle dateStyle = workbook.createCellStyle();&#10;            dateStyle.setBorderBottom(BorderStyle.THIN);&#10;            dateStyle.setBorderTop(BorderStyle.THIN);&#10;            dateStyle.setBorderLeft(BorderStyle.THIN);&#10;            dateStyle.setBorderRight(BorderStyle.THIN);&#10;            CreationHelper createHelper = workbook.getCreationHelper();&#10;            dateStyle.setDataFormat(createHelper.createDataFormat().getFormat(&quot;yyyy-mm-dd&quot;));&#10;&#10;            // Create header row (including Work Order as first column)&#10;            Row headerRow = sheet.createRow(0);&#10;            String[] headers = {&#10;                    &quot;Work Order&quot;, &quot;Task ID&quot;, &quot;Company&quot;, &quot;Equipment&quot;, &quot;Service&quot;,&#10;                    &quot;Assigner&quot;, &quot;Inspector&quot;, &quot;Reviewer&quot;, &quot;Status&quot;,&#10;                    &quot;Created Date&quot;, &quot;Task Description&quot;&#10;            };&#10;&#10;            for (int i = 0; i &lt; headers.length; i++) {&#10;                Cell cell = headerRow.createCell(i);&#10;                cell.setCellValue(headers[i]);&#10;                cell.setCellStyle(headerStyle);&#10;            }&#10;&#10;            // Populate data rows&#10;            int rowNum = 1;&#10;&#10;            for (Task task : searchResults) {&#10;                Row row = sheet.createRow(rowNum++);&#10;&#10;                // Work Order (use public wrapper to guapackage com.smat.ins.view.bean;&#10;                //&#10;                //import java.io.Serializable;&#10;                //import java.util.ArrayList;&#10;                //import java.util.Date;&#10;                //import java.util.List;&#10;                //import java.util.Set;&#10;                //import java.util.Map;&#10;                //import java.util.LinkedHashMap;&#10;                //import java.util.HashMap;&#10;                //&#10;                //import javax.annotation.PostConstruct;&#10;                //import javax.faces.view.ViewScoped;&#10;                //import javax.inject.Inject;&#10;                //import javax.inject.Named;&#10;                //&#10;                //import com.smat.ins.model.entity.Company;&#10;                //import com.smat.ins.model.entity.EmpCertification;&#10;                //import com.smat.ins.model.entity.EquipmentCategory;&#10;                //import com.smat.ins.model.entity.EquipmentInspectionForm;&#10;                //import com.smat.ins.model.entity.InspectionFormWorkflow;&#10;                //import com.smat.ins.model.entity.ServiceType;&#10;                //import com.smat.ins.model.entity.Task;&#10;                //import com.smat.ins.model.entity.UserAlias;&#10;                //import com.smat.ins.model.service.CompanyService;&#10;                //import com.smat.ins.model.service.EmpCertificationService;&#10;                //import com.smat.ins.model.service.EquipmentCategoryService;&#10;                //import com.smat.ins.model.service.EquipmentInspectionFormService;&#10;                //import com.smat.ins.model.service.ServiceTypeService;&#10;                //import com.smat.ins.model.service.TaskService;&#10;                //import com.smat.ins.model.service.UserAliasService;&#10;                //import com.smat.ins.util.BeanUtility;&#10;                //import org.apache.poi.ss.usermodel.*;&#10;                //import org.apache.poi.xssf.usermodel.XSSFWorkbook;&#10;                //import javax.faces.context.FacesContext;&#10;                //import javax.servlet.http.HttpServletResponse;&#10;                //import java.io.ByteArrayOutputStream;&#10;                //import java.io.IOException;&#10;                //import java.text.SimpleDateFormat;&#10;                //import java.util.Date;&#10;                //import java.util.List;&#10;                //&#10;                //&#10;                //@Named&#10;                //@ViewScoped&#10;                //public class TaskSearchBean implements Serializable {&#10;                //&#10;                //    private static final long serialVersionUID = 1L;&#10;                //&#10;                //    // Search criteria fields&#10;                //    private String taskDescription;&#10;                //    private Boolean isCompleted;&#10;                //    private Boolean isDone;&#10;                //    private Date fromDate;&#10;                //    private Date toDate;&#10;                //    private UserAlias assignee;&#10;                //    private UserAlias reviewer;&#10;                //&#10;                //    // New search criteria fields&#10;                //    private Company company;&#10;                //    private EquipmentCategory equipmentCategory;&#10;                //    private ServiceType serviceType;&#10;                //    private UserAlias assigner;&#10;                //    private Date completedFromDate;&#10;                //    private Date completedToDate;&#10;                //    private Date doneFromDate;&#10;                //    private Date doneToDate;&#10;                //    private String taskStatus; // Combined status filter&#10;                //    private String workOrderFilter; // search by work order / correspondence id or jobNo&#10;                //&#10;                //    // Results&#10;                //    private List&lt;Task&gt; searchResults = new ArrayList&lt;&gt;();&#10;                //    // cached grouped results by work order (computed on demand)&#10;                //    private Map&lt;String, List&lt;Task&gt;&gt; groupedResultsByWorkOrder;&#10;                //    private List&lt;UserAlias&gt; userAliasList = new ArrayList&lt;&gt;();&#10;                //    private List&lt;Company&gt; companyList = new ArrayList&lt;&gt;();&#10;                //    private List&lt;EquipmentCategory&gt; equipmentCategoryList = new ArrayList&lt;&gt;();&#10;                //    private List&lt;ServiceType&gt; serviceTypeList = new ArrayList&lt;&gt;();&#10;                //&#10;                //    // Services&#10;                //    private TaskService taskService;&#10;                //    private UserAliasService userAliasService;&#10;                //    private CompanyService companyService;&#10;                //    private EquipmentCategoryService equipmentCategoryService;&#10;                //    private ServiceTypeService serviceTypeService;&#10;                //    private EquipmentInspectionFormService equipmentInspectionFormService;&#10;                //    private EmpCertificationService empCertificationService;&#10;                //&#10;                //    @Inject&#10;                //    private LoginBean loginBean;&#10;                //&#10;                //    @PostConstruct&#10;                //    public void init() {&#10;                //        taskService = (TaskService) BeanUtility.getBean(&quot;taskService&quot;);&#10;                //        userAliasService = (UserAliasService) BeanUtility.getBean(&quot;userAliasService&quot;);&#10;                //        companyService = (CompanyService) BeanUtility.getBean(&quot;companyService&quot;);&#10;                //        equipmentCategoryService = (EquipmentCategoryService) BeanUtility.getBean(&quot;equipmentCategoryService&quot;);&#10;                //        serviceTypeService = (ServiceTypeService) BeanUtility.getBean(&quot;serviceTypeService&quot;);&#10;                //        equipmentInspectionFormService = (EquipmentInspectionFormService) BeanUtility&#10;                //                .getBean(&quot;equipmentInspectionFormService&quot;);&#10;                //        empCertificationService = (EmpCertificationService) BeanUtility.getBean(&quot;empCertificationService&quot;);&#10;                //        try {&#10;                //            userAliasList = userAliasService.findAll();&#10;                //            companyList = companyService.findAll();&#10;                //            equipmentCategoryList = equipmentCategoryService.findAll();&#10;                //            serviceTypeList = serviceTypeService.findAll();&#10;                //        } catch (Exception e) {&#10;                //            e.printStackTrace();&#10;                //        }&#10;                //    }&#10;                //&#10;                //    public void searchTasks() {&#10;                //        try {&#10;                //            // Get all tasks first (you might want to implement more specific search methods&#10;                //            // in TaskService)&#10;                //            searchResults = taskService.findAll();&#10;                //&#10;                //            // Apply filters in memory (or better, implement these filters in your DAO)&#10;                //            if (taskDescription != null &amp;&amp; !taskDescription.isEmpty()) {&#10;                //                searchResults.removeIf(task -&gt; task.getTaskDescription() == null&#10;                //                        || !task.getTaskDescription().toLowerCase().contains(taskDescription.toLowerCase()));&#10;                //            }&#10;                //&#10;                //            if (isCompleted != null) {&#10;                //                searchResults.removeIf(task -&gt; !isCompleted.equals(task.getIsCompleted()));&#10;                //            }&#10;                //&#10;                //            if (isDone != null) {&#10;                //                searchResults.removeIf(task -&gt; !isDone.equals(task.getIsDone()));&#10;                //            }&#10;                //&#10;                //            if (fromDate != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().before(fromDate));&#10;                //            }&#10;                //&#10;                //            if (toDate != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().after(toDate));&#10;                //            }&#10;                //&#10;                //            if (assignee != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getUserAliasByAssignTo() == null&#10;                //                        || !assignee.getId().equals(task.getUserAliasByAssignTo().getId()));&#10;                //            }&#10;                //&#10;                //            // New filters&#10;                //            if (company != null) {&#10;                //                searchResults.removeIf(&#10;                //                        task -&gt; task.getCompany() == null || !company.getId().equals(task.getCompany().getId()));&#10;                //            }&#10;                //&#10;                //            if (equipmentCategory != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getEquipmentCategory() == null&#10;                //                        || !equipmentCategory.getId().equals(task.getEquipmentCategory().getId()));&#10;                //            }&#10;                //&#10;                //            if (serviceType != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getServiceType() == null&#10;                //                        || !serviceType.getId().equals(task.getServiceType().getId()));&#10;                //            }&#10;                //&#10;                //            if (assigner != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getUserAliasByAssigner() == null&#10;                //                        || !assigner.getId().equals(task.getUserAliasByAssigner().getId()));&#10;                //            }&#10;                //&#10;                //            // Reviewer filter: map to form-level ReviewedBy (equipment inspection or emp certification)&#10;                //            if (reviewer != null) {&#10;                //                final com.smat.ins.model.entity.SysUser reviewerSysUser = reviewer.getSysUserBySysUser();&#10;                //                searchResults.removeIf(task -&gt; {&#10;                //                    try {&#10;                //                        if (task.getEquipmentCategory() != null) {&#10;                //                            EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                //                            if (eif != null &amp;&amp; eif.getSysUserByReviewedBy() != null) {&#10;                //                                return !reviewerSysUser.getId().equals(eif.getSysUserByReviewedBy().getId());&#10;                //                            }&#10;                //                            return true; // no form or no reviewer -&gt; exclude&#10;                //                        } else {&#10;                //                            EmpCertification ec = empCertificationService.getBy(task.getId());&#10;                //                            if (ec != null &amp;&amp; ec.getSysUserByReviewedBy() != null) {&#10;                //                                return !reviewerSysUser.getId().equals(ec.getSysUserByReviewedBy().getId());&#10;                //                            }&#10;                //                            return true; // no cert or no reviewer -&gt; exclude&#10;                //                        }&#10;                //                    } catch (Exception e) {&#10;                //                        return true;&#10;                //                    }&#10;                //                });&#10;                //            }&#10;                //&#10;                //            if (completedFromDate != null) {&#10;                //                searchResults.removeIf(&#10;                //                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().before(completedFromDate));&#10;                //            }&#10;                //&#10;                //            if (completedToDate != null) {&#10;                //                searchResults.removeIf(&#10;                //                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().after(completedToDate));&#10;                //            }&#10;                //&#10;                //            if (doneFromDate != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().before(doneFromDate));&#10;                //            }&#10;                //&#10;                //            if (doneToDate != null) {&#10;                //                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().after(doneToDate));&#10;                //            }&#10;                //&#10;                //            // Task status filter&#10;                //            if (taskStatus != null &amp;&amp; !taskStatus.isEmpty()) {&#10;                //                switch (taskStatus) {&#10;                //                    case &quot;pending&quot;:&#10;                //                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                //                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                //                        break;&#10;                //                    case &quot;completed&quot;:&#10;                //                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsCompleted()));&#10;                //                        break;&#10;                //                    case &quot;done&quot;:&#10;                //                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsDone()));&#10;                //                        break;&#10;                //                    case &quot;in_progress&quot;:&#10;                //                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                //                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                //                        break;&#10;                //                }&#10;                //            }&#10;                //            // Work order filter (search by correspondence id or jobNo)&#10;                //            if (workOrderFilter != null &amp;&amp; !workOrderFilter.trim().isEmpty()) {&#10;                //                final String filter = workOrderFilter.trim().toLowerCase();&#10;                //                searchResults.removeIf(task -&gt; {&#10;                //                    try {&#10;                //                        String w = getWorkOrderForTask(task);&#10;                //                        return w == null || !w.toLowerCase().contains(filter);&#10;                //                    } catch (Exception e) {&#10;                //                        return true;&#10;                //                    }&#10;                //                });&#10;                //            }&#10;                //&#10;                //            // reset grouped cache so UI will recompute&#10;                //            groupedResultsByWorkOrder = null;&#10;                //&#10;                //        } catch (Exception e) {&#10;                //            e.printStackTrace();&#10;                //            // Handle error&#10;                //        }&#10;                //    }&#10;                //&#10;                //    // الدالة العامة التي تُرجع تسمية الحالة (تُستخدم في الـ XHTML)&#10;                //    public String getInspectionFormWorkflowStatus(Task task) {&#10;                //        TaskStatus status = resolveTaskStatus(task);&#10;                //        return status != null ? status.getLabel() : TaskStatus.PENDING.getLabel();&#10;                //    }&#10;                //&#10;                //    private TaskStatus resolveTaskStatus(Task task) {&#10;                //        if (task == null) return TaskStatus.PENDING;&#10;                //&#10;                //        try {&#10;                //            // 1) Finished (طباعة/إغلاق نهائي)&#10;                //            if (task.getDoneDate() != null) return TaskStatus.FINISHED;&#10;                //&#10;                //            // 2) Completed (مهام مكتملة لكن ربما لم تُطبع بعد)&#10;                //            if (task.getCompletedDate() != null) return TaskStatus.COMPLETED;&#10;                //&#10;                //            // 3) افتح workflows المتعلّقة بالتفتيش أولاً (equipment)&#10;                //            try {&#10;                //                if (task.getInspectionFormWorkflows() != null &amp;&amp; !task.getInspectionFormWorkflows().isEmpty()) {&#10;                //                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                //                    Set&lt;com.smat.ins.model.entity.InspectionFormWorkflow&gt; flows = task.getInspectionFormWorkflows();&#10;                //                    for (com.smat.ins.model.entity.InspectionFormWorkflow wf : flows) {&#10;                //                        if (wf == null || wf.getWorkflowDefinition() == null || wf.getWorkflowDefinition().getStep() == null) continue;&#10;                //                        String name = wf.getWorkflowDefinition().getStep().getEnglishName();&#10;                //                        if (name == null) continue;&#10;                //                        String ln = name.toLowerCase();&#10;                //&#10;                //                        // Inspect / Submitted =&gt; Inspected&#10;                //                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;                //&#10;                //                        // Any review-related wording =&gt; Inspected (Under review)&#10;                //                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                //                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                //                        }&#10;                //&#10;                //                        // Approved/Completed/Finished =&gt; Completed (or Finished if explicit)&#10;                //                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;                //&#10;                //                        // Rejected =&gt; Rejected&#10;                //                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;                //&#10;                //                        // Legacy fixed/repair wording =&gt; treat as Finished now&#10;                //                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                //                            return TaskStatus.FINISHED; // &lt;-- changed: map legacy fixed -&gt; Finished&#10;                //                        }&#10;                //                    }&#10;                //                }&#10;                //            } catch (Exception e) { /* ignore and fallback */ }&#10;                //&#10;                //            // 4) EmpCertification workflows (Employee training)&#10;                //            try {&#10;                //                if (task.getEmpCertificationWorkflows() != null &amp;&amp; !task.getEmpCertificationWorkflows().isEmpty()) {&#10;                //                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                //                    Set&lt;com.smat.ins.model.entity.EmpCertificationWorkflow&gt; ewfs = task.getEmpCertificationWorkflows();&#10;                //                    for (com.smat.ins.model.entity.EmpCertificationWorkflow ew : ewfs) {&#10;                //                        if (ew == null || ew.getWorkflowDefinition() == null || ew.getWorkflowDefinition().getStep() == null) continue;&#10;                //                        String name = ew.getWorkflowDefinition().getStep().getEnglishName();&#10;                //                        if (name == null) continue;&#10;                //                        String ln = name.toLowerCase();&#10;                //&#10;                //                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;                //&#10;                //                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                //                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                //                        }&#10;                //&#10;                //                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;                //&#10;                //                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;                //&#10;                //                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                //                            return TaskStatus.FINISHED; // &lt;-- changed here too&#10;                //                        }&#10;                //                    }&#10;                //                }&#10;                //            } catch (Exception e) { /* ignore and fallback */ }&#10;                //&#10;                //            // 5) Fallback: check related forms loaded via services&#10;                //            try {&#10;                //                EmpCertification empCert = empCertificationService.getBy(task.getId());&#10;                //                if (empCert != null) {&#10;                //                    if (empCert.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                //                    if (empCert.getSysUserByInspectedBy() != null) return TaskStatus.INSPECTED;&#10;                //                    if (empCert.getStatus() != null &amp;&amp; !empCert.getStatus().trim().isEmpty()) {&#10;                //                        String st = empCert.getStatus().toLowerCase();&#10;                //                        if (st.contains(&quot;approved&quot;) || st.contains(&quot;completed&quot;) || st.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;                //                        if (st.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;                //                        if (st.contains(&quot;fixed&quot;) || st.contains(&quot;repaired&quot;) || st.contains(&quot;repair completed&quot;) || st.contains(&quot;issue fixed&quot;)) {&#10;                //                            return TaskStatus.FINISHED; // &lt;-- legacy -&gt; finished&#10;                //                        }&#10;                //                        if (st.contains(&quot;review&quot;) || st.contains(&quot;under review&quot;)) return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                //                    }&#10;                //                }&#10;                //            } catch (Exception e) { /* ignore */ }&#10;                //&#10;                //            try {&#10;                //                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                //                if (eif != null) {&#10;                //                    if (eif.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                //                    if (eif.getSysUserByInspectionBy() != null) return TaskStatus.INSPECTED;&#10;                //                    // optionally check textual fields on the form if you have a status field there&#10;                //                }&#10;                //            } catch (Exception e) { /* ignore */ }&#10;                //&#10;                //            // 6) If assigned to someone -&gt; Assigned&#10;                //            if (task.getUserAliasByAssignTo() != null) return TaskStatus.ASSIGNED;&#10;                //&#10;                //        } catch (Exception ex) {&#10;                //            ex.printStackTrace();&#10;                //        }&#10;                //&#10;                //        // Default&#10;                //        return TaskStatus.PENDING;&#10;                //    }&#10;                //&#10;                //&#10;                //&#10;                //&#10;                //&#10;                //    public void clearSearch() {&#10;                //        taskDescription = null;&#10;                //        isCompleted = null;&#10;                //        isDone = null;&#10;                //        fromDate = null;&#10;                //        toDate = null;&#10;                //        assignee = null;&#10;                //        reviewer = null;&#10;                //&#10;                //        // Clear new filters&#10;                //        company = null;&#10;                //        equipmentCategory = null;&#10;                //        serviceType = null;&#10;                //        assigner = null;&#10;                //        completedFromDate = null;&#10;                //        completedToDate = null;&#10;                //        doneFromDate = null;&#10;                //        doneToDate = null;&#10;                //        taskStatus = null;&#10;                //    workOrderFilter = null;&#10;                //        searchResults.clear();&#10;                //        groupedResultsByWorkOrder = null;&#10;                //    }&#10;                //&#10;                //    public String getReviewerTask(Task task) {&#10;                //        if (task.getEquipmentCategory() != null) {&#10;                //            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;                //            if (equipmentInspectionForm != null)&#10;                //                if (equipmentInspectionForm.getSysUserByReviewedBy() != null)&#10;                //                    return equipmentInspectionForm.getSysUserByReviewedBy().getDisplayName();&#10;                //                else&#10;                //                    return &quot;Not assigned&quot;;&#10;                //        } else {&#10;                //            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;                //            if (empCertification != null)&#10;                //                if (empCertification.getSysUserByReviewedBy() != null)&#10;                //                    return empCertification.getSysUserByReviewedBy().getDisplayName();&#10;                //                else&#10;                //                    return &quot;Not assigned&quot;;&#10;                //        }&#10;                //&#10;                //        return &quot;Not assigned&quot;;&#10;                //    }&#10;                //    public static enum TaskStatus {&#10;                //        PENDING(&quot;Pending&quot;),&#10;                //        ASSIGNED(&quot;Assigned&quot;),&#10;                //        INSPECTED(&quot;Inspected&quot;),&#10;                //        INSPECTED_UNDER_REVIEW(&quot;Inspected (Under review)&quot;),&#10;                //        REVIEWED(&quot;Reviewed&quot;),&#10;                //        COMPLETED(&quot;Completed&quot;),&#10;                //        FINISHED(&quot;Finished&quot;),&#10;                //        REJECTED(&quot;Rejected&quot;),&#10;                //        ON_HOLD(&quot;On Hold&quot;),&#10;                //        CANCELLED(&quot;Cancelled&quot;),&#10;                //        RESOLVED(&quot;Resolved&quot;); // اختياري إن كنت تستعمله&#10;                //&#10;                //        private final String label;&#10;                //        TaskStatus(String label) { this.label = label; }&#10;                //        public String getLabel() { return label; }&#10;                //        @Override public String toString() { return label; }&#10;                //    }&#10;                //    public String getIconForStatusLabel(String statusLabel) {&#10;                //        if (statusLabel == null) return &quot;pi-clock&quot;;&#10;                //        String s = statusLabel.toLowerCase();&#10;                //        if (s.contains(&quot;assigned&quot;)) return &quot;pi-user-plus&quot;;&#10;                //        if (s.contains(&quot;inspected&quot;) &amp;&amp; s.contains(&quot;under review&quot;)) return &quot;pi-eye&quot;;&#10;                //        if (s.contains(&quot;inspected&quot;)) return &quot;pi-search&quot;;&#10;                //        if (s.contains(&quot;reviewed&quot;)) return &quot;pi-check&quot;;&#10;                //        if (s.contains(&quot;completed&quot;)) return &quot;pi-check&quot;;&#10;                //        if (s.contains(&quot;finished&quot;) || s.contains(&quot;done&quot;)) return &quot;pi-check-circle&quot;; // covers legacy fixed -&gt; finished&#10;                //        if (s.contains(&quot;resolved&quot;)) return &quot;pi-check-circle&quot;;&#10;                //        if (s.contains(&quot;rejected&quot;)) return &quot;pi-times&quot;;&#10;                //        if (s.contains(&quot;hold&quot;) || s.contains(&quot;on hold&quot;)) return &quot;pi-pause&quot;;&#10;                //        if (s.contains(&quot;cancel&quot;)) return &quot;pi-ban&quot;;&#10;                //        return &quot;pi-clock&quot;;&#10;                //    }&#10;                //&#10;                //    public String getStatusCssClass(String statusLabel) {&#10;                //        if (statusLabel == null) return &quot;status-badge pending&quot;;&#10;                //        // normalize to safe token: lowercase, non-alnum -&gt; dash, collapse dashes&#10;                //        String token = statusLabel.toLowerCase()&#10;                //                .replaceAll(&quot;[^a-z0-9]+&quot;, &quot;-&quot;)   // replace non-alphanumeric with hyphen&#10;                //                .replaceAll(&quot;^-+|-+$&quot;, &quot;&quot;)       // trim leading/trailing hyphens&#10;                //                .replaceAll(&quot;-{2,}&quot;, &quot;-&quot;);       // collapse multiple hyphens&#10;                //        if (token.isEmpty()) token = &quot;pending&quot;;&#10;                //        return &quot;status-badge &quot; + token; // e.g. &quot;status-badge inspected-under-review&quot;&#10;                //    }&#10;                //&#10;                //    public String getInspectorTask(Task task) {&#10;                //        if (task.getEquipmentCategory() != null) {&#10;                //            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;                //            if (equipmentInspectionForm != null)&#10;                //                if (equipmentInspectionForm.getSysUserByInspectionBy() != null)&#10;                //                    return equipmentInspectionForm.getSysUserByInspectionBy().getDisplayName();&#10;                //                else&#10;                //                    return &quot;Not assigned&quot;;&#10;                //        } else {&#10;                //            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;                //            if (empCertification != null)&#10;                //                if (empCertification.getSysUserByInspectedBy() != null)&#10;                //                    return empCertification.getSysUserByInspectedBy().getDisplayName();&#10;                //                else&#10;                //                    return &quot;Not assigned&quot;;&#10;                //        }&#10;                //&#10;                //        return &quot;Not assigned&quot;;&#10;                //    }&#10;                //&#10;                //    public void exportToExcel() {&#10;                //        try {&#10;                //            // Create workbook&#10;                //            Workbook workbook = new XSSFWorkbook();&#10;                //            Sheet sheet = workbook.createSheet(&quot;Tasks Report&quot;);&#10;                //&#10;                //            // Create header style&#10;                //            CellStyle headerStyle = workbook.createCellStyle();&#10;                //            Font headerFont = workbook.createFont();&#10;                //            headerFont.setBold(true);&#10;                //            headerFont.setColor(IndexedColors.WHITE.getIndex());&#10;                //            headerStyle.setFont(headerFont);&#10;                //            headerStyle.setFillForegroundColor(IndexedColors.DARK_BLUE.getIndex());&#10;                //            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);&#10;                //            headerStyle.setBorderBottom(BorderStyle.THIN);&#10;                //            headerStyle.setBorderTop(BorderStyle.THIN);&#10;                //            headerStyle.setBorderLeft(BorderStyle.THIN);&#10;                //            headerStyle.setBorderRight(BorderStyle.THIN);&#10;                //            headerStyle.setAlignment(HorizontalAlignment.CENTER);&#10;                //&#10;                //            // Create data style&#10;                //            CellStyle dataStyle = workbook.createCellStyle();&#10;                //            dataStyle.setBorderBottom(BorderStyle.THIN);&#10;                //            dataStyle.setBorderTop(BorderStyle.THIN);&#10;                //            dataStyle.setBorderLeft(BorderStyle.THIN);&#10;                //            dataStyle.setBorderRight(BorderStyle.THIN);&#10;                //&#10;                //            // Create date style&#10;                //            CellStyle dateStyle = workbook.createCellStyle();&#10;                //            dateStyle.setBorderBottom(BorderStyle.THIN);&#10;                //            dateStyle.setBorderTop(BorderStyle.THIN);&#10;                //            dateStyle.setBorderLeft(BorderStyle.THIN);&#10;                //            dateStyle.setBorderRight(BorderStyle.THIN);&#10;                //            CreationHelper createHelper = workbook.getCreationHelper();&#10;                //            dateStyle.setDataFormat(createHelper.createDataFormat().getFormat(&quot;yyyy-mm-dd&quot;));&#10;                //&#10;                //            // Create header row (including Work Order as first column)&#10;                //            Row headerRow = sheet.createRow(0);&#10;                //            String[] headers = {&#10;                //                    &quot;Work Order&quot;, &quot;Task ID&quot;, &quot;Company&quot;, &quot;Equipment&quot;, &quot;Service&quot;,&#10;                //                    &quot;Assigner&quot;, &quot;Inspector&quot;, &quot;Reviewer&quot;, &quot;Status&quot;,&#10;                //                    &quot;Created Date&quot;, &quot;Task Description&quot;&#10;                //            };&#10;                //&#10;                //            for (int i = 0; i &lt; headers.length; i++) {&#10;                //                Cell cell = headerRow.createCell(i);&#10;                //                cell.setCellValue(headers[i]);&#10;                //                cell.setCellStyle(headerStyle);&#10;                //            }&#10;                //&#10;                //            // Populate data rows&#10;                //            int rowNum = 1;&#10;                //&#10;                //            for (Task task : searchResults) {&#10;                //                Row row = sheet.createRow(rowNum++);&#10;                //&#10;                //                // Work Order (use public wrapper to guarantee non-null label)&#10;                //                Cell cell0 = row.createCell(0);&#10;                //                String workOrder = getWorkOrderKey(task);&#10;                //                cell0.setCellValue(workOrder != null ? workOrder : &quot;&quot;);&#10;                //                cell0.setCellStyle(dataStyle);&#10;                //&#10;                //                // Task ID&#10;                //                Cell cell1 = row.createCell(1);&#10;                //                if (task.getId() != null) {&#10;                //                    // depending on type of id, set as numeric or string&#10;                //                    try {&#10;                //                        cell1.setCellValue(Long.parseLong(String.valueOf(task.getId())));&#10;                //                    } catch (Exception ex) {&#10;                //                        cell1.setCellValue(String.valueOf(task.getId()));&#10;                //                    }&#10;                //                } else {&#10;                //                    cell1.setCellValue(&quot;&quot;);&#10;                //                }&#10;                //                cell1.setCellStyle(dataStyle);&#10;                //&#10;                //                // Company&#10;                //                Cell cell2 = row.createCell(2);&#10;                //                cell2.setCellValue(task.getCompany() != null ? task.getCompany().getName() : &quot;&quot;);&#10;                //                cell2.setCellStyle(dataStyle);&#10;                //&#10;                //                // Equipment&#10;                //                Cell cell3 = row.createCell(3);&#10;                //                cell3.setCellValue(task.getEquipmentCategory() != null ? task.getEquipmentCategory().getName() : &quot;&quot;);&#10;                //                cell3.setCellStyle(dataStyle);&#10;                //&#10;                //                // Service&#10;                //                Cell cell4 = row.createCell(4);&#10;                //                cell4.setCellValue(task.getServiceType() != null ? task.getServiceType().getName() : &quot;&quot;);&#10;                //                cell4.setCellStyle(dataStyle);&#10;                //&#10;                //                // Assigner&#10;                //                Cell cell5 = row.createCell(5);&#10;                //                String assignerName = &quot;&quot;;&#10;                //                if (task.getUserAliasByAssigner() != null &amp;&amp; task.getUserAliasByAssigner().getSysUserBySysUser() != null) {&#10;                //                    assignerName = task.getUserAliasByAssigner().getSysUserBySysUser().getDisplayName();&#10;                //                }&#10;                //                cell5.setCellValue(assignerName);&#10;                //                cell5.setCellStyle(dataStyle);&#10;                //&#10;                //                // Inspector&#10;                //                Cell cell6 = row.createCell(6);&#10;                //                cell6.setCellValue(getInspectorTask(task));&#10;                //                cell6.setCellStyle(dataStyle);&#10;                //&#10;                //                // Reviewer&#10;                //                Cell cell7 = row.createCell(7);&#10;                //                cell7.setCellValue(getReviewerTask(task));&#10;                //                cell7.setCellStyle(dataStyle);&#10;                //&#10;                //                // Status&#10;                //                Cell cell8 = row.createCell(8);&#10;                //                cell8.setCellValue(getInspectionFormWorkflowStatus(task));&#10;                //                cell8.setCellStyle(dataStyle);&#10;                //&#10;                //                // Created Date (use proper date cell if available)&#10;                //                Cell cell9 = row.createCell(9);&#10;                //                if (task.getCreatedDate() != null) {&#10;                //                    cell9.setCellValue(task.getCreatedDate());&#10;                //                    cell9.setCellStyle(dateStyle);&#10;                //                } else {&#10;                //                    cell9.setCellValue(&quot;&quot;);&#10;                //                    cell9.setCellStyle(dataStyle);&#10;                //                }&#10;                //&#10;                //                // Task Description&#10;                //                Cell cell10 = row.createCell(10);&#10;                //                cell10.setCellValue(task.getTaskDescription() != null ? task.getTaskDescription() : &quot;&quot;);&#10;                //                cell10.setCellStyle(dataStyle);&#10;                //            }&#10;                //&#10;                //            // Auto-size columns&#10;                //            for (int i = 0; i &lt; headers.length; i++) {&#10;                //                sheet.autoSizeColumn(i);&#10;                //            }&#10;                //&#10;                //            // Prepare response&#10;                //            FacesContext facesContext = FacesContext.getCurrentInstance();&#10;                //            HttpServletResponse response = (HttpServletResponse) facesContext.getExternalContext().getResponse();&#10;                //&#10;                //            response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);&#10;                //            response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment; filename=\&quot;tasks_report_&quot; +&#10;                //                    new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;).format(new Date()) + &quot;.xlsx\&quot;&quot;);&#10;                //&#10;                //            // Write workbook to response&#10;                //            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();&#10;                //            workbook.write(outputStream);&#10;                //            workbook.close();&#10;                //&#10;                //            response.getOutputStream().write(outputStream.toByteArray());&#10;                //            response.getOutputStream().flush();&#10;                //            response.getOutputStream().close();&#10;                //&#10;                //            facesContext.responseComplete();&#10;                //&#10;                //        } catch (IOException e) {&#10;                //            e.printStackTrace();&#10;                //            // Handle error - you might want to add FacesMessage here&#10;                //        }&#10;                //    }&#10;                //&#10;                //&#10;                //&#10;                //    // Getters and Setters&#10;                //    public String getTaskDescription() {&#10;                //        return taskDescription;&#10;                //    }&#10;                //&#10;                //    public void setTaskDescription(String taskDescription) {&#10;                //        this.taskDescription = taskDescription;&#10;                //    }&#10;                //&#10;                //    public Boolean getIsCompleted() {&#10;                //        return isCompleted;&#10;                //    }&#10;                //&#10;                //    public void setIsCompleted(Boolean isCompleted) {&#10;                //        this.isCompleted = isCompleted;&#10;                //    }&#10;                //&#10;                //    public Boolean getIsDone() {&#10;                //        return isDone;&#10;                //    }&#10;                //&#10;                //    public void setIsDone(Boolean isDone) {&#10;                //        this.isDone = isDone;&#10;                //    }&#10;                //&#10;                //    public Date getFromDate() {&#10;                //        return fromDate;&#10;                //    }&#10;                //&#10;                //    public void setFromDate(Date fromDate) {&#10;                //        this.fromDate = fromDate;&#10;                //    }&#10;                //&#10;                //    public Date getToDate() {&#10;                //        return toDate;&#10;                //    }&#10;                //&#10;                //    public void setToDate(Date toDate) {&#10;                //        this.toDate = toDate;&#10;                //    }&#10;                //&#10;                //    public UserAlias getAssignee() {&#10;                //        return assignee;&#10;                //    }&#10;                //&#10;                //    public void setAssignee(UserAlias assignee) {&#10;                //        this.assignee = assignee;&#10;                //    }&#10;                //    public UserAlias getReviewer() {&#10;                //        return reviewer;&#10;                //    }&#10;                //&#10;                //    public void setReviewer(UserAlias reviewer) {&#10;                //        this.reviewer = reviewer;&#10;                //    }&#10;                //&#10;                //    public List&lt;Task&gt; getSearchResults() {&#10;                //        return searchResults;&#10;                //    }&#10;                //&#10;                //    public void setSearchResults(List&lt;Task&gt; searchResults) {&#10;                //        this.searchResults = searchResults;&#10;                //    }&#10;                //&#10;                //    public List&lt;UserAlias&gt; getUserAliasList() {&#10;                //        return userAliasList;&#10;                //    }&#10;                //&#10;                //    public void setUserAliasList(List&lt;UserAlias&gt; userAliasList) {&#10;                //        this.userAliasList = userAliasList;&#10;                //    }&#10;                //&#10;                //    // New getters and setters&#10;                //    public Company getCompany() {&#10;                //        return company;&#10;                //    }&#10;                //&#10;                //    public void setCompany(Company company) {&#10;                //        this.company = company;&#10;                //    }&#10;                //&#10;                //    public EquipmentCategory getEquipmentCategory() {&#10;                //        return equipmentCategory;&#10;                //    }&#10;                //&#10;                //    public void setEquipmentCategory(EquipmentCategory equipmentCategory) {&#10;                //        this.equipmentCategory = equipmentCategory;&#10;                //    }&#10;                //&#10;                //    public ServiceType getServiceType() {&#10;                //        return serviceType;&#10;                //    }&#10;                //&#10;                //    public void setServiceType(ServiceType serviceType) {&#10;                //        this.serviceType = serviceType;&#10;                //    }&#10;                //&#10;                //    public UserAlias getAssigner() {&#10;                //        return assigner;&#10;                //    }&#10;                //&#10;                //    public void setAssigner(UserAlias assigner) {&#10;                //        this.assigner = assigner;&#10;                //    }&#10;                //&#10;                //    public Date getCompletedFromDate() {&#10;                //        return completedFromDate;&#10;                //    }&#10;                //&#10;                //    public void setCompletedFromDate(Date completedFromDate) {&#10;                //        this.completedFromDate = completedFromDate;&#10;                //    }&#10;                //&#10;                //    public Date getCompletedToDate() {&#10;                //        return completedToDate;&#10;                //    }&#10;                //&#10;                //    public void setCompletedToDate(Date completedToDate) {&#10;                //        this.completedToDate = completedToDate;&#10;                //    }&#10;                //&#10;                //    public Date getDoneFromDate() {&#10;                //        return doneFromDate;&#10;                //    }&#10;                //&#10;                //    public void setDoneFromDate(Date doneFromDate) {&#10;                //        this.doneFromDate = doneFromDate;&#10;                //    }&#10;                //&#10;                //    public Date getDoneToDate() {&#10;                //        return doneToDate;&#10;                //    }&#10;                //&#10;                //    public void setDoneToDate(Date doneToDate) {&#10;                //        this.doneToDate = doneToDate;&#10;                //    }&#10;                //&#10;                //    public String getTaskStatus() {&#10;                //        return taskStatus;&#10;                //    }&#10;                //&#10;                //    public void setTaskStatus(String taskStatus) {&#10;                //        this.taskStatus = taskStatus;&#10;                //    }&#10;                //&#10;                //    public List&lt;Company&gt; getCompanyList() {&#10;                //        return companyList;&#10;                //    }&#10;                //&#10;                //    public void setCompanyList(List&lt;Company&gt; companyList) {&#10;                //        this.companyList = companyList;&#10;                //    }&#10;                //&#10;                //    public List&lt;EquipmentCategory&gt; getEquipmentCategoryList() {&#10;                //        return equipmentCategoryList;&#10;                //    }&#10;                //&#10;                //    public void setEquipmentCategoryList(List&lt;EquipmentCategory&gt; equipmentCategoryList) {&#10;                //        this.equipmentCategoryList = equipmentCategoryList;&#10;                //    }&#10;                //&#10;                //    public List&lt;ServiceType&gt; getServiceTypeList() {&#10;                //        return serviceTypeList;&#10;                //    }&#10;                //&#10;                //    public void setServiceTypeList(List&lt;ServiceType&gt; serviceTypeList) {&#10;                //        this.serviceTypeList = serviceTypeList;&#10;                //    }&#10;                //&#10;                //    // Work order filter getter/setter&#10;                //    public String getWorkOrderFilter() {&#10;                //        return workOrderFilter;&#10;                //    }&#10;                //&#10;                //    public void setWorkOrderFilter(String workOrderFilter) {&#10;                //        this.workOrderFilter = workOrderFilter;&#10;                //    }&#10;                //&#10;                //    /**&#10;                //     * Compute a canonical work-order string for a Task.&#10;                //     * Preference order:&#10;                //     *  1) Correspondence id (first correspondenceTask) -&gt; String.valueOf(id)&#10;                //     *  2) EquipmentInspectionForm.jobNo&#10;                //     *  3) EmpCertification.certNumber (if applicable)&#10;                //     *  4) null if none&#10;                //     */&#10;                //    private String getWorkOrderForTask(Task task) {&#10;                //        if (task == null) return null;&#10;                //        try {&#10;                //            // 1) correspondence id&#10;                //            if (task.getCorrespondenceTasks() != null &amp;&amp; !task.getCorrespondenceTasks().isEmpty()) {&#10;                //                Object first = task.getCorrespondenceTasks().iterator().next();&#10;                //                if (first instanceof com.smat.ins.model.entity.CorrespondenceTask) {&#10;                //                    com.smat.ins.model.entity.CorrespondenceTask ct = (com.smat.ins.model.entity.CorrespondenceTask) first;&#10;                //                    if (ct.getCorrespondence() != null &amp;&amp; ct.getCorrespondence().getId() != null) {&#10;                //                        return String.valueOf(ct.getCorrespondence().getId());&#10;                //                    }&#10;                //                }&#10;                //            }&#10;                //&#10;                //            // 2) EquipmentInspectionForm.jobNo&#10;                //            try {&#10;                //                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                //                if (eif != null &amp;&amp; eif.getJobNo() != null &amp;&amp; !eif.getJobNo().trim().isEmpty())&#10;                //                    return eif.getJobNo();&#10;                //            } catch (Exception e) { /* ignore */ }&#10;                //&#10;                //            // 3) EmpCertification.certNumber&#10;                //            try {&#10;                //                EmpCertification ec = empCertificationService.getBy(task.getId());&#10;                //                if (ec != null &amp;&amp; ec.getCertNumber() != null &amp;&amp; !ec.getCertNumber().trim().isEmpty())&#10;                //                    return ec.getCertNumber();&#10;                //            } catch (Exception e) { /* ignore */ }&#10;                //&#10;                //        } catch (Exception e) {&#10;                //            // swallow - best-effort only&#10;                //        }&#10;                //        return null;&#10;                //    }&#10;                //&#10;                //    // Public wrapper for use in EL to get normalized work order key (never null)&#10;                //    public String getWorkOrderKey(Task task) {&#10;                //        String k = getWorkOrderForTask(task);&#10;                //        return k == null ? &quot;No Work Order&quot; : k;&#10;                //    }&#10;                //&#10;                //    /**&#10;                //     * Group searchResults by canonical work order string. Returns an ordered map (insertion order).&#10;                //     */&#10;                //    public Map&lt;String, List&lt;Task&gt;&gt; getGroupedResultsByWorkOrder() {&#10;                //        if (groupedResultsByWorkOrder != null) return groupedResultsByWorkOrder;&#10;                //        groupedResultsByWorkOrder = new LinkedHashMap&lt;&gt;();&#10;                //        if (searchResults == null) return groupedResultsByWorkOrder;&#10;                //        for (Task t : searchResults) {&#10;                //            String key = getWorkOrderForTask(t);&#10;                //            if (key == null) key = &quot;No Work Order&quot;;&#10;                //            List&lt;Task&gt; list = groupedResultsByWorkOrder.get(key);&#10;                //            if (list == null) {&#10;                //                list = new ArrayList&lt;&gt;();&#10;                //                groupedResultsByWorkOrder.put(key, list);&#10;                //            }&#10;                //            list.add(t);&#10;                //        }&#10;                //        return groupedResultsByWorkOrder;&#10;                //    }&#10;                //&#10;                //}rantee non-null label)&#10;                Cell cell0 = row.createCell(0);&#10;                String workOrder = getWorkOrderKey(task);&#10;                cell0.setCellValue(workOrder != null ? workOrder : &quot;&quot;);&#10;                cell0.setCellStyle(dataStyle);&#10;&#10;                // Task ID&#10;                Cell cell1 = row.createCell(1);&#10;                if (task.getId() != null) {&#10;                    // depending on type of id, set as numeric or string&#10;                    try {&#10;                        cell1.setCellValue(Long.parseLong(String.valueOf(task.getId())));&#10;                    } catch (Exception ex) {&#10;                        cell1.setCellValue(String.valueOf(task.getId()));&#10;                    }&#10;                } else {&#10;                    cell1.setCellValue(&quot;&quot;);&#10;                }&#10;                cell1.setCellStyle(dataStyle);&#10;&#10;                // Company&#10;                Cell cell2 = row.createCell(2);&#10;                cell2.setCellValue(task.getCompany() != null ? task.getCompany().getName() : &quot;&quot;);&#10;                cell2.setCellStyle(dataStyle);&#10;&#10;                // Equipment&#10;                Cell cell3 = row.createCell(3);&#10;                cell3.setCellValue(task.getEquipmentCategory() != null ? task.getEquipmentCategory().getName() : &quot;&quot;);&#10;                cell3.setCellStyle(dataStyle);&#10;&#10;                // Service&#10;                Cell cell4 = row.createCell(4);&#10;                cell4.setCellValue(task.getServiceType() != null ? task.getServiceType().getName() : &quot;&quot;);&#10;                cell4.setCellStyle(dataStyle);&#10;&#10;                // Assigner&#10;                Cell cell5 = row.createCell(5);&#10;                String assignerName = &quot;&quot;;&#10;                if (task.getUserAliasByAssigner() != null &amp;&amp; task.getUserAliasByAssigner().getSysUserBySysUser() != null) {&#10;                    assignerName = task.getUserAliasByAssigner().getSysUserBySysUser().getDisplayName();&#10;                }&#10;                cell5.setCellValue(assignerName);&#10;                cell5.setCellStyle(dataStyle);&#10;&#10;                // Inspector&#10;                Cell cell6 = row.createCell(6);&#10;                cell6.setCellValue(getInspectorTask(task));&#10;                cell6.setCellStyle(dataStyle);&#10;&#10;                // Reviewer&#10;                Cell cell7 = row.createCell(7);&#10;                cell7.setCellValue(getReviewerTask(task));&#10;                cell7.setCellStyle(dataStyle);&#10;&#10;                // Status&#10;                Cell cell8 = row.createCell(8);&#10;                cell8.setCellValue(getInspectionFormWorkflowStatus(task));&#10;                cell8.setCellStyle(dataStyle);&#10;&#10;                // Created Date (use proper date cell if available)&#10;                Cell cell9 = row.createCell(9);&#10;                if (task.getCreatedDate() != null) {&#10;                    cell9.setCellValue(task.getCreatedDate());&#10;                    cell9.setCellStyle(dateStyle);&#10;                } else {&#10;                    cell9.setCellValue(&quot;&quot;);&#10;                    cell9.setCellStyle(dataStyle);&#10;                }&#10;&#10;                // Task Description&#10;                Cell cell10 = row.createCell(10);&#10;                cell10.setCellValue(task.getTaskDescription() != null ? task.getTaskDescription() : &quot;&quot;);&#10;                cell10.setCellStyle(dataStyle);&#10;            }&#10;&#10;            // Auto-size columns&#10;            for (int i = 0; i &lt; headers.length; i++) {&#10;                sheet.autoSizeColumn(i);&#10;            }&#10;&#10;            // Prepare response&#10;            FacesContext facesContext = FacesContext.getCurrentInstance();&#10;            HttpServletResponse response = (HttpServletResponse) facesContext.getExternalContext().getResponse();&#10;&#10;            response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);&#10;            response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment; filename=\&quot;tasks_report_&quot; +&#10;                    new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;).format(new Date()) + &quot;.xlsx\&quot;&quot;);&#10;&#10;            // Write workbook to response&#10;            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();&#10;            workbook.write(outputStream);&#10;            workbook.close();&#10;&#10;            response.getOutputStream().write(outputStream.toByteArray());&#10;            response.getOutputStream().flush();&#10;            response.getOutputStream().close();&#10;&#10;            facesContext.responseComplete();&#10;&#10;        } catch (IOException e) {&#10;            e.printStackTrace();&#10;            // Handle error - you might want to add FacesMessage here&#10;        }&#10;    }&#10;&#10;&#10;&#10;    // Getters and Setters&#10;    public String getTaskDescription() {&#10;        return taskDescription;&#10;    }&#10;&#10;    public void setTaskDescription(String taskDescription) {&#10;        this.taskDescription = taskDescription;&#10;    }&#10;&#10;    public Boolean getIsCompleted() {&#10;        return isCompleted;&#10;    }&#10;&#10;    public void setIsCompleted(Boolean isCompleted) {&#10;        this.isCompleted = isCompleted;&#10;    }&#10;&#10;    public Boolean getIsDone() {&#10;        return isDone;&#10;    }&#10;&#10;    public void setIsDone(Boolean isDone) {&#10;        this.isDone = isDone;&#10;    }&#10;&#10;    public Date getFromDate() {&#10;        return fromDate;&#10;    }&#10;&#10;    public void setFromDate(Date fromDate) {&#10;        this.fromDate = fromDate;&#10;    }&#10;&#10;    public Date getToDate() {&#10;        return toDate;&#10;    }&#10;&#10;    public void setToDate(Date toDate) {&#10;        this.toDate = toDate;&#10;    }&#10;&#10;    public UserAlias getAssignee() {&#10;        return assignee;&#10;    }&#10;&#10;    public void setAssignee(UserAlias assignee) {&#10;        this.assignee = assignee;&#10;    }&#10;&#10;    public List&lt;Task&gt; getSearchResults() {&#10;        return searchResults;&#10;    }&#10;&#10;    public void setSearchResults(List&lt;Task&gt; searchResults) {&#10;        this.searchResults = searchResults;&#10;    }&#10;&#10;    public List&lt;UserAlias&gt; getUserAliasList() {&#10;        return userAliasList;&#10;    }&#10;&#10;    public void setUserAliasList(List&lt;UserAlias&gt; userAliasList) {&#10;        this.userAliasList = userAliasList;&#10;    }&#10;&#10;    // New getters and setters&#10;    public Company getCompany() {&#10;        return company;&#10;    }&#10;&#10;    public void setCompany(Company company) {&#10;        this.company = company;&#10;    }&#10;&#10;    public EquipmentCategory getEquipmentCategory() {&#10;        return equipmentCategory;&#10;    }&#10;&#10;    public void setEquipmentCategory(EquipmentCategory equipmentCategory) {&#10;        this.equipmentCategory = equipmentCategory;&#10;    }&#10;&#10;    public ServiceType getServiceType() {&#10;        return serviceType;&#10;    }&#10;&#10;    public void setServiceType(ServiceType serviceType) {&#10;        this.serviceType = serviceType;&#10;    }&#10;&#10;    public UserAlias getAssigner() {&#10;        return assigner;&#10;    }&#10;&#10;    public void setAssigner(UserAlias assigner) {&#10;        this.assigner = assigner;&#10;    }&#10;&#10;    public Date getCompletedFromDate() {&#10;        return completedFromDate;&#10;    }&#10;&#10;    public void setCompletedFromDate(Date completedFromDate) {&#10;        this.completedFromDate = completedFromDate;&#10;    }&#10;&#10;    public Date getCompletedToDate() {&#10;        return completedToDate;&#10;    }&#10;&#10;    public void setCompletedToDate(Date completedToDate) {&#10;        this.completedToDate = completedToDate;&#10;    }&#10;&#10;    public Date getDoneFromDate() {&#10;        return doneFromDate;&#10;    }&#10;&#10;    public void setDoneFromDate(Date doneFromDate) {&#10;        this.doneFromDate = doneFromDate;&#10;    }&#10;&#10;    public Date getDoneToDate() {&#10;        return doneToDate;&#10;    }&#10;&#10;    public void setDoneToDate(Date doneToDate) {&#10;        this.doneToDate = doneToDate;&#10;    }&#10;&#10;    public String getTaskStatus() {&#10;        return taskStatus;&#10;    }&#10;&#10;    public void setTaskStatus(String taskStatus) {&#10;        this.taskStatus = taskStatus;&#10;    }&#10;&#10;    public List&lt;Company&gt; getCompanyList() {&#10;        return companyList;&#10;    }&#10;&#10;    public void setCompanyList(List&lt;Company&gt; companyList) {&#10;        this.companyList = companyList;&#10;    }&#10;&#10;    public List&lt;EquipmentCategory&gt; getEquipmentCategoryList() {&#10;        return equipmentCategoryList;&#10;    }&#10;&#10;    public void setEquipmentCategoryList(List&lt;EquipmentCategory&gt; equipmentCategoryList) {&#10;        this.equipmentCategoryList = equipmentCategoryList;&#10;    }&#10;&#10;    public List&lt;ServiceType&gt; getServiceTypeList() {&#10;        return serviceTypeList;&#10;    }&#10;&#10;    public void setServiceTypeList(List&lt;ServiceType&gt; serviceTypeList) {&#10;        this.serviceTypeList = serviceTypeList;&#10;    }&#10;&#10;    // Work order filter getter/setter&#10;    public String getWorkOrderFilter() {&#10;        return workOrderFilter;&#10;    }&#10;&#10;    public void setWorkOrderFilter(String workOrderFilter) {&#10;        this.workOrderFilter = workOrderFilter;&#10;    }&#10;&#10;    /**&#10;     * Compute a canonical work-order string for a Task.&#10;     * Preference order:&#10;     *  1) Correspondence id (first correspondenceTask) -&gt; String.valueOf(id)&#10;     *  2) EquipmentInspectionForm.jobNo&#10;     *  3) EmpCertification.certNumber (if applicable)&#10;     *  4) null if none&#10;     */&#10;    private String getWorkOrderForTask(Task task) {&#10;        if (task == null) return null;&#10;        try {&#10;            // 1) correspondence id&#10;            if (task.getCorrespondenceTasks() != null &amp;&amp; !task.getCorrespondenceTasks().isEmpty()) {&#10;                Object first = task.getCorrespondenceTasks().iterator().next();&#10;                if (first instanceof com.smat.ins.model.entity.CorrespondenceTask) {&#10;                    com.smat.ins.model.entity.CorrespondenceTask ct = (com.smat.ins.model.entity.CorrespondenceTask) first;&#10;                    if (ct.getCorrespondence() != null &amp;&amp; ct.getCorrespondence().getId() != null) {&#10;                        return String.valueOf(ct.getCorrespondence().getId());&#10;                    }&#10;                }&#10;            }&#10;&#10;            // 2) EquipmentInspectionForm.jobNo&#10;            try {&#10;                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                if (eif != null &amp;&amp; eif.getJobNo() != null &amp;&amp; !eif.getJobNo().trim().isEmpty())&#10;                    return eif.getJobNo();&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            // 3) EmpCertification.certNumber&#10;            try {&#10;                EmpCertification ec = empCertificationService.getBy(task.getId());&#10;                if (ec != null &amp;&amp; ec.getCertNumber() != null &amp;&amp; !ec.getCertNumber().trim().isEmpty())&#10;                    return ec.getCertNumber();&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;        } catch (Exception e) {&#10;            // swallow - best-effort only&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // Public wrapper for use in EL to get normalized work order key (never null)&#10;    public String getWorkOrderKey(Task task) {&#10;        String k = getWorkOrderForTask(task);&#10;        return k == null ? &quot;No Work Order&quot; : k;&#10;    }&#10;&#10;    /**&#10;     * Group searchResults by canonical work order string. Returns an ordered map (insertion order).&#10;     */&#10;    public Map&lt;String, List&lt;Task&gt;&gt; getGroupedResultsByWorkOrder() {&#10;        if (groupedResultsByWorkOrder != null) return groupedResultsByWorkOrder;&#10;        groupedResultsByWorkOrder = new LinkedHashMap&lt;&gt;();&#10;        if (searchResults == null) return groupedResultsByWorkOrder;&#10;        for (Task t : searchResults) {&#10;            String key = getWorkOrderForTask(t);&#10;            if (key == null) key = &quot;No Work Order&quot;;&#10;            List&lt;Task&gt; list = groupedResultsByWorkOrder.get(key);&#10;            if (list == null) {&#10;                list = new ArrayList&lt;&gt;();&#10;                groupedResultsByWorkOrder.put(key, list);&#10;            }&#10;            list.add(t);&#10;        }&#10;        return groupedResultsByWorkOrder;&#10;    }&#10;&#10;}&#10;" />
              <option name="updatedContent" value="package com.smat.ins.view.bean;&#10;&#10;import java.io.Serializable;&#10;import java.util.ArrayList;&#10;import java.util.Date;&#10;import java.util.List;&#10;import java.util.Set;&#10;import java.util.Map;&#10;import java.util.LinkedHashMap;&#10;import java.util.HashMap;&#10;&#10;import javax.annotation.PostConstruct;&#10;import javax.faces.view.ViewScoped;&#10;import javax.inject.Inject;&#10;import javax.inject.Named;&#10;&#10;import com.smat.ins.model.entity.Company;&#10;import com.smat.ins.model.entity.EmpCertification;&#10;import com.smat.ins.model.entity.EquipmentCategory;&#10;import com.smat.ins.model.entity.EquipmentInspectionForm;&#10;import com.smat.ins.model.entity.InspectionFormWorkflow;&#10;import com.smat.ins.model.entity.ServiceType;&#10;import com.smat.ins.model.entity.Task;&#10;import com.smat.ins.model.entity.UserAlias;&#10;import com.smat.ins.model.service.CompanyService;&#10;import com.smat.ins.model.service.EmpCertificationService;&#10;import com.smat.ins.model.service.EquipmentCategoryService;&#10;import com.smat.ins.model.service.EquipmentInspectionFormService;&#10;import com.smat.ins.model.service.ServiceTypeService;&#10;import com.smat.ins.model.service.TaskService;&#10;import com.smat.ins.model.service.UserAliasService;&#10;import com.smat.ins.util.BeanUtility;&#10;import org.apache.poi.ss.usermodel.*;&#10;import org.apache.poi.xssf.usermodel.XSSFWorkbook;&#10;import javax.faces.context.FacesContext;&#10;import javax.servlet.http.HttpServletResponse;&#10;import java.io.ByteArrayOutputStream;&#10;import java.io.IOException;&#10;import java.text.SimpleDateFormat;&#10;import java.util.Date;&#10;import java.util.List;&#10;&#10;&#10;@Named&#10;@ViewScoped&#10;public class TaskSearchBean implements Serializable {&#10;&#10;    private static final long serialVersionUID = 1L;&#10;&#10;    // Search criteria fields&#10;    private String taskDescription;&#10;    private Boolean isCompleted;&#10;    private Boolean isDone;&#10;    private Date fromDate;&#10;    private Date toDate;&#10;    private UserAlias assignee;&#10;    private UserAlias reviewer;&#10;&#10;    // New search criteria fields&#10;    private Company company;&#10;    private EquipmentCategory equipmentCategory;&#10;    private ServiceType serviceType;&#10;    private UserAlias assigner;&#10;    private Date completedFromDate;&#10;    private Date completedToDate;&#10;    private Date doneFromDate;&#10;    private Date doneToDate;&#10;    private String taskStatus; // Combined status filter&#10;    private String workOrderFilter; // search by work order / correspondence id or jobNo&#10;&#10;    // Results&#10;    private List&lt;Task&gt; searchResults = new ArrayList&lt;&gt;();&#10;    // cached grouped results by work order (computed on demand)&#10;    private Map&lt;String, List&lt;Task&gt;&gt; groupedResultsByWorkOrder;&#10;    private List&lt;UserAlias&gt; userAliasList = new ArrayList&lt;&gt;();&#10;    private List&lt;Company&gt; companyList = new ArrayList&lt;&gt;();&#10;    private List&lt;EquipmentCategory&gt; equipmentCategoryList = new ArrayList&lt;&gt;();&#10;    private List&lt;ServiceType&gt; serviceTypeList = new ArrayList&lt;&gt;();&#10;&#10;    // Services&#10;    private TaskService taskService;&#10;    private UserAliasService userAliasService;&#10;    private CompanyService companyService;&#10;    private EquipmentCategoryService equipmentCategoryService;&#10;    private ServiceTypeService serviceTypeService;&#10;    private EquipmentInspectionFormService equipmentInspectionFormService;&#10;    private EmpCertificationService empCertificationService;&#10;&#10;    @Inject&#10;    private LoginBean loginBean;&#10;&#10;    @PostConstruct&#10;    public void init() {&#10;        taskService = (TaskService) BeanUtility.getBean(&quot;taskService&quot;);&#10;        userAliasService = (UserAliasService) BeanUtility.getBean(&quot;userAliasService&quot;);&#10;        companyService = (CompanyService) BeanUtility.getBean(&quot;companyService&quot;);&#10;        equipmentCategoryService = (EquipmentCategoryService) BeanUtility.getBean(&quot;equipmentCategoryService&quot;);&#10;        serviceTypeService = (ServiceTypeService) BeanUtility.getBean(&quot;serviceTypeService&quot;);&#10;        equipmentInspectionFormService = (EquipmentInspectionFormService) BeanUtility&#10;                .getBean(&quot;equipmentInspectionFormService&quot;);&#10;        empCertificationService = (EmpCertificationService) BeanUtility.getBean(&quot;empCertificationService&quot;);&#10;        try {&#10;            userAliasList = userAliasService.findAll();&#10;            companyList = companyService.findAll();&#10;            equipmentCategoryList = equipmentCategoryService.findAll();&#10;            serviceTypeList = serviceTypeService.findAll();&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;        }&#10;    }&#10;&#10;    public void searchTasks() {&#10;        try {&#10;            // Get all tasks first (you might want to implement more specific search methods&#10;            // in TaskService)&#10;            searchResults = taskService.findAll();&#10;&#10;            // Apply filters in memory (or better, implement these filters in your DAO)&#10;            if (taskDescription != null &amp;&amp; !taskDescription.isEmpty()) {&#10;                searchResults.removeIf(task -&gt; task.getTaskDescription() == null&#10;                        || !task.getTaskDescription().toLowerCase().contains(taskDescription.toLowerCase()));&#10;            }&#10;&#10;            if (isCompleted != null) {&#10;                searchResults.removeIf(task -&gt; !isCompleted.equals(task.getIsCompleted()));&#10;            }&#10;&#10;            if (isDone != null) {&#10;                searchResults.removeIf(task -&gt; !isDone.equals(task.getIsDone()));&#10;            }&#10;&#10;            if (fromDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().before(fromDate));&#10;            }&#10;&#10;            if (toDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getCreatedDate() == null || task.getCreatedDate().after(toDate));&#10;            }&#10;&#10;            if (assignee != null) {&#10;                searchResults.removeIf(task -&gt; task.getUserAliasByAssignTo() == null&#10;                        || !assignee.getId().equals(task.getUserAliasByAssignTo().getId()));&#10;            }&#10;&#10;            // New filters&#10;            if (company != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompany() == null || !company.getId().equals(task.getCompany().getId()));&#10;            }&#10;&#10;            if (equipmentCategory != null) {&#10;                searchResults.removeIf(task -&gt; task.getEquipmentCategory() == null&#10;                        || !equipmentCategory.getId().equals(task.getEquipmentCategory().getId()));&#10;            }&#10;&#10;            if (serviceType != null) {&#10;                searchResults.removeIf(task -&gt; task.getServiceType() == null&#10;                        || !serviceType.getId().equals(task.getServiceType().getId()));&#10;            }&#10;&#10;            if (assigner != null) {&#10;                searchResults.removeIf(task -&gt; task.getUserAliasByAssigner() == null&#10;                        || !assigner.getId().equals(task.getUserAliasByAssigner().getId()));&#10;            }&#10;&#10;            // Reviewer filter: map to form-level ReviewedBy (equipment inspection or emp certification)&#10;            if (reviewer != null) {&#10;                final com.smat.ins.model.entity.SysUser reviewerSysUser = reviewer.getSysUserBySysUser();&#10;                searchResults.removeIf(task -&gt; {&#10;                    try {&#10;                        if (task.getEquipmentCategory() != null) {&#10;                            EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                            if (eif != null &amp;&amp; eif.getSysUserByReviewedBy() != null) {&#10;                                return !reviewerSysUser.getId().equals(eif.getSysUserByReviewedBy().getId());&#10;                            }&#10;                            return true; // no form or no reviewer -&gt; exclude&#10;                        } else {&#10;                            EmpCertification ec = empCertificationService.getBy(task.getId());&#10;                            if (ec != null &amp;&amp; ec.getSysUserByReviewedBy() != null) {&#10;                                return !reviewerSysUser.getId().equals(ec.getSysUserByReviewedBy().getId());&#10;                            }&#10;                            return true; // no cert or no reviewer -&gt; exclude&#10;                        }&#10;                    } catch (Exception e) {&#10;                        return true;&#10;                    }&#10;                });&#10;            }&#10;&#10;            if (completedFromDate != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().before(completedFromDate));&#10;            }&#10;&#10;            if (completedToDate != null) {&#10;                searchResults.removeIf(&#10;                        task -&gt; task.getCompletedDate() == null || task.getCompletedDate().after(completedToDate));&#10;            }&#10;&#10;            if (doneFromDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().before(doneFromDate));&#10;            }&#10;&#10;            if (doneToDate != null) {&#10;                searchResults.removeIf(task -&gt; task.getDoneDate() == null || task.getDoneDate().after(doneToDate));&#10;            }&#10;&#10;            // Task status filter&#10;            if (taskStatus != null &amp;&amp; !taskStatus.isEmpty()) {&#10;                switch (taskStatus) {&#10;                    case &quot;pending&quot;:&#10;                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                    case &quot;completed&quot;:&#10;                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsCompleted()));&#10;                        break;&#10;                    case &quot;done&quot;:&#10;                        searchResults.removeIf(task -&gt; !Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                    case &quot;in_progress&quot;:&#10;                        searchResults.removeIf(task -&gt; Boolean.TRUE.equals(task.getIsCompleted())&#10;                                || Boolean.TRUE.equals(task.getIsDone()));&#10;                        break;&#10;                }&#10;            }&#10;            // Work order filter (search by correspondence id or jobNo)&#10;            if (workOrderFilter != null &amp;&amp; !workOrderFilter.trim().isEmpty()) {&#10;                final String filter = workOrderFilter.trim().toLowerCase();&#10;                searchResults.removeIf(task -&gt; {&#10;                    try {&#10;                        String w = getWorkOrderForTask(task);&#10;                        return w == null || !w.toLowerCase().contains(filter);&#10;                    } catch (Exception e) {&#10;                        return true;&#10;                    }&#10;                });&#10;            }&#10;&#10;            // reset grouped cache so UI will recompute&#10;            groupedResultsByWorkOrder = null;&#10;&#10;        } catch (Exception e) {&#10;            e.printStackTrace();&#10;            // Handle error&#10;        }&#10;    }&#10;&#10;    // الدالة العامة التي تُرجع تسمية الحالة (تُستخدم في الـ XHTML)&#10;    public String getInspectionFormWorkflowStatus(Task task) {&#10;        TaskStatus status = resolveTaskStatus(task);&#10;        return status != null ? status.getLabel() : TaskStatus.PENDING.getLabel();&#10;    }&#10;&#10;    private TaskStatus resolveTaskStatus(Task task) {&#10;        if (task == null) return TaskStatus.PENDING;&#10;&#10;        try {&#10;            // 1) Finished (طباعة/إغلاق نهائي)&#10;            if (task.getDoneDate() != null) return TaskStatus.FINISHED;&#10;&#10;            // 2) Completed (مهام مكتملة لكن ربما لم تُطبع بعد)&#10;            if (task.getCompletedDate() != null) return TaskStatus.COMPLETED;&#10;&#10;            // 3) افتح workflows المتعلّقة بالتفتيش أولاً (equipment)&#10;            try {&#10;                if (task.getInspectionFormWorkflows() != null &amp;&amp; !task.getInspectionFormWorkflows().isEmpty()) {&#10;                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                    Set&lt;com.smat.ins.model.entity.InspectionFormWorkflow&gt; flows = task.getInspectionFormWorkflows();&#10;                    for (com.smat.ins.model.entity.InspectionFormWorkflow wf : flows) {&#10;                        if (wf == null || wf.getWorkflowDefinition() == null || wf.getWorkflowDefinition().getStep() == null) continue;&#10;                        String name = wf.getWorkflowDefinition().getStep().getEnglishName();&#10;                        if (name == null) continue;&#10;                        String ln = name.toLowerCase();&#10;&#10;                        // Inspect / Submitted =&gt; Inspected&#10;                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;&#10;                        // Any review-related wording =&gt; Inspected (Under review)&#10;                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                        }&#10;&#10;                        // Approved/Completed/Finished =&gt; Completed (or Finished if explicit)&#10;                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;&#10;                        // Rejected =&gt; Rejected&#10;                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;&#10;                        // Legacy fixed/repair wording =&gt; treat as Finished now&#10;                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- changed: map legacy fixed -&gt; Finished&#10;                        }&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore and fallback */ }&#10;&#10;            // 4) EmpCertification workflows (Employee training)&#10;            try {&#10;                if (task.getEmpCertificationWorkflows() != null &amp;&amp; !task.getEmpCertificationWorkflows().isEmpty()) {&#10;                    @SuppressWarnings(&quot;unchecked&quot;)&#10;                    Set&lt;com.smat.ins.model.entity.EmpCertificationWorkflow&gt; ewfs = task.getEmpCertificationWorkflows();&#10;                    for (com.smat.ins.model.entity.EmpCertificationWorkflow ew : ewfs) {&#10;                        if (ew == null || ew.getWorkflowDefinition() == null || ew.getWorkflowDefinition().getStep() == null) continue;&#10;                        String name = ew.getWorkflowDefinition().getStep().getEnglishName();&#10;                        if (name == null) continue;&#10;                        String ln = name.toLowerCase();&#10;&#10;                        if (ln.contains(&quot;submitted&quot;) || ln.contains(&quot;inspected&quot;)) return TaskStatus.INSPECTED;&#10;&#10;                        if (ln.contains(&quot;review&quot;) || ln.contains(&quot;under review&quot;) || ln.contains(&quot;in review&quot;)) {&#10;                            return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                        }&#10;&#10;                        if (ln.contains(&quot;approved&quot;) || ln.contains(&quot;completed&quot;) || ln.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;&#10;                        if (ln.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;&#10;                        if (ln.contains(&quot;fixed&quot;) || ln.contains(&quot;repaired&quot;) || ln.contains(&quot;repair completed&quot;) || ln.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- changed here too&#10;                        }&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore and fallback */ }&#10;&#10;            // 5) Fallback: check related forms loaded via services&#10;            try {&#10;                EmpCertification empCert = empCertificationService.getBy(task.getId());&#10;                if (empCert != null) {&#10;                    if (empCert.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                    if (empCert.getSysUserByInspectedBy() != null) return TaskStatus.INSPECTED;&#10;                    if (empCert.getStatus() != null &amp;&amp; !empCert.getStatus().trim().isEmpty()) {&#10;                        String st = empCert.getStatus().toLowerCase();&#10;                        if (st.contains(&quot;approved&quot;) || st.contains(&quot;completed&quot;) || st.contains(&quot;finished&quot;)) return TaskStatus.COMPLETED;&#10;                        if (st.contains(&quot;rejected&quot;)) return TaskStatus.REJECTED;&#10;                        if (st.contains(&quot;fixed&quot;) || st.contains(&quot;repaired&quot;) || st.contains(&quot;repair completed&quot;) || st.contains(&quot;issue fixed&quot;)) {&#10;                            return TaskStatus.FINISHED; // &lt;-- legacy -&gt; finished&#10;                        }&#10;                        if (st.contains(&quot;review&quot;) || st.contains(&quot;under review&quot;)) return TaskStatus.INSPECTED_UNDER_REVIEW;&#10;                    }&#10;                }&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            try {&#10;                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                if (eif != null) {&#10;                    if (eif.getSysUserByReviewedBy() != null) return TaskStatus.REVIEWED;&#10;                    if (eif.getSysUserByInspectionBy() != null) return TaskStatus.INSPECTED;&#10;                    // optionally check textual fields on the form if you have a status field there&#10;                }&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            // 6) If assigned to someone -&gt; Assigned&#10;            if (task.getUserAliasByAssignTo() != null) return TaskStatus.ASSIGNED;&#10;&#10;        } catch (Exception ex) {&#10;            ex.printStackTrace();&#10;        }&#10;&#10;        // Default&#10;        return TaskStatus.PENDING;&#10;    }&#10;&#10;&#10;&#10;&#10;&#10;    public void clearSearch() {&#10;        taskDescription = null;&#10;        isCompleted = null;&#10;        isDone = null;&#10;        fromDate = null;&#10;        toDate = null;&#10;        assignee = null;&#10;        reviewer = null;&#10;&#10;        // Clear new filters&#10;        company = null;&#10;        equipmentCategory = null;&#10;        serviceType = null;&#10;        assigner = null;&#10;        completedFromDate = null;&#10;        completedToDate = null;&#10;        doneFromDate = null;&#10;        doneToDate = null;&#10;        taskStatus = null;&#10;    workOrderFilter = null;&#10;        searchResults.clear();&#10;        groupedResultsByWorkOrder = null;&#10;    }&#10;&#10;    public String getReviewerTask(Task task) {&#10;        if (task.getEquipmentCategory() != null) {&#10;            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;            if (equipmentInspectionForm != null)&#10;                if (equipmentInspectionForm.getSysUserByReviewedBy() != null)&#10;                    return equipmentInspectionForm.getSysUserByReviewedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        } else {&#10;            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;            if (empCertification != null)&#10;                if (empCertification.getSysUserByReviewedBy() != null)&#10;                    return empCertification.getSysUserByReviewedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        }&#10;&#10;        return &quot;Not assigned&quot;;&#10;    }&#10;    public static enum TaskStatus {&#10;        PENDING(&quot;Pending&quot;),&#10;        ASSIGNED(&quot;Assigned&quot;),&#10;        INSPECTED(&quot;Inspected&quot;),&#10;        INSPECTED_UNDER_REVIEW(&quot;Inspected (Under review)&quot;),&#10;        REVIEWED(&quot;Reviewed&quot;),&#10;        COMPLETED(&quot;Completed&quot;),&#10;        FINISHED(&quot;Finished&quot;),&#10;        REJECTED(&quot;Rejected&quot;),&#10;        ON_HOLD(&quot;On Hold&quot;),&#10;        CANCELLED(&quot;Cancelled&quot;),&#10;        RESOLVED(&quot;Resolved&quot;); // اختياري إن كنت تستعمله&#10;&#10;        private final String label;&#10;        TaskStatus(String label) { this.label = label; }&#10;        public String getLabel() { return label; }&#10;        @Override public String toString() { return label; }&#10;    }&#10;    public String getIconForStatusLabel(String statusLabel) {&#10;        if (statusLabel == null) return &quot;pi-clock&quot;;&#10;        String s = statusLabel.toLowerCase();&#10;        if (s.contains(&quot;assigned&quot;)) return &quot;pi-user-plus&quot;;&#10;        if (s.contains(&quot;inspected&quot;) &amp;&amp; s.contains(&quot;under review&quot;)) return &quot;pi-eye&quot;;&#10;        if (s.contains(&quot;inspected&quot;)) return &quot;pi-search&quot;;&#10;        if (s.contains(&quot;reviewed&quot;)) return &quot;pi-check&quot;;&#10;        if (s.contains(&quot;completed&quot;)) return &quot;pi-check&quot;;&#10;        if (s.contains(&quot;finished&quot;) || s.contains(&quot;done&quot;)) return &quot;pi-check-circle&quot;; // covers legacy fixed -&gt; finished&#10;        if (s.contains(&quot;resolved&quot;)) return &quot;pi-check-circle&quot;;&#10;        if (s.contains(&quot;rejected&quot;)) return &quot;pi-times&quot;;&#10;        if (s.contains(&quot;hold&quot;) || s.contains(&quot;on hold&quot;)) return &quot;pi-pause&quot;;&#10;        if (s.contains(&quot;cancel&quot;)) return &quot;pi-ban&quot;;&#10;        return &quot;pi-clock&quot;;&#10;    }&#10;&#10;    public String getStatusCssClass(String statusLabel) {&#10;        if (statusLabel == null) return &quot;status-badge pending&quot;;&#10;        // normalize to safe token: lowercase, non-alnum -&gt; dash, collapse dashes&#10;        String token = statusLabel.toLowerCase()&#10;                .replaceAll(&quot;[^a-z0-9]+&quot;, &quot;-&quot;)   // replace non-alphanumeric with hyphen&#10;                .replaceAll(&quot;^-+|-+$&quot;, &quot;&quot;)       // trim leading/trailing hyphens&#10;                .replaceAll(&quot;-{2,}&quot;, &quot;-&quot;);       // collapse multiple hyphens&#10;        if (token.isEmpty()) token = &quot;pending&quot;;&#10;        return &quot;status-badge &quot; + token; // e.g. &quot;status-badge inspected-under-review&quot;&#10;    }&#10;&#10;    public String getInspectorTask(Task task) {&#10;        if (task.getEquipmentCategory() != null) {&#10;            EquipmentInspectionForm equipmentInspectionForm = equipmentInspectionFormService.getBy(task.getId());&#10;            if (equipmentInspectionForm != null)&#10;                if (equipmentInspectionForm.getSysUserByInspectionBy() != null)&#10;                    return equipmentInspectionForm.getSysUserByInspectionBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        } else {&#10;            EmpCertification empCertification = empCertificationService.getBy(task.getId());&#10;            if (empCertification != null)&#10;                if (empCertification.getSysUserByInspectedBy() != null)&#10;                    return empCertification.getSysUserByInspectedBy().getDisplayName();&#10;                else&#10;                    return &quot;Not assigned&quot;;&#10;        }&#10;&#10;        return &quot;Not assigned&quot;;&#10;    }&#10;    public void exportToExcel() {&#10;        try {&#10;            // Create workbook&#10;            Workbook workbook = new XSSFWorkbook();&#10;            Sheet sheet = workbook.createSheet(&quot;Tasks Report&quot;);&#10;&#10;            // Create header style&#10;            CellStyle headerStyle = workbook.createCellStyle();&#10;            Font headerFont = workbook.createFont();&#10;            headerFont.setBold(true);&#10;            headerFont.setColor(IndexedColors.WHITE.getIndex());&#10;            headerStyle.setFont(headerFont);&#10;            headerStyle.setFillForegroundColor(IndexedColors.DARK_BLUE.getIndex());&#10;            headerStyle.setFillPattern(FillPatternType.SOLID_FOREGROUND);&#10;            headerStyle.setBorderBottom(BorderStyle.THIN);&#10;            headerStyle.setBorderTop(BorderStyle.THIN);&#10;            headerStyle.setBorderLeft(BorderStyle.THIN);&#10;            headerStyle.setBorderRight(BorderStyle.THIN);&#10;            headerStyle.setAlignment(HorizontalAlignment.CENTER);&#10;&#10;            // Create data style&#10;            CellStyle dataStyle = workbook.createCellStyle();&#10;            dataStyle.setBorderBottom(BorderStyle.THIN);&#10;            dataStyle.setBorderTop(BorderStyle.THIN);&#10;            dataStyle.setBorderLeft(BorderStyle.THIN);&#10;            dataStyle.setBorderRight(BorderStyle.THIN);&#10;&#10;            // Create date style&#10;            CellStyle dateStyle = workbook.createCellStyle();&#10;            dateStyle.setBorderBottom(BorderStyle.THIN);&#10;            dateStyle.setBorderTop(BorderStyle.THIN);&#10;            dateStyle.setBorderLeft(BorderStyle.THIN);&#10;            dateStyle.setBorderRight(BorderStyle.THIN);&#10;            CreationHelper createHelper = workbook.getCreationHelper();&#10;            dateStyle.setDataFormat(createHelper.createDataFormat().getFormat(&quot;yyyy-mm-dd&quot;));&#10;&#10;            // Create header row (including Work Order as first column)&#10;            Row headerRow = sheet.createRow(0);&#10;            String[] headers = {&#10;                    &quot;Work Order&quot;, &quot;Task ID&quot;, &quot;Company&quot;, &quot;Equipment&quot;, &quot;Service&quot;,&#10;                    &quot;Assigner&quot;, &quot;Inspector&quot;, &quot;Reviewer&quot;, &quot;Status&quot;,&#10;                    &quot;Created Date&quot;, &quot;Task Description&quot;&#10;            };&#10;&#10;            for (int i = 0; i &lt; headers.length; i++) {&#10;                Cell cell = headerRow.createCell(i);&#10;                cell.setCellValue(headers[i]);&#10;                cell.setCellStyle(headerStyle);&#10;            }&#10;&#10;            // Populate data rows&#10;            int rowNum = 1;&#10;&#10;            for (Task task : searchResults) {&#10;                Row row = sheet.createRow(rowNum++);&#10;&#10;                // Work Order (use public wrapper to guarantee non-null label)&#10;                Cell cell0 = row.createCell(0);&#10;                String workOrder = getWorkOrderKey(task);&#10;                cell0.setCellValue(workOrder != null ? workOrder : &quot;&quot;);&#10;                cell0.setCellStyle(dataStyle);&#10;&#10;                // Task ID&#10;                Cell cell1 = row.createCell(1);&#10;                if (task.getId() != null) {&#10;                    // depending on type of id, set as numeric or string&#10;                    try {&#10;                        cell1.setCellValue(Long.parseLong(String.valueOf(task.getId())));&#10;                    } catch (Exception ex) {&#10;                        cell1.setCellValue(String.valueOf(task.getId()));&#10;                    }&#10;                } else {&#10;                    cell1.setCellValue(&quot;&quot;);&#10;                }&#10;                cell1.setCellStyle(dataStyle);&#10;&#10;                // Company&#10;                Cell cell2 = row.createCell(2);&#10;                cell2.setCellValue(task.getCompany() != null ? task.getCompany().getName() : &quot;&quot;);&#10;                cell2.setCellStyle(dataStyle);&#10;&#10;                // Equipment&#10;                Cell cell3 = row.createCell(3);&#10;                cell3.setCellValue(task.getEquipmentCategory() != null ? task.getEquipmentCategory().getName() : &quot;&quot;);&#10;                cell3.setCellStyle(dataStyle);&#10;&#10;                // Service&#10;                Cell cell4 = row.createCell(4);&#10;                cell4.setCellValue(task.getServiceType() != null ? task.getServiceType().getName() : &quot;&quot;);&#10;                cell4.setCellStyle(dataStyle);&#10;&#10;                // Assigner&#10;                Cell cell5 = row.createCell(5);&#10;                String assignerName = &quot;&quot;;&#10;                if (task.getUserAliasByAssigner() != null &amp;&amp; task.getUserAliasByAssigner().getSysUserBySysUser() != null) {&#10;                    assignerName = task.getUserAliasByAssigner().getSysUserBySysUser().getDisplayName();&#10;                }&#10;                cell5.setCellValue(assignerName);&#10;                cell5.setCellStyle(dataStyle);&#10;&#10;                // Inspector&#10;                Cell cell6 = row.createCell(6);&#10;                cell6.setCellValue(getInspectorTask(task));&#10;                cell6.setCellStyle(dataStyle);&#10;&#10;                // Reviewer&#10;                Cell cell7 = row.createCell(7);&#10;                cell7.setCellValue(getReviewerTask(task));&#10;                cell7.setCellStyle(dataStyle);&#10;&#10;                // Status&#10;                Cell cell8 = row.createCell(8);&#10;                cell8.setCellValue(getInspectionFormWorkflowStatus(task));&#10;                cell8.setCellStyle(dataStyle);&#10;&#10;                // Created Date (use proper date cell if available)&#10;                Cell cell9 = row.createCell(9);&#10;                if (task.getCreatedDate() != null) {&#10;                    cell9.setCellValue(task.getCreatedDate());&#10;                    cell9.setCellStyle(dateStyle);&#10;                } else {&#10;                    cell9.setCellValue(&quot;&quot;);&#10;                    cell9.setCellStyle(dataStyle);&#10;                }&#10;&#10;                // Task Description&#10;                Cell cell10 = row.createCell(10);&#10;                cell10.setCellValue(task.getTaskDescription() != null ? task.getTaskDescription() : &quot;&quot;);&#10;                cell10.setCellStyle(dataStyle);&#10;            }&#10;&#10;            // Auto-size columns&#10;            for (int i = 0; i &lt; headers.length; i++) {&#10;                sheet.autoSizeColumn(i);&#10;            }&#10;&#10;            // Prepare response&#10;            FacesContext facesContext = FacesContext.getCurrentInstance();&#10;            HttpServletResponse response = (HttpServletResponse) facesContext.getExternalContext().getResponse();&#10;&#10;            response.setContentType(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;);&#10;            response.setHeader(&quot;Content-Disposition&quot;, &quot;attachment; filename=\&quot;tasks_report_&quot; +&#10;                    new SimpleDateFormat(&quot;yyyyMMdd_HHmmss&quot;).format(new Date()) + &quot;.xlsx\&quot;&quot;);&#10;&#10;            // Write workbook to response&#10;            ByteArrayOutputStream outputStream = new ByteArrayOutputStream();&#10;            workbook.write(outputStream);&#10;            workbook.close();&#10;&#10;            response.getOutputStream().write(outputStream.toByteArray());&#10;            response.getOutputStream().flush();&#10;            response.getOutputStream().close();&#10;&#10;            facesContext.responseComplete();&#10;&#10;        } catch (IOException e) {&#10;            e.printStackTrace();&#10;            // Handle error - you might want to add FacesMessage here&#10;        }&#10;    }&#10;&#10;&#10;    // Getters and Setters&#10;    public String getTaskDescription() {&#10;        return taskDescription;&#10;    }&#10;&#10;    public void setTaskDescription(String taskDescription) {&#10;        this.taskDescription = taskDescription;&#10;    }&#10;&#10;    public Boolean getIsCompleted() {&#10;        return isCompleted;&#10;    }&#10;&#10;    public void setIsCompleted(Boolean isCompleted) {&#10;        this.isCompleted = isCompleted;&#10;    }&#10;&#10;    public Boolean getIsDone() {&#10;        return isDone;&#10;    }&#10;&#10;    public void setIsDone(Boolean isDone) {&#10;        this.isDone = isDone;&#10;    }&#10;&#10;    public Date getFromDate() {&#10;        return fromDate;&#10;    }&#10;&#10;    public void setFromDate(Date fromDate) {&#10;        this.fromDate = fromDate;&#10;    }&#10;&#10;    public Date getToDate() {&#10;        return toDate;&#10;    }&#10;&#10;    public void setToDate(Date toDate) {&#10;        this.toDate = toDate;&#10;    }&#10;&#10;    public UserAlias getAssignee() {&#10;        return assignee;&#10;    }&#10;&#10;    public void setAssignee(UserAlias assignee) {&#10;        this.assignee = assignee;&#10;    }&#10;    public UserAlias getReviewer() { return reviewer; }&#10;    public void setReviewer(UserAlias reviewer) { this.reviewer = reviewer; }&#10;&#10;    public List&lt;Task&gt; getSearchResults() {&#10;        return searchResults;&#10;    }&#10;&#10;    public void setSearchResults(List&lt;Task&gt; searchResults) {&#10;        this.searchResults = searchResults;&#10;    }&#10;&#10;    public List&lt;UserAlias&gt; getUserAliasList() {&#10;        return userAliasList;&#10;    }&#10;&#10;    public void setUserAliasList(List&lt;UserAlias&gt; userAliasList) {&#10;        this.userAliasList = userAliasList;&#10;    }&#10;&#10;    // New getters and setters&#10;    public Company getCompany() {&#10;        return company;&#10;    }&#10;&#10;    public void setCompany(Company company) {&#10;        this.company = company;&#10;    }&#10;&#10;    public EquipmentCategory getEquipmentCategory() {&#10;        return equipmentCategory;&#10;    }&#10;&#10;    public void setEquipmentCategory(EquipmentCategory equipmentCategory) {&#10;        this.equipmentCategory = equipmentCategory;&#10;    }&#10;&#10;    public ServiceType getServiceType() {&#10;        return serviceType;&#10;    }&#10;&#10;    public void setServiceType(ServiceType serviceType) {&#10;        this.serviceType = serviceType;&#10;    }&#10;&#10;    public UserAlias getAssigner() {&#10;        return assigner;&#10;    }&#10;&#10;    public void setAssigner(UserAlias assigner) {&#10;        this.assigner = assigner;&#10;    }&#10;&#10;    public Date getCompletedFromDate() {&#10;        return completedFromDate;&#10;    }&#10;&#10;    public void setCompletedFromDate(Date completedFromDate) {&#10;        this.completedFromDate = completedFromDate;&#10;    }&#10;&#10;    public Date getCompletedToDate() {&#10;        return completedToDate;&#10;    }&#10;&#10;    public void setCompletedToDate(Date completedToDate) {&#10;        this.completedToDate = completedToDate;&#10;    }&#10;&#10;    public Date getDoneFromDate() {&#10;        return doneFromDate;&#10;    }&#10;&#10;    public void setDoneFromDate(Date doneFromDate) {&#10;        this.doneFromDate = doneFromDate;&#10;    }&#10;&#10;    public Date getDoneToDate() {&#10;        return doneToDate;&#10;    }&#10;&#10;    public void setDoneToDate(Date doneToDate) {&#10;        this.doneToDate = doneToDate;&#10;    }&#10;&#10;    public String getTaskStatus() {&#10;        return taskStatus;&#10;    }&#10;&#10;    public void setTaskStatus(String taskStatus) {&#10;        this.taskStatus = taskStatus;&#10;    }&#10;&#10;    public List&lt;Company&gt; getCompanyList() {&#10;        return companyList;&#10;    }&#10;&#10;    public void setCompanyList(List&lt;Company&gt; companyList) {&#10;        this.companyList = companyList;&#10;    }&#10;&#10;    public List&lt;EquipmentCategory&gt; getEquipmentCategoryList() {&#10;        return equipmentCategoryList;&#10;    }&#10;&#10;    public void setEquipmentCategoryList(List&lt;EquipmentCategory&gt; equipmentCategoryList) {&#10;        this.equipmentCategoryList = equipmentCategoryList;&#10;    }&#10;&#10;    public List&lt;ServiceType&gt; getServiceTypeList() {&#10;        return serviceTypeList;&#10;    }&#10;&#10;    public void setServiceTypeList(List&lt;ServiceType&gt; serviceTypeList) {&#10;        this.serviceTypeList = serviceTypeList;&#10;    }&#10;&#10;    // Work order filter getter/setter&#10;    public String getWorkOrderFilter() {&#10;        return workOrderFilter;&#10;    }&#10;&#10;    public void setWorkOrderFilter(String workOrderFilter) {&#10;        this.workOrderFilter = workOrderFilter;&#10;    }&#10;&#10;    /**&#10;     * Compute a canonical work-order string for a Task.&#10;     * Preference order:&#10;     *  1) Correspondence id (first correspondenceTask) -&gt; String.valueOf(id)&#10;     *  2) EquipmentInspectionForm.jobNo&#10;     *  3) EmpCertification.certNumber (if applicable)&#10;     *  4) null if none&#10;     */&#10;    private String getWorkOrderForTask(Task task) {&#10;        if (task == null) return null;&#10;        try {&#10;            // 1) correspondence id&#10;            if (task.getCorrespondenceTasks() != null &amp;&amp; !task.getCorrespondenceTasks().isEmpty()) {&#10;                Object first = task.getCorrespondenceTasks().iterator().next();&#10;                if (first instanceof com.smat.ins.model.entity.CorrespondenceTask) {&#10;                    com.smat.ins.model.entity.CorrespondenceTask ct = (com.smat.ins.model.entity.CorrespondenceTask) first;&#10;                    if (ct.getCorrespondence() != null &amp;&amp; ct.getCorrespondence().getId() != null) {&#10;                        return String.valueOf(ct.getCorrespondence().getId());&#10;                    }&#10;                }&#10;            }&#10;&#10;            // 2) EquipmentInspectionForm.jobNo&#10;            try {&#10;                EquipmentInspectionForm eif = equipmentInspectionFormService.getBy(task.getId());&#10;                if (eif != null &amp;&amp; eif.getJobNo() != null &amp;&amp; !eif.getJobNo().trim().isEmpty())&#10;                    return eif.getJobNo();&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;            // 3) EmpCertification.certNumber&#10;            try {&#10;                EmpCertification ec = empCertificationService.getBy(task.getId());&#10;                if (ec != null &amp;&amp; ec.getCertNumber() != null &amp;&amp; !ec.getCertNumber().trim().isEmpty())&#10;                    return ec.getCertNumber();&#10;            } catch (Exception e) { /* ignore */ }&#10;&#10;        } catch (Exception e) {&#10;            // swallow - best-effort only&#10;        }&#10;        return null;&#10;    }&#10;&#10;    // Public wrapper for use in EL to get normalized work order key (never null)&#10;    public String getWorkOrderKey(Task task) {&#10;        String k = getWorkOrderForTask(task);&#10;        return k == null ? &quot;No Work Order&quot; : k;&#10;    }&#10;&#10;    /**&#10;     * Group searchResults by canonical work order string. Returns an ordered map (insertion order).&#10;     */&#10;    public Map&lt;String, List&lt;Task&gt;&gt; getGroupedResultsByWorkOrder() {&#10;        if (groupedResultsByWorkOrder != null) return groupedResultsByWorkOrder;&#10;        groupedResultsByWorkOrder = new LinkedHashMap&lt;&gt;();&#10;        if (searchResults == null) return groupedResultsByWorkOrder;&#10;        for (Task t : searchResults) {&#10;            String key = getWorkOrderForTask(t);&#10;            if (key == null) key = &quot;No Work Order&quot;;&#10;            List&lt;Task&gt; list = groupedResultsByWorkOrder.get(key);&#10;            if (list == null) {&#10;                list = new ArrayList&lt;&gt;();&#10;                groupedResultsByWorkOrder.put(key, list);&#10;            }&#10;            list.add(t);&#10;        }&#10;        return groupedResultsByWorkOrder;&#10;    }&#10;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/src/main/resources/reports/summary-report.jrxml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/src/main/resources/reports/summary-report.jrxml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;!-- Simple, clean summary report for equipment certificate (fields only) --&gt;&#10;&lt;jasperReport xmlns=&quot;http://jasperreports.sourceforge.net/jasperreports&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://jasperreports.sourceforge.net/jasperreports jasperreport.xsd&quot; name=&quot;summary-report&quot; pageWidth=&quot;595&quot; pageHeight=&quot;842&quot; columnWidth=&quot;515&quot; leftMargin=&quot;40&quot; rightMargin=&quot;40&quot; topMargin=&quot;40&quot; bottomMargin=&quot;40&quot; uuid=&quot;summary-report-uuid&quot;&gt;&#10;    &lt;property name=&quot;ireport.zoom&quot; value=&quot;1.0&quot;/&gt;&#10;    &lt;property name=&quot;ireport.x&quot; value=&quot;0&quot;/&gt;&#10;    &lt;property name=&quot;ireport.y&quot; value=&quot;0&quot;/&gt;&#10;&#10;    &lt;parameter name=&quot;ReportNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;StNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;TsNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;JobNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Company&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Dte&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Ned&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Inspector&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Reviewer&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Result&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;logoLeftPath&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;logoRightPath&quot; class=&quot;java.lang.String&quot;/&gt;&#10;&#10;    &lt;title&gt;&#10;        &lt;band height=&quot;120&quot;&gt;&#10;            &lt;image&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;60&quot;/&gt;&#10;                &lt;imageExpression&gt;&lt;![CDATA[new java.io.File($P{logoLeftPath}).exists() ? $P{logoLeftPath} : &quot;&quot;]]&gt;&lt;/imageExpression&gt;&#10;            &lt;/image&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;120&quot; y=&quot;0&quot; width=&quot;275&quot; height=&quot;60&quot;/&gt;&#10;                &lt;textElement textAlignment=&quot;Center&quot;&gt;&#10;                    &lt;font size=&quot;18&quot; isBold=&quot;true&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Equipment Inspection - Summary&quot;]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;            &lt;image&gt;&#10;                &lt;reportElement x=&quot;420&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;60&quot;/&gt;&#10;                &lt;imageExpression&gt;&lt;![CDATA[new java.io.File($P{logoRightPath}).exists() ? $P{logoRightPath} : &quot;&quot;]]&gt;&lt;/imageExpression&gt;&#10;            &lt;/image&gt;&#10;&#10;            &lt;line&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;70&quot; width=&quot;515&quot; height=&quot;1&quot;/&gt;&#10;            &lt;/line&gt;&#10;&#10;            &lt;!-- Key identifiers row --&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;78&quot; width=&quot;515&quot; height=&quot;18&quot;/&gt;&#10;                &lt;textElement&gt;&#10;                    &lt;font size=&quot;12&quot; isBold=&quot;true&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Report: &quot; + ($P{ReportNo} == null ? &quot;-&quot; : $P{ReportNo}) + &quot;    |    Sticker: &quot; + ($P{StNo} == null ? &quot;-&quot; : $P{StNo})]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;        &lt;/band&gt;&#10;    &lt;/title&gt;&#10;&#10;    &lt;detail&gt;&#10;        &lt;band height=&quot;260&quot;&gt;&#10;            &lt;frame&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;515&quot; height=&quot;260&quot;/&gt;&#10;&#10;                &lt;!-- Two-column key:value layout --&gt;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;6&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Company:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;6&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Company} == null ? &quot;-&quot; : $P{Company}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;30&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Job No:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;30&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{JobNo} == null ? &quot;-&quot; : $P{JobNo}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;340&quot; y=&quot;30&quot; width=&quot;60&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[TS No:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;405&quot; y=&quot;30&quot; width=&quot;105&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{TsNo} == null ? &quot;-&quot; : $P{TsNo}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;56&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Inspection Date:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;56&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Dte} == null ? &quot;-&quot; : $P{Dte}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;340&quot; y=&quot;56&quot; width=&quot;60&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Next Date:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;405&quot; y=&quot;56&quot; width=&quot;105&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Ned} == null ? &quot;-&quot; : $P{Ned}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;86&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Inspector:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;86&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Inspector} == null ? &quot;-&quot; : $P{Inspector}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;110&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Reviewer:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;110&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Reviewer} == null ? &quot;-&quot; : $P{Reviewer}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;134&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Result:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;134&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Result} == null ? &quot;-&quot; : $P{Result}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;!-- Small footer note --&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;210&quot; width=&quot;515&quot; height=&quot;40&quot;/&gt;&#10;                    &lt;textElement textAlignment=&quot;Center&quot;&gt;&#10;                        &lt;font size=&quot;9&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[&quot;This summary contains general report information. For the full certificate and attachments use the provided link.&quot;]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;            &lt;/frame&gt;&#10;        &lt;/band&gt;&#10;    &lt;/detail&gt;&#10;&#10;    &lt;pageFooter&gt;&#10;        &lt;band height=&quot;20&quot;&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;515&quot; height=&quot;18&quot;/&gt;&#10;                &lt;textElement textAlignment=&quot;Right&quot;&gt;&#10;                    &lt;font size=&quot;9&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Generated: &quot; + new java.text.SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;).format(new java.util.Date())]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;        &lt;/band&gt;&#10;    &lt;/pageFooter&gt;&#10;&lt;/jasperReport&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;&#10;&lt;!-- Simple, clean summary report for equipment certificate (fields only) --&gt;&#10;&lt;jasperReport xmlns=&quot;http://jasperreports.sourceforge.net/jasperreports&quot; xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot; xsi:schemaLocation=&quot;http://jasperreports.sourceforge.net/jasperreports jasperreport.xsd&quot; name=&quot;summary-report&quot; pageWidth=&quot;595&quot; pageHeight=&quot;842&quot; columnWidth=&quot;515&quot; leftMargin=&quot;40&quot; rightMargin=&quot;40&quot; topMargin=&quot;40&quot; bottomMargin=&quot;40&quot; uuid=&quot;summary-report-uuid&quot;&gt;&#10;    &lt;property name=&quot;ireport.zoom&quot; value=&quot;1.0&quot;/&gt;&#10;    &lt;property name=&quot;ireport.x&quot; value=&quot;0&quot;/&gt;&#10;    &lt;property name=&quot;ireport.y&quot; value=&quot;0&quot;/&gt;&#10;&#10;    &lt;parameter name=&quot;ReportNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;StNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;TsNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;JobNo&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Company&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Dte&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Ned&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Inspector&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Reviewer&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;Result&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;logoLeftPath&quot; class=&quot;java.lang.String&quot;/&gt;&#10;    &lt;parameter name=&quot;logoRightPath&quot; class=&quot;java.lang.String&quot;/&gt;&#10;&#10;    &lt;title&gt;&#10;        &lt;band height=&quot;120&quot;&gt;&#10;            &lt;image&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;60&quot;/&gt;&#10;                &lt;imageExpression&gt;&lt;![CDATA[new java.io.File($P{logoLeftPath}).exists() ? $P{logoLeftPath} : &quot;&quot;]]&gt;&lt;/imageExpression&gt;&#10;            &lt;/image&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;120&quot; y=&quot;0&quot; width=&quot;275&quot; height=&quot;60&quot;/&gt;&#10;                &lt;textElement textAlignment=&quot;Center&quot;&gt;&#10;                    &lt;font size=&quot;18&quot; isBold=&quot;true&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Equipment Inspection - Summary&quot;]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;            &lt;image&gt;&#10;                &lt;reportElement x=&quot;420&quot; y=&quot;0&quot; width=&quot;100&quot; height=&quot;60&quot;/&gt;&#10;                &lt;imageExpression&gt;&lt;![CDATA[new java.io.File($P{logoRightPath}).exists() ? $P{logoRightPath} : &quot;&quot;]]&gt;&lt;/imageExpression&gt;&#10;            &lt;/image&gt;&#10;&#10;            &lt;line&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;70&quot; width=&quot;515&quot; height=&quot;1&quot;/&gt;&#10;            &lt;/line&gt;&#10;&#10;            &lt;!-- Key identifiers row --&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;78&quot; width=&quot;515&quot; height=&quot;18&quot;/&gt;&#10;                &lt;textElement&gt;&#10;                    &lt;font size=&quot;12&quot; isBold=&quot;true&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Report: &quot; + ($P{ReportNo} == null ? &quot;-&quot; : $P{ReportNo}) + &quot;    |    Sticker: &quot; + ($P{StNo} == null ? &quot;-&quot; : $P{StNo})]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;        &lt;/band&gt;&#10;    &lt;/title&gt;&#10;&#10;    &lt;detail&gt;&#10;        &lt;band height=&quot;260&quot;&gt;&#10;            &lt;frame&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;515&quot; height=&quot;260&quot;/&gt;&#10;&#10;                &lt;!-- Two-column key:value layout --&gt;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;6&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Company:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;6&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Company} == null ? &quot;-&quot; : $P{Company}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;30&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Job No:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;30&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{JobNo} == null ? &quot;-&quot; : $P{JobNo}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;340&quot; y=&quot;30&quot; width=&quot;60&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[TS No:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;405&quot; y=&quot;30&quot; width=&quot;105&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{TsNo} == null ? &quot;-&quot; : $P{TsNo}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;56&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Inspection Date:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;56&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Dte} == null ? &quot;-&quot; : $P{Dte}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;340&quot; y=&quot;56&quot; width=&quot;60&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Next Date:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;405&quot; y=&quot;56&quot; width=&quot;105&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Ned} == null ? &quot;-&quot; : $P{Ned}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;86&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Inspector:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;86&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Inspector} == null ? &quot;-&quot; : $P{Inspector}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;110&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Reviewer:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;110&quot; width=&quot;380&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Reviewer} == null ? &quot;-&quot; : $P{Reviewer}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;staticText&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;134&quot; width=&quot;120&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textElement&gt;&#10;                        &lt;font isBold=&quot;true&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;text&gt;&lt;![CDATA[Result:]]&gt;&lt;/text&gt;&#10;                &lt;/staticText&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;130&quot; y=&quot;134&quot; width=&quot;200&quot; height=&quot;18&quot;/&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[$P{Result} == null ? &quot;-&quot; : $P{Result}]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;&#10;                &lt;!-- Small footer note --&gt;&#10;                &lt;textField&gt;&#10;                    &lt;reportElement x=&quot;0&quot; y=&quot;210&quot; width=&quot;515&quot; height=&quot;40&quot;/&gt;&#10;                    &lt;textElement textAlignment=&quot;Center&quot;&gt;&#10;                        &lt;font size=&quot;9&quot;/&gt;&#10;                    &lt;/textElement&gt;&#10;                    &lt;textFieldExpression&gt;&lt;![CDATA[&quot;This summary contains general report information. For the full certificate and attachments use the provided link.&quot;]]&gt;&lt;/textFieldExpression&gt;&#10;                &lt;/textField&gt;&#10;            &lt;/frame&gt;&#10;        &lt;/band&gt;&#10;    &lt;/detail&gt;&#10;&#10;    &lt;pageFooter&gt;&#10;        &lt;band height=&quot;20&quot;&gt;&#10;            &lt;textField&gt;&#10;                &lt;reportElement x=&quot;0&quot; y=&quot;0&quot; width=&quot;515&quot; height=&quot;18&quot;/&gt;&#10;                &lt;textElement textAlignment=&quot;Right&quot;&gt;&#10;                    &lt;font size=&quot;9&quot;/&gt;&#10;                &lt;/textElement&gt;&#10;                &lt;textFieldExpression&gt;&lt;![CDATA[&quot;Generated: &quot; + new java.text.SimpleDateFormat(&quot;dd/MM/yyyy HH:mm&quot;).format(new java.util.Date())]]&gt;&lt;/textFieldExpression&gt;&#10;            &lt;/textField&gt;&#10;        &lt;/band&gt;&#10;    &lt;/pageFooter&gt;&#10;&lt;/jasperReport&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>