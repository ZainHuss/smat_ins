<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">


	<ui:define name="section-head">
        #{interfaceLabel.addTemplate}
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet library="#{appSetting.resourceLib}"
			name="css/material-theme.css"></h:outputStylesheet>
		<style>
.ui-panelgrid .custom-panel-grid {
	width: 100%;
	border-spacing: 10px;
	border: 1px !important;
}

.ui-panelgrid .custom-panel-grid tr td {
	padding: 10px;
	border: 1px !important;
}

.ui-inputtext {
	width: 100%;
	padding: 8px;
}

body .ui-panelgrid .custom-panel-grid .ui-panelgrid-cell {
	border: 1px solid #dee2e6 !important;
}

.custom-panel-grid thead, tbody, tfoot, tr, td, th {
	border-color: inherit;
	border-style: solid;
	border-width: 1px !important;
}

.ui-commandlink {
	margin-top: 10px;
}

div.ui-wizard-navbar {
	display: inline-block !important;
}

/* Drag and Drop Styles */
.draggable-item {
	cursor: move;
	position: relative;
	transition: all 0.3s ease;
}

.draggable-item:hover {
	background-color: #f0f8ff;
	border: 2px dashed #007bff;
}

.draggable-item.dragging {
	opacity: 0.5;
	transform: scale(0.95);
	z-index: 1000;
}

.drop-zone {
	min-height: 50px;
	border: 2px dashed transparent;
	transition: all 0.3s ease;
	position: relative;
}

.drop-zone.drag-over {
	border-color: #28a745;
	background-color: #f8fff9;
}

.drop-zone.drag-over::before {
	content: "Drop here";
	position: absolute;
	top: 50%;
	left: 50%;
	transform: translate(-50%, -50%);
	color: #28a745;
	font-weight: bold;
	pointer-events: none;
}

.drag-handle {
	display: inline-block;
	cursor: move;
	color: #6c757d;
	margin-right: 5px;
	font-size: 14px;
}

.drag-handle:hover {
	color: #007bff;
}

.column-content-wrapper {
	position: relative;
	min-height: 30px;
}

.empty-drop-zone {
	min-height: 40px;
	border: 1px dashed #ccc;
	display: flex;
	align-items: center;
	justify-content: center;
	color: #999;
	font-style: italic;
}

.empty-drop-zone.drag-over {
	border-color: #28a745;
	background-color: #f8fff9;
	color: #28a745;
}
</style>
		
		<script type="text/javascript">
		//<![CDATA[
		
		// Global variables for drag and drop
		var draggedElement = null;
		var draggedData = null;
		var sourceContainer = null;
		
		// Initialize drag and drop functionality
		function initializeDragDrop() {
			console.log('Initializing drag and drop functionality');
			
			// Add drag handles to existing content items
			addDragHandlesToContent();
			
			// Make content items draggable
			makeContentItemsDraggable();
			
			// Make columns droppable
			makeColumnsDroppable();
		}
		
		// Add drag handles to content items
		function addDragHandlesToContent() {
			var contentItems = document.querySelectorAll('.column-content-wrapper .draggable-item');
			contentItems.forEach(function(item) {
				if (!item.querySelector('.drag-handle')) {
					var handle = document.createElement('span');
					handle.className = 'drag-handle';
					handle.innerHTML = '⋮⋮';
					handle.title = 'Drag to move';
					item.insertBefore(handle, item.firstChild);
				}
			});
		}
		
		// Make content items draggable
		function makeContentItemsDraggable() {
			var draggableItems = document.querySelectorAll('.draggable-item');
			
			draggableItems.forEach(function(item) {
				item.draggable = true;
				
				item.addEventListener('dragstart', function(e) {
					draggedElement = this;
					sourceContainer = this.closest('.ui-panelgrid-cell');
					
					// Store data about the dragged item
					draggedData = {
						html: this.outerHTML,
						rowId: this.getAttribute('data-row-id'),
						columnId: this.getAttribute('data-column-id'),
						contentId: this.getAttribute('data-content-id')
					};
					
					this.classList.add('dragging');
					e.dataTransfer.effectAllowed = 'move';
					e.dataTransfer.setData('text/html', this.outerHTML);
				});
				
				item.addEventListener('dragend', function(e) {
					this.classList.remove('dragging');
					draggedElement = null;
					draggedData = null;
					sourceContainer = null;
				});
			});
		}
		
		// Make columns droppable
		function makeColumnsDroppable() {
			var columns = document.querySelectorAll('.ui-panelgrid-cell');
			
			columns.forEach(function(column) {
				// Ensure column has a content wrapper
				if (!column.querySelector('.column-content-wrapper')) {
					var wrapper = document.createElement('div');
					wrapper.className = 'column-content-wrapper drop-zone';
					
					// Move existing content into wrapper
					while (column.firstChild) {
						wrapper.appendChild(column.firstChild);
					}
					column.appendChild(wrapper);
				}
				
				var dropZone = column.querySelector('.column-content-wrapper');
				
				// Add empty drop zone if no content
				if (dropZone.children.length === 0) {
					var emptyZone = document.createElement('div');
					emptyZone.className = 'empty-drop-zone';
					emptyZone.textContent = 'Drop content here';
					dropZone.appendChild(emptyZone);
				}
				
				dropZone.addEventListener('dragover', function(e) {
					e.preventDefault();
					e.dataTransfer.dropEffect = 'move';
					this.classList.add('drag-over');
				});
				
				dropZone.addEventListener('dragleave', function(e) {
					this.classList.remove('drag-over');
				});
				
				dropZone.addEventListener('drop', function(e) {
					e.preventDefault();
					this.classList.remove('drag-over');
					
					if (draggedElement && this !== sourceContainer.querySelector('.column-content-wrapper')) {
						// Remove empty drop zone if exists
						var emptyZone = this.querySelector('.empty-drop-zone');
						if (emptyZone) {
							emptyZone.remove();
						}
						
						// Clone the dragged element
						var clonedElement = draggedElement.cloneNode(true);
						
						// Remove the original element
						draggedElement.remove();
						
						// Add to new location
						this.appendChild(clonedElement);
						
						// Re-initialize drag and drop for the new element
						makeElementDraggable(clonedElement);
						
						// Add empty zone to source if it's now empty
						var sourceWrapper = sourceContainer.querySelector('.column-content-wrapper');
						if (sourceWrapper && sourceWrapper.children.length === 0) {
							var newEmptyZone = document.createElement('div');
							newEmptyZone.className = 'empty-drop-zone';
							newEmptyZone.textContent = 'Drop content here';
							sourceWrapper.appendChild(newEmptyZone);
						}
						
						// Trigger server-side update if needed
						updateServerSideData();
					}
				});
			});
		}
		
		// Make a single element draggable
		function makeElementDraggable(element) {
			element.draggable = true;
			
			element.addEventListener('dragstart', function(e) {
				draggedElement = this;
				sourceContainer = this.closest('.ui-panelgrid-cell');
				
				draggedData = {
					html: this.outerHTML,
					rowId: this.getAttribute('data-row-id'),
					columnId: this.getAttribute('data-column-id'),
					contentId: this.getAttribute('data-content-id')
				};
				
				this.classList.add('dragging');
				e.dataTransfer.effectAllowed = 'move';
				e.dataTransfer.setData('text/html', this.outerHTML);
			});
			
			element.addEventListener('dragend', function(e) {
				this.classList.remove('dragging');
				draggedElement = null;
				draggedData = null;
				sourceContainer = null;
			});
		}
		
		// Update server-side data after drag and drop
		function updateServerSideData() {
			// This function would typically make an AJAX call to update the server
			// For now, we'll just log the action
			console.log('Content moved - server update needed');
			
			// You can add PrimeFaces remoteCommand here to update the backend
			// Example: PF('updateContentPositions').execute();
		}
		
		// Initialize when document is ready
		document.addEventListener('DOMContentLoaded', function() {
			initializeDragDrop();
		});
		
		// Re-initialize after AJAX updates
		function reinitializeDragDrop() {
			setTimeout(function() {
				initializeDragDrop();
			}, 100);
		}
		
		//]]>
		</script>
	</ui:define>
	<ui:define name="section-content">
		<h:form id="form">

			<p:growl id="messages" showDetail="true" showSummary="false" />
			<div class="card" style="height: auto;">
				<p:staticMessage severity="warn"
					rendered="#{templateDesignBean.isLocked}"
					detail="#{interfaceLabel.templateFormIsLocked}"
					style="margin-right:25%;margin-left:25%;width: 50%;text-align:center;"></p:staticMessage>
				<H5>#{interfaceLabel.formInfo}</H5>
				<p:divider type="dashed"></p:divider>
				<p:panelGrid id="panelGrid_template" columns="2"
					columnClasses="ui-grid-col-2,ui-grid-col-10" layout="grid"
					styleClass="ui-panelgrid-blank ui-fluid"
					style="border: 1px solid #dee2e6 !important; ">

					<p:column style="background-color: #ededede8;">
						<p:outputLabel value="#{interfaceLabel.equipmentCategory}" />
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:selectOneMenu id="select_equipment_cat" disabled="#{templateDesignBean.isLocked}"
							value="#{templateDesignBean.formTemplate.equipmentCategory}"
							style="color:black;font-weight:bolder;font-style:italic;"
							converter="omnifaces.SelectItemsIndexConverter">
							<f:selectItem itemLabel="#{interfaceLabel.choose}"
								itemValue="#{null}" noSelectionOption="true" />
							<f:selectItems itemLabel=" #{equipmentCategoryVar.name}"
								itemValue="#{equipmentCategoryVar}" var="equipmentCategoryVar"
								value="#{templateDesignBean.equipmentCategories}" />
							<p:ajax event="change"
								listener="#{templateDesignBean.applyPrefix()}"
								update="@([id$=input_prefix],[id$=select_equipment_cat],[id$=messages])"></p:ajax>
						</p:selectOneMenu>
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:outputLabel value="#{interfaceLabel.title} :" />
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:inputText value="#{templateDesignBean.formTemplate.title}"
							disabled="#{templateDesignBean.isLocked}"
							style="font-weight: bold;"></p:inputText>
					</p:column>

					<p:column style="background-color: #ededede8;">
						<p:outputLabel value="#{interfaceLabel.description} :" />
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:inputText
							value="#{templateDesignBean.formTemplate.description}"
							disabled="#{templateDesignBean.isLocked}"
							style="font-weight: bold;"></p:inputText>
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:outputLabel value="#{interfaceLabel.code} :" />
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:inputText value="#{templateDesignBean.formTemplate.code}"
							disabled="true" style="font-weight: bold"></p:inputText>
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:outputLabel value="#{interfaceLabel.prefixCode} :" />
					</p:column>
					<p:column style="background-color: #ededede8;">
						<p:inputText id="input_prefix" disabled="true"
							value="#{templateDesignBean.formTemplate.prefix}"
							style="font-weight: bold;"></p:inputText>
					</p:column>
				</p:panelGrid>
				<p:divider type="solid" rendered="#{!templateDesignBean.isLocked}"></p:divider>
				<div style="display: flex">
					<p:commandButton value="#{interfaceLabel.rowInfo}"
						rendered="#{!templateDesignBean.isLocked}" icon="pi pi-bars"
						process="@([id$=wizard_template])"
						update="@([id$=wizard_template])"
						onclick="PF('wizardVar').loadStep('tab_addRow', true)"
						styleClass="ui-button-raised ui-button-info ui-button-flat" />
					<p:commandButton value="#{interfaceLabel.columnInfo}"
						rendered="#{!templateDesignBean.isLocked}"
						icon="pi pi-align-justify" process="@([id$=wizard_template])"
						update="@([id$=wizard_template])"
						onclick="PF('wizardVar').loadStep('tab_addColumn', true)"
						styleClass="ui-button-raised ui-button-warning ui-button-flat" />
					<p:commandButton value="#{interfaceLabel.addContent}"
						rendered="#{!templateDesignBean.isLocked}" icon="pi pi-ellipsis-h"
						process="@([id$=wizard_template])"
						update="@([id$=wizard_template])"
						onclick="PF('wizardVar').loadStep('tab_addContent', true)"
						styleClass="ui-button-raised ui-button-danger ui-button-flat" />
					<p:commandButton value="#{interfaceLabel.uploadDocumentFiles}"
						rendered="#{!templateDesignBean.isLocked}"
						icon="pi pi-cloud-upload" process="@([id$=wizard_template])"
						update="@([id$=wizard_template])"
						onclick="PF('wizardVar').loadStep('tab_upload_doc', true)"
						styleClass="ui-button-raised ui-button-help ui-button-flat" />
				</div>
				<p:wizard id="wizard_template" showNavBar="false"
					rendered="#{!templateDesignBean.isLocked}" widgetVar="wizardVar"
					style="width:70%;" showStepStatus="false">
					<p:tab id="tab_addRow" title="#{interfaceLabel.addRow}">
						<p:panel header="#{interfaceLabel.rowInfo}">
							<p:panelGrid columns="2"
								columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid"
								styleClass="ui-panelgrid-blank ui-fluid">
								<h:outputText value="#{interfaceLabel.isHearRow}" />
								<p:selectBooleanCheckbox
									value="#{templateDesignBean.formRow.isHeader}"></p:selectBooleanCheckbox>
								<h:outputText value="#{interfaceLabel.isFooterRow}" />
								<p:selectBooleanCheckbox
									value="#{templateDesignBean.formRow.isFooter}"></p:selectBooleanCheckbox>
							</p:panelGrid>
							<p:commandButton value="#{interfaceLabel.addRow}"
								action="#{templateDesignBean.addRow()}" process="@form"
								update="@([id$=panelGridDaynamicContent],[id$=dataTable_rows])"
								oncomplete="reinitializeDragDrop();"
								styleClass="ui-button-raised ui-button-secondary ui-button-flat" />

							<p:commandButton value="#{interfaceLabel.next}"
								onclick="PF('wizardVar').next()"
								update="@([id$=wizard_template])"
								styleClass="ui-button-raised ui-button-warning ui-button-flat" />
						</p:panel>
						<p:divider type="dotted"></p:divider>
						<p:dataTable id="dataTable_rows" widgetVar="widgetVarDataTableRow"
							var="formRowVar" globalFilterOnly="true" selectionMode="single"
							selection="#{templateDesignBean.selectedFormRow}"
							value="#{templateDesignBean.formRows}" reflow="true"
							styleClass="products-table" rowKey="#{formRowVar.id}"
							paginator="true" rows="10"
							emptyMessage="#{interfaceLabel.noRecordsFound}"
							paginatorPosition="bottom">
							<p:ajax event="rowSelect"
								listener="#{templateDesignBean.listFormColumnsPerRow()}"
								process="@([id$=dataTable_rows])"
								update="@([id$=outputText_row_num],[id$=dataTable_columns])" />
							<p:ajax event="rowUnselect"
								listener="#{templateDesignBean.listFormColumnsPerRow()}"
								process="@([id$=dataTable_rows])"
								update="@([id$=outputText_row_num],[id$=dataTable_columns])" />
							<f:facet name="header">
								<div class="flex align-items-center justify-content-between">
									<h:outputText value="#{interfaceLabel.search} : " />
									<p:inputText id="globalFilter"
										onkeyup="PF('widgetVarDataTableRow').filter()"
										style="width:auto;"
										placeholder="#{interfaceLabel.enterKeyword}" />
								</div>
							</f:facet>

							<p:column headerText="#{interfaceLabel.isHearRow}"
								sortBy="#{formRowVar.isHeader}"
								filterBy="#{formRowVar.isHeader}">
								<p:selectBooleanCheckbox value="#{formRowVar.isHeader}"
									disabled="true" />
							</p:column>
							<p:column headerText="#{interfaceLabel.isFooterRow}"
								sortBy="#{formRowVar.isFooter}"
								filterBy="#{formRowVar.isFooter}">
								<p:selectBooleanCheckbox value="#{formRowVar.isFooter}"
									disabled="true" />
							</p:column>

							<p:column headerText="#{interfaceLabel.number}"
								sortBy="#{formRowVar.rowNum}" filterBy="#{formRowVar.rowNum}">
								<h:outputText value="#{formRowVar.rowNum}" />
							</p:column>

							<p:column>
								<p:commandButton value="#{interfaceLabel.delete}"
									action="#{templateDesignBean.deleteRow(formRowVar)}"
									update="@([id$=panelGridDaynamicContent],[id$=dataTable_rows],[id$=messages])"
									oncomplete="reinitializeDragDrop();"
									icon="pi pi-trash" styleClass="rounded-button ui-button-danger" />
							</p:column>
						</p:dataTable>
					</p:tab>
					<p:tab id="tab_addColumn" title="#{interfaceLabel.addColumn}">

						<p:panel header="#{interfaceLabel.columnInfo}">
							<h:outputText value="Row:" style="font-weight:bolder;" />
							<h:outputText id="outputText_row_num"
								style="margin-right:5px;margin-left:5px; font-weight:bolder;color:green"
								value="#{templateDesignBean.selectedFormRow.rowNum}" />
							<p:divider type="dotted"></p:divider>
							<p:panelGrid columns="2"
								columnClasses="ui-grid-col-3,ui-grid-col-9" layout="grid"
								styleClass="ui-panelgrid-blank ui-fluid">
								<p:column style="background-color: #ededede8;">
									<h:outputLabel value="#{interfaceLabel.colSpan}: "
										style="font-weight:bold;" />
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:inputText value="#{templateDesignBean.formColumn.colSpan}"></p:inputText>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<h:outputLabel value="#{interfaceLabel.rowSpan}: "
										style="font-weight:bold;" />
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:inputText value="#{templateDesignBean.formColumn.rowSpan}"></p:inputText>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<h:outputLabel value="#{interfaceLabel.style}: "
										style="font-weight:bold;" />
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:inputText value="#{templateDesignBean.formColumn.style}"></p:inputText>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<h:outputLabel value="#{interfaceLabel.styleClass}"
										style="font-weight:bold;" />
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:inputText
										value="#{templateDesignBean.formColumn.styleClass}"></p:inputText>
								</p:column>
							</p:panelGrid>
							<p:commandButton value="#{interfaceLabel.addColumn}"
								action="#{templateDesignBean.addColumn()}"
								process="@([id$=tab_addColumn])"
								update="@([id$=panelGridDaynamicContent],[id$=dataTable_columns],[id$=messages])"
								oncomplete="reinitializeDragDrop();"
								style="margin-top:20px;"
								styleClass="ui-button-raised ui-button-success ui-button-flat" />
							<p:commandButton value="#{interfaceLabel.back}"
								onclick="PF('wizardVar').back()"
								styleClass="ui-button-raised ui-button-success ui-button-flat" />
							<p:commandButton value="#{interfaceLabel.next}"
								onclick="PF('wizardVar').next()"
								styleClass="ui-button-raised ui-button-warning ui-button-flat" />
						</p:panel>
						<p:divider type="dotted"></p:divider>
						<p:dataTable id="dataTable_columns"
							widgetVar="widgetVarDataTableColumn" var="formColumnVar"
							globalFilterOnly="true" selectionMode="single"
							selection="#{templateDesignBean.selectedFormColumn}"
							value="#{templateDesignBean.formColumnsPerRow}" reflow="true"
							styleClass="products-table" rowKey="#{formColumnVar.id}"
							paginator="true" rows="10"
							emptyMessage="#{interfaceLabel.noRecordsFound}"
							paginatorPosition="bottom">
							<p:ajax event="rowSelect"
								listener="#{templateDesignBean.listColumnContentPerColumn()}"
								process="@([id$=dataTable_columns])"
								update="@([id$=outputText_column_num],[id$=dataTable_column_content])" />
							<p:ajax event="rowUnselect"
								listener="#{templateDesignBean.listColumnContentPerColumn()}"
								process="@([id$=dataTable_columns])"
								update="@([id$=outputText_column_num],[id$=dataTable_column_content])" />
							<f:facet name="header">
								<div class="flex align-items-center justify-content-between">
									<h:outputText value="#{interfaceLabel.search} : " />
									<p:inputText id="globalFilter"
										onkeyup="PF('widgetVarDataTableColumn').filter()"
										style="width:auto;"
										placeholder="#{interfaceLabel.enterKeyword}" />
								</div>
							</f:facet>

							<p:column headerText="#{interfaceLabel.colSpan}"
								sortBy="#{formColumnVar.colSpan}"
								filterBy="#{formColumnVar.colSpan}">
								<h:outputLabel value="#{formColumnVar.colSpan}" />
							</p:column>
							<p:column headerText="#{interfaceLabel.rowSpan}"
								sortBy="#{formColumnVar.rowSpan}"
								filterBy="#{formColumnVar.rowSpan}">
								<h:outputLabel value="#{formColumnVar.rowSpan}" />
							</p:column>
							<p:column headerText="#{interfaceLabel.style}"
								sortBy="#{formColumnVar.style}"
								filterBy="#{formColumnVar.style}">
								<h:outputLabel value="#{formColumnVar.style}" />
							</p:column>
							<p:column headerText="#{interfaceLabel.styleClass}"
								sortBy="#{formColumnVar.styleClass}"
								filterBy="#{formColumnVar.styleClass}">
								<h:outputLabel value="#{formColumnVar.styleClass}" />
							</p:column>
							<p:column>
								<p:commandButton value="#{interfaceLabel.delete}"
									action="#{templateDesignBean.deleteColumn(formColumnVar)}"
									update="@([id$=panelGridDaynamicContent],[id$=dataTable_columns],[id$=messages])"
									oncomplete="reinitializeDragDrop();"
									icon="pi pi-trash" styleClass="rounded-button ui-button-danger" />
							</p:column>
						</p:dataTable>

					</p:tab>
					<p:tab id="tab_addContent" title="#{interfaceLabel.addContent}">
						<p:panel header="#{interfaceLabel.columnContent}">
							<h:outputText value="Column:" style="font-weight:bolder;" />
							<h:outputText id="outputText_column_num"
								style="margin-right:5px;margin-left:5px; font-weight:bolder;color:green"
								value="#{templateDesignBean.selectedFormColumn.columnOrder}" />
							<p:divider type="dotted"></p:divider>
							<p:panelGrid columns="2"
								columnClasses="ui-grid-col-4,ui-grid-col-8" layout="grid"
								styleClass="ui-panelgrid-blank ui-fluid"
								style="border: 1px solid #dee2e6 !important;">
								<p:column style="background-color: #ededede8;">
									<p:outputLabel value="#{interfaceLabel.generalEquipmentItem}:"></p:outputLabel>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:selectOneMenu
										value="#{templateDesignBean.generalEquipmentItem}"
										style="color:black;font-weight:bolder;font-style:italic;"
										converter="omnifaces.SelectItemsIndexConverter">
										<f:selectItem itemLabel="#{interfaceLabel.choose}"
											itemValue="" />
										<f:selectItems
											itemLabel=" #{itemVar.itemText} (#{itemVar.itemType.name})"
											itemValue="#{itemVar}" var="itemVar"
											value="#{templateDesignBean.generalEquipmentItems}" />
										<p:ajax update="@([id$=input_alias_name],[id$=messages])"
											listener="#{templateDesignBean.applyContentAliasName()}"></p:ajax>
									</p:selectOneMenu>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:outputLabel value="#{interfaceLabel.aliasName}:"></p:outputLabel>
								</p:column>
								<p:column style="background-color: #ededede8;">
									<p:inputText id="input_alias_name"
										value="#{templateDesignBean.columnContent.aliasName}"
										disabled="true"></p:inputText>
								</p:column>

							</p:panelGrid>
							<p:divider type="dashed"></p:divider>
							<p:commandButton value="#{interfaceLabel.add}" process="@form"
								action="#{templateDesignBean.addColumnContent()}"
								update="@([id$=panelGridDaynamicContent],[id$=dataTable_column_content],[id$=messages])"
								oncomplete="reinitializeDragDrop();"
								styleClass="ui-button-raised ui-button-warning ui-button-flat" />
							<p:commandButton value="#{interfaceLabel.back}"
								onclick="PF('wizardVar').back()"
								styleClass="ui-button-raised ui-button-success ui-button-flat" />
						</p:panel>
						<p:divider type="dotted"></p:divider>
						<p:dataTable id="dataTable_column_content"
							widgetVar="widgetVarDataTableContent" var="columnContentVar"
							globalFilterOnly="true" selectionMode="single"
							selection="#{templateDesignBean.selectedColumnContent}"
							value="#{templateDesignBean.columnContentsPerColumn}"
							reflow="true" styleClass="products-table"
							rowKey="#{columnContentVar.id}" paginator="true" rows="10"
							emptyMessage="#{interfaceLabel.noRecordsFound}"
							paginatorPosition="bottom">
							<f:facet name="header">
								<div class="flex align-items-center justify-content-between">
									<h:outputText value="#{interfaceLabel.search} : " />
									<p:inputText id="globalFilter"
										onkeyup="PF('widgetVarDataTableContent').filter()"
										style="width:auto;"
										placeholder="#{interfaceLabel.enterKeyword}" />
								</div>
							</f:facet>

							<p:column headerText="#{interfaceLabel.generalEquipmentItem}"
								sortBy="#{columnContentVar.generalEquipmentItem.itemText}(#{columnContentVar.generalEquipmentItem.itemType.name})"
								filterBy="#{columnContentVar.generalEquipmentItem.itemText}(#{columnContentVar.generalEquipmentItem.itemType.name})">
								<h:outputLabel
									value="#{columnContentVar.generalEquipmentItem.itemText}(#{columnContentVar.generalEquipmentItem.itemType.name})" />
							</p:column>
							<p:column headerText="#{interfaceLabel.aliasName}"
								sortBy="#{columnContentVar.aliasName}"
								filterBy="#{columnContentVar.aliasName}">
								<h:outputLabel value="#{columnContentVar.aliasName}" />
							</p:column>
							<p:column>
								<p:commandButton value="#{interfaceLabel.delete}"
									action="#{templateDesignBean.deleteContent(columnContentVar)}"
									update="@([id$=panelGridDaynamicContent],[id$=dataTable_column_content],[id$=messages])"
									oncomplete="reinitializeDragDrop();"
									icon="pi pi-trash" styleClass="rounded-button ui-button-danger" />
							</p:column>

						</p:dataTable>
					</p:tab>
					<p:tab id="tab_upload_doc" title="#{interfaceLabel.uploadTemplate}">
						<p:outputPanel id="manage-add-doc-file-content" class="ui-fluid"
							layout="inline" style="width:100%;height:100%">
							<p:scrollPanel
								style="border:dotted;border-color:#B9CEF2;width: auto; height:89%"
								styleClass="" mode="native">
								<p:panelGrid id="panelGrid_uploader_document" columns="1"
									columnClasses="ui-g-12 ui-md-12 ui-lg-12" layout="grid"
									styleClass="ui-panelgrid-blank ui-fluid"
									style="border:0px none; background-color:transparent;">

									<p:column>
										<p:outputLabel value="#{interfaceLabel.uploadTemplate}"
											style="color:#FFC757;font-weight:bolder;font-style:italic;"></p:outputLabel>
									</p:column>
									<p:divider layout="horizontal" type="solid"
										style="margin-top:-15px;"></p:divider>
									<p:dataScroller id="customDropzone_document"
										widgetVar="dataScrollerdocWidgetVar"
										style="margin-top:-50px;border:0px none; background-color:transparent;box-sizing: border-box;box-shadow: 0 .5rem 1rem rgba(0,0,0,.15) !important;"
										value="#{templateDesignBean.printedDocs}" var="archiveFile"
										chunkSize="10" mode="inline" scrollHeight="300">
										<f:facet name="header">
                                                            #{interfaceLabel.theTotalNumberOfDocument}: <span
												style="color: #FFC757; font-weight: bolder; font-style: italic;">#{templateDesignBean.printedDocs.size()}</span>

										</f:facet>

										<div class="product">
											<div class="product-list-item p-5">
												<p:graphicImage
													name="#{templateDesignBean.docImgIconByDocEx(archiveFile.extension)}"
													library="smat-ins" />
												<div class="product-list-detail">
													<div class="product-name">#{archiveFile.name}</div>
													<div class="product-description">#{archiveFile.extension}</div>

													<span
														style="#{app.locale.locale eq 'en'? 'margin-left:.5rem' : 'margin-right:.5rem'}"
														class="pi #{app.locale.locale eq 'en'? 'pi-angle-right':'pi-angle-left'} product-category">
														#{interfaceLabel.fileSize}: #{archiveFile.fileSize}
														#{interfaceLabel.byte}</span>
												</div>
												<div class="product-list-action">

													<p:commandButton icon="pi pi-trash"
														value="#{interfaceLabel.delete}"
														action="#{templateDesignBean.deleteDocFile(archiveFile)}"
														update="form:customDropzone_document"
														styleClass="rounded-button ui-button-danger" />

												</div>
											</div>
										</div>
										<p:divider layout="horizontal" type="dashed" style=""
											styleClass="ui-custom-divider"></p:divider>

									</p:dataScroller>
									<p:column>
										<small> #{interfaceLabel.dropHereToStartUpload} <p:link
												value="#{interfaceLabel.choose}"
												onclick="PF('uploadFileDocWidgetVar').show(); return false;"
												style="font-size:1.2rem" />.
										</small>
									</p:column>
									<p:remoteCommand name="autoScrollDownData"
										oncomplete="$('.ui-scrollpanel').scrollTop($('.ui-scrollpanel').height());"></p:remoteCommand>
									<p:fileUpload id="advancedupload_document"
										widgetVar="uploadFileDocWidgetVar" multiple="true"
										listener="#{templateDesignBean.uploadArchiveDocToSelectedArchive}"
										oncomplete="autoScrollDownData();" process="@form"
										update="form:manage-add-doc-file-content form:messages"
										style="display:none;" sequential="true"
										allowTypes="/(\.|\/)(dotx)$/"
										dropZone="customDropzone_document" />

								</p:panelGrid>
							</p:scrollPanel>
						</p:outputPanel>
					</p:tab>
				</p:wizard>
				<p:divider type="solid"></p:divider>

				<p:panelGrid id="panelGridDaynamicContent" style="margin-top:20px;"
					styleClass="custom-panel-grid" layout="tabular" columns="0">
					<f:facet name="header">
						<p:row>
							<p:column colspan="12">#{templateDesignBean.formTemplate.title} </p:column>
						</p:row>
					</f:facet>
					<ui:repeat value="#{templateDesignBean.formRows}" var="formRow">
						<p:row>
							<ui:repeat
								value="#{templateDesignBean.getFormColumnsPerRow(formRow)}"
								var="formColumn">
								<p:column colspan="#{formColumn.colSpan}"
									rowspan="#{formColumn.rowSpan}" style="#{formColumn.style}"
									styleClass="#{formColumn.styleClass}">
									<div class="column-content-wrapper drop-zone">
										<ui:repeat
											value="#{templateDesignBean.getColumnContentByColumn(formColumn)}"
											var="columnContent">
											<div class="draggable-item" 
												data-row-id="#{formRow.id}"
												data-column-id="#{formColumn.id}"
												data-content-id="#{columnContent.id}">

												<p:outputLabel style="margin-left:2px;margin-right:2px;"
													rendered="#{columnContent.generalEquipmentItem.itemType.code eq '01'}"
													value="#{columnContent.generalEquipmentItem.itemText}"></p:outputLabel>

												<p:inputText style="margin-left:2px;margin-right:2px;"
													rendered="#{columnContent.generalEquipmentItem.itemType.code eq '02'}" />

												<p:selectBooleanCheckbox
													style="margin-left:2px;margin-right:2px;"
													rendered="#{columnContent.generalEquipmentItem.itemType.code eq '03'}" />

												<p:selectOneMenu
													rendered="#{columnContent.generalEquipmentItem.itemType.code eq '04'}"
													style="margin-left:2px;margin-right:2px;"
													value="#{columnContent.contentValue}">
													<f:selectItem itemLabel="#{interfaceLabel.choose}"
														itemValue="" />
													<f:selectItems
														itemLabel="#{checklistDetailDataSource.itemValue} "
														itemValue="#{checklistDetailDataSource}"
														var="checklistDetailDataSource"
														value="#{templateDesignBean.getBy(columnContent.generalEquipmentItem.checklistDataSource.code)}" />
												</p:selectOneMenu>
											</div>
										</ui:repeat>
									</div>
								</p:column>
							</ui:repeat>
						</p:row>
					</ui:repeat>
				</p:panelGrid>

				<!-- Remote command for updating content positions -->
				<p:remoteCommand name="updateContentPositions" 
					action="#{templateDesignBean.updateContentPositions()}"
					update="@([id$=panelGridDaynamicContent],[id$=messages])"
					oncomplete="reinitializeDragDrop();" />

				<div style="display: flex; margin-top: 30px;">
					<p:commandButton value="#{interfaceLabel.save}" icon="fa fa-save"
						disabled="#{templateDesignBean.isLocked}"
						action="#{templateDesignBean.doSave()}" process="@form"
						update="@([id$=messages],[id$=panelGrid_template],[id$=panelGrid_section],[id$=panelGrid_content])"
						styleClass="ui-button-raised ui-button-danger ui-button-flat">
					</p:commandButton>
					<p:commandButton value="#{interfaceLabel.cancel}"
						icon="fa fa-cancel" action="pretty:viewTemplate"
						styleClass="ui-button-raised ui-button-secondary ui-button-flat">
					</p:commandButton>
				</div>
			</div>
		</h:form>
		
		<!-- Initialize drag and drop after page load -->
		<script type="text/javascript">
		//<![CDATA[
		// Initialize drag and drop when the page is fully loaded
		$(document).ready(function() {
			initializeDragDrop();
		});
		//]]>
		</script>
	</ui:define>
</ui:composition>

