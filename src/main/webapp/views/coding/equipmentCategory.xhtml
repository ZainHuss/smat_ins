<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

    <ui:define name="section-head">
        #{interfaceLabel.view} #{interfaceLabel.equipmentCategory}
    </ui:define>

    <ui:define name="head">
        <h:outputStylesheet library="#{appSetting.resourceLib}"
                            name="css/material-theme.css"></h:outputStylesheet>
        <style>
            .english-name-column {
                min-width: 200px;
                max-width: 300px;
                word-wrap: break-word;
                white-space: normal !important;
            }
            @media screen and (max-width: 768px) {
                .english-name-column {
                    min-width: 150px;
                    max-width: 200px;
                }
            }

            /* optional styling to visually indicate disabled rows */
            .equip-disabled-row {
                opacity: 0.6;
                filter: grayscale(0.2);
            }

            /* Custom styles for status badges */
            .status-badge {
                display: inline-flex;
                align-items: center;
                justify-content: center;
                padding: 0.25rem 0.75rem;
                border-radius: 20px;
                font-size: 0.85rem;
                font-weight: 600;
                text-transform: uppercase;
                letter-spacing: 0.5px;
            }

            .status-active {
                background-color: #d4edda;
                color: #155724;
            }

            .status-inactive {
                background-color: #f8d7da;
                color: #721c24;
            }

            /* Circular button styles */
            .circular-btn {
                width: 36px;
                height: 36px;
                border-radius: 50% !important;
                display: inline-flex;
                align-items: center;
                justify-content: center;
                padding: 0;
                box-shadow: 0 2px 5px rgba(0,0,0,0.2);
                transition: all 0.3s ease;
            }

            .circular-btn:hover {
                transform: scale(1.1);
                box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            }

            .circular-btn.enable-btn {
                background-color: #28a745;
                border-color: #28a745;
                color: white;
            }

            .circular-btn.disable-btn {
                background-color: #dc3545;
                border-color: #dc3545;
                color: white;
            }

            /* Table improvements */
            .products-table {
                border-radius: 8px;
                overflow: hidden;
                box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            }

            .products-table .ui-datatable-header {
                background-color: #f8f9fa;
                border-bottom: 2px solid #dee2e6;
            }

            .products-table .ui-datatable-data tr {
                transition: background-color 0.2s;
            }

            .products-table .ui-datatable-data tr:hover {
                background-color: #f5f5f5;
            }
        </style>
    </ui:define>

    <ui:define name="section-content">
        <h:form id="form">
            <div class="card">
                <p:growl id="messages" showDetail="true" life="2000" sticky="false" />
                <div class="row">
                    <div class="col-lg-9 col-xl-8 col-xxl-7">
                        <p:commandButton value="#{interfaceLabel.add}" icon="pi pi-plus"
                                         actionListener="#{codingEquipmentCategoryBean.openNew}"
                                         update=":form:outputPanel-content"
                                         oncomplete="PF('widgetVarDetailDialog').show()"
                                         styleClass="rounded-button ui-button-success ui-button-raised ui-button-flat"
                                         style="#{app.locale.locale eq 'en'? 'margin-right:.5rem' : 'margin-left:.5rem'} ">
                            <p:resetInput target=":form:outputPanel-content" />
                        </p:commandButton>

                        <p:commandButton id="delete-equipmentCategory-button"
                                         value="#{codingEquipmentCategoryBean.deleteButtonMessage}"
                                         icon="pi pi-trash" styleClass="rounded-button ui-button-danger ui-button-raised ui-button-flat"
                                         actionListener="#{codingEquipmentCategoryBean.deleteSelectedEquipmentCategory}"
                                         disabled="#{!codingEquipmentCategoryBean.hasSelectedEquipmentCategory()}"
                                         update="@this">
                            <p:confirm header="#{interfaceLabel.confirmation}"
                                       message="#{interfaceLabel.deleteSelectedEquipmentCategory}"
                                       icon="pi pi-exclamation-triangle" />
                        </p:commandButton>
                    </div>
                </div>

                <p:divider layout="horizontal" type="dashed"></p:divider>

                <p:dataTable id="dataTable-equipmentCategory" widgetVar="widgetVarEquipmentCategory"
                             var="equipmentCategory" globalFilterOnly="true"
                             value="#{codingEquipmentCategoryBean.equipmentCategoryList}" reflow="true"
                             styleClass="products-table"
                             selection="#{codingEquipmentCategoryBean.selectedEquipmentCategoryList}"
                             rowKey="#{equipmentCategory.id}" paginator="true" rows="10"
                             rowSelectMode="add" emptyMessage="#{interfaceLabel.noRecordsFound}"
                             paginatorPosition="bottom"
                             rowStyleClass="#{equipmentCategory.disabled ? 'equip-disabled-row' : ''}">

                    <p:ajax event="rowSelect" update=":form:delete-equipmentCategory-button" />
                    <p:ajax event="rowUnselect" update=":form:delete-equipmentCategory-button" />
                    <p:ajax event="rowSelectCheckbox" update=":form:delete-equipmentCategory-button" />
                    <p:ajax event="rowUnselectCheckbox" update=":form:delete-equipmentCategory-button" />
                    <p:ajax event="toggleSelect" update=":form:delete-equipmentCategory-button" />

                    <f:facet name="header">
                        <div class="flex align-items-center justify-content-between">
                            <h:outputText value="#{interfaceLabel.search} : " />
                            <p:inputText id="globalFilter"
                                         onkeyup="PF('widgetVarEquipmentCategory').filter()"
                                         style="width:auto;" placeholder="#{interfaceLabel.enterKeyword}" />
                        </div>
                    </f:facet>

                    <p:column selectionMode="multiple" exportable="false" style="width:40px"></p:column>

                    <p:column headerText="#{interfaceLabel.englishName}"
                              sortBy="#{equipmentCategory.englishName}"
                              filterBy="#{equipmentCategory.englishName}"
                              styleClass="english-name-column">
                        <h:outputText value="#{equipmentCategory.englishName}" />
                    </p:column>

                    <p:column headerText="#{interfaceLabel.code}"
                              sortBy="#{equipmentCategory.code}" filterBy="#{equipmentCategory.code}">
                        <h:outputText value="#{equipmentCategory.code}" />
                    </p:column>

                    <!-- NEW: Status column showing Active/Inactive -->
                    <p:column headerText="Status" style="text-align:center;width:100px;">
                        <h:panelGroup styleClass="#{equipmentCategory.disabled ? 'status-badge status-inactive' : 'status-badge status-active'}">
                            <h:outputText value="#{equipmentCategory.disabled ? 'Inactive' : 'Active'}" />
                        </h:panelGroup>
                    </p:column>

                    <!-- Toggle button with circular design -->
                    <p:column headerText="Action" style="text-align:center;width:80px;">
                        <p:commandButton
                                icon="#{equipmentCategory.disabled ? 'pi pi-eye' : 'pi pi-eye-slash'}"
                                title="#{equipmentCategory.disabled ? 'Enable' : 'Disable'}"
                                action="#{codingEquipmentCategoryBean.toggleDisabled(equipmentCategory)}"
                                process="@this"
                                update=":form:dataTable-equipmentCategory :form:messages"
                                styleClass="#{equipmentCategory.disabled ? 'circular-btn enable-btn' : 'circular-btn disable-btn'}" />
                    </p:column>

                    <p:column exportable="false" width="20">
                        <p:commandButton icon="pi pi-pencil"
                                         update=":form:outputPanel-content"
                                         oncomplete="PF('widgetVarDetailDialog').show()" process="@this"
                                         styleClass="circular-btn ui-button-info">
                            <f:setPropertyActionListener value="#{equipmentCategory}"
                                                         target="#{codingEquipmentCategoryBean.equipmentCategory}" />
                            <p:resetInput target=":form:outputPanel-content" />
                        </p:commandButton>
                    </p:column>

                    <p:column exportable="false" width="20">
                        <p:commandButton styleClass="circular-btn ui-button-danger" icon="pi pi-trash"
                                         process="@this" oncomplete="PF('widgetVarDeleteDialog').show()">
                            <f:setPropertyActionListener value="#{equipmentCategory}"
                                                         target="#{codingEquipmentCategoryBean.equipmentCategory}" />
                        </p:commandButton>
                    </p:column>

                </p:dataTable>

                <p:dialog
                        header="#{interfaceLabel.details} #{interfaceLabel.equipmentCategory}"
                        showEffect="fade" modal="true" widgetVar="widgetVarDetailDialog"
                        responsive="true">
                    <p:outputPanel id="outputPanel-content" class="ui-fluid">
                        <p:outputPanel rendered="#{not empty codingEquipmentCategoryBean.equipmentCategory}">
                            <div class="p-field">
                                <p:outputLabel for="arabicName">#{interfaceLabel.arabicName}</p:outputLabel>
                                <p:inputText id="arabicName"
                                             value="#{codingEquipmentCategoryBean.equipmentCategory.arabicName}"
                                             required="true"
                                             requiredMessage="#{interfaceLabel.arabicName}  #{errorLabel.validateInput}" />
                            </div>
                            <div class="p-field">
                                <p:outputLabel for="englishName">#{interfaceLabel.englishName}</p:outputLabel>
                                <p:inputText id="englishName"
                                             value="#{codingEquipmentCategoryBean.equipmentCategory.englishName}" />
                            </div>
                            <div class="p-field">
                                <p:outputLabel for="code">#{interfaceLabel.code}</p:outputLabel>
                                <p:inputText id="code"
                                             value="#{codingEquipmentCategoryBean.equipmentCategory.code}" />
                            </div>

                        </p:outputPanel>
                    </p:outputPanel>
                    <f:facet name="footer">
                        <p:commandButton value="#{interfaceLabel.save}" icon="pi pi-check"
                                         actionListener="#{codingEquipmentCategoryBean.save}"
                                         update=":form:outputPanel-content :form:dataTable-equipmentCategory"
                                         process="outputPanel-content @this" />
                        <p:commandButton value="#{interfaceLabel.cancel}"
                                         icon="pi pi-times" onclick="PF('widgetVarDetailDialog').hide()"
                                         class="ui-button-secondary" />
                    </f:facet>
                </p:dialog>

                <p:confirmDialog widgetVar="widgetVarDeleteDialog" showEffect="fade"
                                 width="300" message="#{interfaceLabel.deleteSelectedEquipmentCategory}"
                                 header="#{interfaceLabel.confirmation}" severity="warn">
                    <p:commandButton value="#{interfaceLabel.yes}" icon="pi pi-check"
                                     actionListener="#{codingEquipmentCategoryBean.deleteEquipmentCategory}"
                                     process="@this" oncomplete="PF('widgetVarDeleteDialog').hide()" />
                    <p:commandButton value="#{interfaceLabel.no}" type="button"
                                     styleClass="ui-button-secondary" icon="pi pi-times"
                                     onclick="PF('widgetVarDeleteDialog').hide()" />
                </p:confirmDialog>

                <p:confirmDialog global="true" showEffect="fade" width="300">
                    <p:commandButton value="#{interfaceLabel.yes}" type="button"
                                     styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
                    <p:commandButton value="#{interfaceLabel.no}" type="button"
                                     styleClass="ui-confirmdialog-no ui-button-secondary"
                                     icon="pi pi-times" />
                </p:confirmDialog>

            </div>
        </h:form>
    </ui:define>
</ui:composition>