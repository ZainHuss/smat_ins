<ui:composition xmlns="http://www.w3.org/1999/xhtml"
	xmlns:h="http://xmlns.jcp.org/jsf/html"
	xmlns:f="http://xmlns.jcp.org/jsf/core"
	xmlns:ui="http://java.sun.com/jsf/facelets"
	xmlns:p="http://primefaces.org/ui" template="/WEB-INF/template.xhtml">

	<ui:define name="section-head">
        #{interfaceLabel.view} #{interfaceLabel.companies} 
	</ui:define>

	<ui:define name="head">
		<h:outputStylesheet library="#{appSetting.resourceLib}"
			name="css/material-theme.css"></h:outputStylesheet>
		<style>
			.contact-person-cell {
				display: flex;
				align-items: center;
				gap: 0.5rem;
				/* keep contact cell on a single line */
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
			}
			.contact-avatar {
				width: 32px;
				height: 32px;
				border-radius: 50%;
				background-color: #e9ecef;
				display: flex;
				align-items: center;
				justify-content: center;
				font-weight: 600;
				color: #495057;
				flex-shrink: 0;
			}
			.details-cell {
				/* keep details on a single line and use ellipsis for overflow */
				white-space: nowrap;
				overflow: hidden;
				text-overflow: ellipsis;
				max-width: 300px;
			}
			.wrap-text-cell {
				white-space: normal;
				word-wrap: break-word;
				word-break: break-word;
			}
			.name-column {
				min-width: 200px;
				white-space: normal;
				word-wrap: break-word;
				word-break: break-word;
			}
			.products-table .ui-datatable-tablewrapper table {
				table-layout: auto;
			}
			.products-table .ui-datatable-tablewrapper td {
				/* force single-line rows (desktop) and ellipsis; full text available via title */
				max-width: 220px;
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				vertical-align: middle;
				padding: 8px;
			}
			/* make nested containers inside cells also truncate */
			.products-table .ui-datatable-tablewrapper td .details-cell,
			.products-table .ui-datatable-tablewrapper td .contact-person-cell {
				overflow: hidden;
				text-overflow: ellipsis;
				white-space: nowrap;
				display: inline-block;
				max-width: 100%;
			}
			@media screen and (max-width: 960px) {
				.products-table .ui-datatable-tablewrapper table {
					table-layout: auto;
				}
				.name-column {
					min-width: 150px;
				}
				/* allow wrapping on small screens */
				.products-table .ui-datatable-tablewrapper td {
					white-space: normal;
					overflow: visible;
					text-overflow: unset;
					padding: 6px;
				}
			}
		</style>
	</ui:define>
	<ui:define name="section-content">
		<h:form id="form">
			<div class="card">
				<p:growl id="messages" showDetail="true" life="2000" sticky="false" />
				<div class="row">
					<div class="col-6 col-lg-3 col-xl-2 col-xxl-1">
						<p:commandButton value="#{interfaceLabel.add}" icon="pi pi-plus"
							actionListener="#{codingCompanyBean.openNew}"
							update=":form:outputPanel-content"
							oncomplete="PF('widgetVarDetailDialog').show()"
							styleClass="rounded-button ui-button-success ui-button-raised ui-button-flat"
							style="#{app.locale.locale eq 'en'? 'margin-right:.5rem' : 'margin-left:.5rem'} ">
							<p:resetInput target=":form:outputPanel-content" />
						</p:commandButton>
					</div>
					<div class="col-6 col-lg-5 col-xl-4 col-xxl-3">
						<p:commandButton id="delete-company-button"
							value="#{codingCompanyBean.deleteButtonMessage}"
							icon="pi pi-trash" style="width:auto;"
							styleClass="rounded-button ui-button-danger ui-button-raised ui-button-flat"
							actionListener="#{codingCompanyBean.delete()}"
							disabled="#{!codingCompanyBean.hasSelected()}" update="@this">
							<p:confirm header="#{interfaceLabel.confirmation}"
								message="#{interfaceLabel.deleteSelectedCompany}"
								icon="pi pi-exclamation-triangle" />
						</p:commandButton>
					</div>
				</div>

				<p:divider layout="horizontal" type="dashed"></p:divider>

				<p:dataTable id="dataTable-company" widgetVar="widgetVarCompany"
					var="company" value="#{codingCompanyBean.companies}" reflow="true"
					styleClass="products-table" globalFilterOnly="true"
					selection="#{codingCompanyBean.selectedCompanyList}"
					rowKey="#{company.id}" paginator="true" rows="10"
					rowSelectMode="add" emptyMessage="#{interfaceLabel.noRecordsFound}"
					paginatorPosition="bottom">
					<p:ajax event="rowSelect" update=":form:delete-company-button" />
					<p:ajax event="rowUnselect" update=":form:delete-company-button" />
					<p:ajax event="rowSelectCheckbox"
						update=":form:delete-company-button" />
					<p:ajax event="rowUnselectCheckbox"
						update=":form:delete-company-button" />
					<p:ajax event="toggleSelect" update=":form:delete-company-button" />
					<f:facet name="header">
						<div class="flex align-items-center justify-content-between">
							<h:outputText value="#{interfaceLabel.search} : " />
							<p:inputText id="globalFilter"
								onkeyup="PF('widgetVarCompany').filter()" style="width:auto;"
								placeholder="#{interfaceLabel.enterKeyword}" />
						</div>
					</f:facet>
					<p:column selectionMode="multiple" exportable="false"></p:column>

					<!-- Reordered & consolidated columns: Name, Code, Phones, Contact (name + email), Address, Details -->
					<p:column headerText="#{interfaceLabel.name}"
						sortBy="#{company.name}" filterBy="#{company.name}" styleClass="name-column wrap-text-cell">
						<h:outputText value="#{company.name}" title="#{company.name}" />
					</p:column>

					<p:column headerText="#{interfaceLabel.code}"
						sortBy="#{company.code}" filterBy="#{company.code}" styleClass="wrap-text-cell"
						headerStyle="color:#0d6efd;font-weight:600;font-family:'Segoe UI', Tahoma, Arial, sans-serif;">
						<h:outputText value="#{company.code}" title="#{company.code}" />
					</p:column>

					<p:column headerText="#{interfaceLabel.phone}"
						sortBy="#{company.phone}" filterBy="#{company.phone}" styleClass="wrap-text-cell"
						headerStyle="color:#0d6efd;font-weight:600;font-family:'Segoe UI', Tahoma, Arial, sans-serif;">
						<h:outputText value="#{not empty company.phone ? company.phone : ''}" title="#{company.phone}" />
						<h:outputText value=" / " rendered="#{not empty company.phone and not empty company.mobile}" />
						<h:outputText value="#{company.mobile}" rendered="#{not empty company.mobile}" title="#{company.mobile}" />
						<h:outputText value="-" style="color: #6c757d;" rendered="#{empty company.phone and empty company.mobile}" />
					</p:column>

					<p:column headerText="#{interfaceLabel.contactPerson}"
						sortBy="#{company.contactPerson}" filterBy="#{company.contactPerson}" styleClass="wrap-text-cell"
						headerStyle="color:#0d6efd;font-weight:600;font-family:'Segoe UI', Tahoma, Arial, sans-serif;">
						<div class="contact-person-cell">
							<div class="contact-avatar">
								<h:outputText value="#{not empty company.contactPerson ? company.contactPerson.substring(0,1).toUpperCase() : '?'}" />
							</div>
							<div class="details-cell">
								<h:outputText value="#{company.contactPerson}" rendered="#{not empty company.contactPerson}" title="#{company.contactPerson}" />
								<h:outputText value="-" style="color: #6c757d;" rendered="#{empty company.contactPerson}" />
								<!-- inline separator only when both contactPerson and email exist -->
								<h:outputText value=" - " rendered="#{not empty company.contactPerson and not empty company.email}" style="color:#6c757d;" />
								<h:outputLink value="mailto:#{company.email}" rendered="#{not empty company.email}" title="#{company.email}">
									<h:outputText value="#{company.email}" />
								</h:outputLink>
								<h:outputText value="-" style="color: #6c757d;" rendered="#{empty company.email}" />
							</div>
						</div>
					</p:column>

					<p:column headerText="#{interfaceLabel.address}"
						sortBy="#{company.address}" filterBy="#{company.address}" styleClass="wrap-text-cell"
						headerStyle="color:#0d6efd;font-weight:600;font-family:'Segoe UI', Tahoma, Arial, sans-serif;">
						<div class="details-cell">
							<h:outputText value="#{company.address}" rendered="#{not empty company.address}" title="#{company.address}" />
							<h:outputText value="-" style="color: #6c757d;" rendered="#{empty company.address}" />
						</div>
					</p:column>

					<p:column headerText="#{interfaceLabel.details}"
						sortBy="#{company.details}" filterBy="#{company.details}" styleClass="wrap-text-cell"
						headerStyle="color:#0d6efd;font-weight:600;font-family:'Segoe UI', Tahoma, Arial, sans-serif;">
						<div class="details-cell">
							<h:outputText value="#{company.details}" rendered="#{not empty company.details}" title="#{company.details}" />
							<h:outputText value="-" style="color: #6c757d;" rendered="#{empty company.details}" />
						</div>
					</p:column>

					<p:column exportable="false" width="20">
						<p:commandButton icon="pi pi-pencil"
							update=":form:outputPanel-content"
							oncomplete="PF('widgetVarDetailDialog').show()" process="@this">
							<f:setPropertyActionListener value="#{company}"
								target="#{codingCompanyBean.company}" />
							<p:resetInput target=":form:outputPanel-content" />
						</p:commandButton>
					</p:column>
					<p:column exportable="false" width="20">
						<p:commandButton styleClass="ui-button-danger" icon="pi pi-trash"
							process="@this" oncomplete="PF('widgetVarDeleteDialog').show()">
							<f:setPropertyActionListener value="#{company}"
								target="#{codingCompanyBean.company}" />
						</p:commandButton>
					</p:column>
				</p:dataTable>

				<p:dialog
					header="#{interfaceLabel.details} #{interfaceLabel.company}"
					showEffect="fade" modal="true" widgetVar="widgetVarDetailDialog"
					responsive="true">
					<p:outputPanel id="outputPanel-content" class="ui-fluid">
						<p:outputPanel rendered="#{not empty codingCompanyBean.company}">
							<div class="ui-fluid formgrid grid">
								<div class="field col-12 md:col-4">
									<p:outputLabel style="font-weight:bold;color:black;" for="name">#{interfaceLabel.name}</p:outputLabel>
									<p:inputText id="name"
										value="#{codingCompanyBean.company.name}" required="true"
										requiredMessage="#{interfaceLabel.name}  #{errorLabel.validateInput}" />
								</div>
								<div class="field col-12 md:col-4">
									<p:outputLabel style="font-weight:bold;color:black;" for="phone">#{interfaceLabel.phone}</p:outputLabel>
									<p:inputText id="phone"
										value="#{codingCompanyBean.company.phone}" />
								</div>
								<div class="field col-12 md:col-4">
									<p:outputLabel style="font-weight:bold;color:black;" for="mobile">#{interfaceLabel.mobile}</p:outputLabel>
									<p:inputText id="mobile"
										value="#{codingCompanyBean.company.mobile}" />
								</div>
							</div>
							<div class="ui-fluid formgrid grid">
								<div class="field col-12 md:col-6">
									<p:outputLabel style="font-weight:bold;color:black;" for="contactPerson">#{interfaceLabel.contactPerson}</p:outputLabel>
									<p:inputText id="contactPerson"
										value="#{codingCompanyBean.company.contactPerson}" />
								</div>
								<div class="field col-12 md:col-6">
									<p:outputLabel style="font-weight:bold;color:black;" for="email">#{interfaceLabel.email}</p:outputLabel>
									<p:inputText id="email" value="#{codingCompanyBean.company.email}" validatorMessage="#{interfaceLabel.invalidEmail}">
										<f:validateRegex pattern="^[A-Za-z0-9._%+-]+@[A-Za-z0-9.-]+\.[A-Za-z]{2,}$" />
									</p:inputText>
								</div>
							</div>
							<div class="row ">
								<div class="col-lg-10 col-xl-9 col-xxl-8">
									<p:outputLabel style="font-weight:bold;color:black;">#{interfaceLabel.address}</p:outputLabel>
									<p:inputTextarea value="#{codingCompanyBean.company.address}"
										rows="3"></p:inputTextarea>
								</div>
							</div>
							<div class="row ">
								<div class="col-lg-10 col-xl-9 col-xxl-8">
									<p:outputLabel style="font-weight:bold;color:black;">#{interfaceLabel.details}</p:outputLabel>
									<p:inputTextarea value="#{codingCompanyBean.company.details}"
										rows="3"></p:inputTextarea>
								</div>
							</div>
						</p:outputPanel>
					</p:outputPanel>
					<f:facet name="footer">
						<p:commandButton value="#{interfaceLabel.save}" icon="pi pi-check"
							actionListener="#{codingCompanyBean.save}"
							update=":form:outputPanel-content :form:dataTable-company"
							process="outputPanel-content @this" />
						<p:commandButton value="#{interfaceLabel.cancel}"
							icon="pi pi-times" onclick="PF('widgetVarDetailDialog').hide()"
							class="ui-button-secondary" />
					</f:facet>
				</p:dialog>

				<p:confirmDialog widgetVar="widgetVarDeleteDialog" showEffect="fade"
					width="300" message="#{interfaceLabel.deleteSelectedCompany}"
					header="#{interfaceLabel.confirmation}" severity="warn">
					<p:commandButton value="#{interfaceLabel.yes}" icon="pi pi-check"
						actionListener="#{codingCompanyBean.delete()}" process="@this"
						oncomplete="PF('widgetVarDeleteDialog').hide()" />
					<p:commandButton value="#{interfaceLabel.no}" type="button"
						styleClass="ui-button-secondary" icon="pi pi-times"
						onclick="PF('widgetVarDeleteDialog').hide()" />
				</p:confirmDialog>
				<p:confirmDialog global="true" showEffect="fade" width="300">
					<p:commandButton value="#{interfaceLabel.yes}" type="button"
						styleClass="ui-confirmdialog-yes" icon="pi pi-check" />
					<p:commandButton value="#{interfaceLabel.no}" type="button"
						styleClass="ui-confirmdialog-no ui-button-secondary"
						icon="pi pi-times" />
				</p:confirmDialog>

			</div>
		</h:form>
	</ui:define>
</ui:composition>