<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:pe="http://primefaces.org/ui/extensions"
                xmlns:pt="http://xmlns.jcp.org/jsf/passthrough"
                xmlns:c="http://xmlns.jcp.org/jsp/jstl/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:o="http://omnifaces.org/ui"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="head">
        <h:outputStylesheet library="#{appSetting.resourceLib}"
                            name="css/material-theme.css"></h:outputStylesheet>
        <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&amp;display=swap" rel="stylesheet"/>
        <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;500;600;700&amp;display=swap" rel="stylesheet"/>
        <style>
            /* نظام الألوان الجديد - أخضر فاتح، عسلي، بنفسجي */
            :root {
                /* الألوان الأساسية */
                --primary-50: #f0f9ff;
                --primary-100: #e0f2fe;
                --primary-200: #bae6fd;
                --primary-300: #7dd3fc;
                --primary-400: #38bdf8;
                --primary-500: #0ea5e9;
                --primary-600: #0284c7;
                --primary-700: #0369a1;
                --primary-800: #075985;
                --primary-900: #0c4a6e;

                /* الأخضر الفاتح */
                --mint-50: #f0fdfa;
                --mint-100: #ccfbf1;
                --mint-200: #99f6e4;
                --mint-300: #5eead4;
                --mint-400: #2dd4bf;
                --mint-500: #14b8a6;
                --mint-600: #0d9488;
                --mint-700: #0f766e;
                --mint-800: #115e59;
                --mint-900: #134e4a;

                /* العسلي */
                --hazel-50: #fefce8;
                --hazel-100: #fef9c3;
                --hazel-200: #fef08a;
                --hazel-300: #fde047;
                --hazel-400: #facc15;
                --hazel-500: #eab308;
                --hazel-600: #ca8a04;
                --hazel-700: #a16207;
                --hazel-800: #854d0e;
                --hazel-900: #713f12;

                /* البنفسجي */
                --purple-50: #faf5ff;
                --purple-100: #f3e8ff;
                --purple-200: #e9d5ff;
                --purple-300: #d8b4fe;
                --purple-400: #c084fc;
                --purple-500: #a855f7;
                --purple-600: #9333ea;
                --purple-700: #7c3aed;
                --purple-800: #6b21a8;
                --purple-900: #581c87;

                /* الألوان المساعدة */
                --success-color: #22c55e;
                --warning-color: #eab308;
                --error-color: #ef4444;
                --info-color: #0ea5e9;

                --text-primary: #1e293b;
                --text-secondary: #64748b;
                --surface-color: rgba(255, 255, 255, 0.92);
                --surface-hover: rgba(248, 250, 252, 0.98);
                --border-color: rgba(203, 213, 225, 0.4);
                --required-color: #ef4444;

                --shadow-sm: 0 1px 3px rgba(15, 23, 42, 0.08);
                --shadow-md: 0 4px 12px rgba(15, 23, 42, 0.12);
                --shadow-lg: 0 10px 25px rgba(15, 23, 42, 0.15);
                --shadow-xl: 0 20px 40px rgba(15, 23, 42, 0.18);
                --glass-shadow: 0 8px 32px 0 rgba(15, 23, 42, 0.15);
                --glass-border: 1px solid rgba(226, 232, 240, 0.3);

                --gradient-mint: linear-gradient(135deg, var(--mint-400) 0%, var(--mint-600) 100%);
                --gradient-purple: linear-gradient(135deg, var(--purple-400) 0%, var(--purple-600) 100%);
                --gradient-hazel: linear-gradient(135deg, var(--hazel-400) 0%, var(--hazel-600) 100%);
                --gradient-primary: linear-gradient(135deg, var(--primary-400) 0%, var(--primary-600) 100%);
                --gradient-success: linear-gradient(135deg, #22c55e 0%, #16a34a 100%);
                --gradient-warning: linear-gradient(135deg, #eab308 0%, #ca8a04 100%);
                --gradient-danger: linear-gradient(135deg, #ef4444 0%, #dc2626 100%);
                --gradient-card: linear-gradient(135deg, rgba(255, 255, 255, 0.96) 0%, rgba(248, 250, 252, 0.98) 100%);

                --neon-glow: 0 0 15px rgba(20, 184, 166, 0.3);
                --mint-glow: 0 0 20px rgba(20, 184, 166, 0.4);
                --purple-glow: 0 0 20px rgba(168, 85, 247, 0.4);
                --hazel-glow: 0 0 20px rgba(234, 179, 8, 0.4);

                --border-radius-sm: 8px;
                --border-radius-md: 12px;
                --border-radius-lg: 16px;
                --border-radius-xl: 20px;
                --border-radius-pill: 50px;

                --transition-base: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
                --transition-slow: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            }

            * {
                transition: var(--transition-base);
            }

            body {
                background-color: #f8fafc !important;
                background-image:
                        radial-gradient(at 40% 20%, rgba(226, 232, 240, 0.7) 0px, transparent 50%),
                        radial-gradient(at 80% 0%, rgba(241, 245, 249, 0.5) 0px, transparent 50%),
                        radial-gradient(at 0% 50%, rgba(248, 250, 252, 0.6) 0px, transparent 50%),
                        radial-gradient(at 80% 50%, rgba(203, 213, 225, 0.4) 0px, transparent 50%),
                        radial-gradient(at 0% 100%, rgba(148, 163, 184, 0.3) 0px, transparent 50%),
                        radial-gradient(at 80% 100%, rgba(100, 116, 139, 0.2) 0px, transparent 50%),
                        radial-gradient(at 0% 0%, rgba(255, 255, 255, 0.9) 0px, transparent 50%);
                background-attachment: fixed;
                min-height: 100vh;
                font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
                color: var(--text-primary);
                line-height: 1.6;
            }

            /* Premium Card Styling with New Color Accents */
            .card {
                background: var(--gradient-card);
                border-radius: var(--border-radius-lg);
                box-shadow: var(--shadow-lg), var(--glass-shadow);
                backdrop-filter: blur(10px);
                -webkit-backdrop-filter: blur(10px);
                border: var(--glass-border);
                position: relative;
                overflow: hidden;
                margin-bottom: 2rem;
                transform: translateY(0);
                animation: cardSlideIn 0.6s ease-out;
                padding: 2rem;
                transition: var(--transition-slow);
                border-top: 1px solid rgba(226, 232, 240, 0.8);
            }

            .card:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--gradient-primary);
                z-index: 1;
            }

            /* Main Info Card - باللون العسلي */
            .main-info-card {
                border-top: 4px solid var(--hazel-500);
            }

            .main-info-card:before {
                background: var(--gradient-hazel);
            }

            /* Photo Upload Card - باللون الأخضر الفاتح */
            .photo-upload-card {
                border-top: 4px solid var(--mint-500);
            }

            .photo-upload-card:before {
                background: var(--gradient-mint);
            }

            /* Approval Card - باللون البنفسجي */
            .approval-card {
                border-top: 4px solid var(--purple-500);
            }

            .approval-card:before {
                background: var(--gradient-purple);
            }

            .card + .card {
                margin-top: 2.5rem;
            }

            @keyframes cardSlideIn {
                from {
                    opacity: 0;
                    transform: translateY(30px);
                }
                to {
                    opacity: 1;
                    transform: translateY(0);
                }
            }

            .card:hover {
                transform: translateY(-8px);
                box-shadow: var(--shadow-xl), 0 8px 25px rgba(15, 23, 42, 0.15);
            }

            .main-info-card:hover {
                box-shadow: var(--shadow-xl), var(--hazel-glow);
            }

            .photo-upload-card:hover {
                box-shadow: var(--shadow-xl), var(--mint-glow);
            }

            .approval-card:hover {
                box-shadow: var(--shadow-xl), var(--purple-glow);
            }

            /* Form Title with New Color Style */
            .form-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 2rem;
                padding-bottom: 1.25rem;
                border-bottom: 1px solid rgba(203, 213, 225, 0.3);
                position: relative;
            }

            .form-header:after {
                content: "";
                position: absolute;
                bottom: -1px;
                left: 0;
                width: 100px;
                height: 2px;
                background: var(--gradient-primary);
                border-radius: 2px;
            }

            .form-title {
                font-size: 1.85rem;
                font-weight: 700;
                color: var(--primary-800);
                margin: 0;
                position: relative;
                display: inline-block;
                font-family: 'Playfair Display', serif;
                letter-spacing: -0.5px;
            }

            .form-title:after {
                content: "";
                position: absolute;
                bottom: -1.25rem;
                left: 0;
                width: 60px;
                height: 3px;
                background: var(--gradient-primary);
                border-radius: 3px;
                transition: width 0.4s ease;
            }

            .form-title:hover:after {
                width: 90px;
            }

            /* Form Grid Layout */
            .form-grid {
                display: grid;
                grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
                gap: 1.75rem;
                margin-bottom: 1.75rem;
            }

            .form-col-2 {
                grid-column: span 2;
            }

            /* Field Group Styling */
            .field-group {
                position: relative;
                margin-bottom: 1.5rem;
            }

            .field-group.required-field:before {
                content: "";
                position: absolute;
                left: -14px;
                top: 14px;
                width: 8px;
                height: 8px;
                background: var(--required-color);
                border-radius: 50%;
                box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.4);
                animation: pulse 1.5s infinite;
                z-index: 2;
            }

            @keyframes pulse {
                0% {
                    opacity: 0.6;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.4);
                }
                50% {
                    opacity: 1;
                    box-shadow: 0 0 0 4px rgba(239, 68, 68, 0.6);
                }
                100% {
                    opacity: 0.6;
                    box-shadow: 0 0 0 2px rgba(239, 68, 68, 0.4);
                }
            }

            /* Premium Input Fields Styling */
            .ui-inputtext, .ui-selectonemenu, .ui-calendar, .ui-inputtextarea {
                border: 1px solid var(--border-color);
                border-radius: var(--border-radius-sm);
                padding: 0.85rem 1rem;
                font-size: 0.9rem;
                background: rgba(255, 255, 255, 0.85);
                transition: var(--transition-base);
                box-shadow: var(--shadow-sm);
                width: 100%;
                color: var(--text-primary);
                font-weight: 400;
            }

            .ui-inputtext:focus,
            .ui-selectonemenu:focus,
            .ui-calendar:focus,
            .ui-inputtextarea:focus {
                outline: none;
                border-color: var(--primary-500);
                box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15), var(--shadow-md);
                background: white;
                transform: translateY(-2px);
            }

            .ui-inputtext:hover,
            .ui-selectonemenu:hover,
            .ui-calendar:hover,
            .ui-inputtextarea:hover {
                border-color: var(--primary-400);
                box-shadow: var(--shadow-sm), 0 0 0 1px rgba(14, 165, 233, 0.2);
            }

            /* Labels */
            .smat-label {
                font-weight: 600;
                color: var(--text-primary);
                font-size: 0.9rem;
                margin-bottom: 0.65rem;
                display: block;
                letter-spacing: 0.3px;
            }

            .smat-label.required:after {
                content: "*";
                color: var(--required-color);
                margin-left: 4px;
                font-size: 0.9em;
            }

            /* Premium Floating Labels */
            .floating-label {
                position: absolute;
                top: -10px;
                left: 12px;
                font-size: 0.75rem;
                background: linear-gradient(to bottom, #f8fafc, #ffffff);
                padding: 0 8px;
                color: var(--primary-700);
                font-weight: 600;
                z-index: 1;
                border-radius: 12px;
                box-shadow: 0 0 0 1px white;
                transition: var(--transition-base);
                letter-spacing: 0.5px;
                border: 1px solid rgba(203, 213, 225, 0.3);
            }

            .floating-label.required:after {
                content: "*";
                color: var(--required-color);
                margin-left: 3px;
                font-size: 0.9em;
                position: relative;
                top: -1px;
            }

            /* Premium Button Styling with New Color Effects */
            .ui-button {
                border-radius: var(--border-radius-pill) !important;
                font-weight: 600 !important;
                letter-spacing: 0.5px;
                padding: 0.75rem 2rem !important;
                position: relative;
                overflow: hidden;
                transition: all 0.4s ease !important;
                box-shadow: var(--shadow-sm);
                border: none !important;
                font-size: 0.9rem;
                min-width: 130px;
                height: 46px;
                margin: 0.3rem;
                background-size: 200% auto !important;
                background-position: left center !important;
                display: inline-flex !important;
                align-items: center;
                justify-content: center;
                gap: 0.6rem;
                cursor: pointer;
                font-family: 'Poppins', sans-serif;
            }

            .ui-button .ui-button-text {
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                position: relative;
                z-index: 1;
            }

            .ui-button .ui-icon {
                margin: 0 !important;
                font-size: 1.1rem !important;
                position: relative;
                z-index: 1;
            }

            .ui-button:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: inherit;
                opacity: 1;
                transition: var(--transition-base);
                z-index: 0;
            }

            .ui-button:after {
                content: '';
                position: absolute;
                top: 0;
                left: -100%;
                width: 100%;
                height: 100%;
                background: linear-gradient(90deg, transparent, rgba(255,255,255,0.4), transparent);
                transition: left 0.7s ease;
                z-index: 1;
            }

            .ui-button:hover {
                transform: translateY(-4px) scale(1.03) !important;
                box-shadow: var(--shadow-lg) !important;
            }

            .ui-button:hover:after {
                left: 100%;
            }

            .ui-button:active {
                transform: translateY(1px) scale(0.98) !important;
            }

            .ui-button-primary {
                background: var(--gradient-primary) !important;
                color: white !important;
            }

            .ui-button-primary:hover {
                box-shadow: 0 8px 20px rgba(14, 165, 233, 0.4) !important;
            }

            .ui-button-mint {
                background: var(--gradient-mint) !important;
                color: white !important;
            }

            .ui-button-mint:hover {
                box-shadow: 0 8px 20px rgba(20, 184, 166, 0.4) !important;
            }

            .ui-button-purple {
                background: var(--gradient-purple) !important;
                color: white !important;
            }

            .ui-button-purple:hover {
                box-shadow: 0 8px 20px rgba(168, 85, 247, 0.4) !important;
            }

            .ui-button-hazel {
                background: var(--gradient-hazel) !important;
                color: white !important;
            }

            .ui-button-hazel:hover {
                box-shadow: 0 8px 20px rgba(234, 179, 8, 0.4) !important;
            }

            .ui-button-danger {
                background: var(--gradient-danger) !important;
                color: white !important;
            }

            .ui-button-danger:hover {
                box-shadow: 0 8px 20px rgba(239, 68, 68, 0.4) !important;
            }

            .ui-button-success {
                background: var(--gradient-success) !important;
                color: white !important;
            }

            .ui-button-success:hover {
                box-shadow: 0 8px 20px rgba(34, 197, 94, 0.4) !important;
            }

            .ui-button-secondary {
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%) !important;
                color: var(--text-primary) !important;
                border: 1px solid rgba(203, 213, 225, 0.5) !important;
            }

            .ui-button-secondary:hover {
                box-shadow: 0 8px 20px rgba(241, 245, 249, 0.4) !important;
                background: linear-gradient(135deg, #f1f5f9 0%, #e2e8f0 100%) !important;
            }

            .ui-tooltip {
                background: var(--surface-color) !important;
                backdrop-filter: blur(10px) !important;
                border: var(--glass-border) !important;
                box-shadow: var(--shadow-xl) !important;
                border-radius: var(--border-radius-md) !important;
                padding: 0.75rem 1rem !important;
                font-size: 0.85rem !important;
                border-top: 2px solid var(--primary-500);
            }

            /* Premium Photo Upload Section - باللون الأخضر الفاتح */
            .photo-upload-section {
                background: var(--surface-color);
                border-radius: var(--border-radius-lg);
                padding: 2rem;
                margin-bottom: 2rem;
                box-shadow: var(--shadow-md);
                border-left: 3px solid var(--mint-400);
                position: relative;
                overflow: hidden;
            }

            .photo-upload-section:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--gradient-mint);
            }

            .photo-upload-header {
                display: flex;
                justify-content: space-between;
                align-items: center;
                margin-bottom: 1.75rem;
                padding-bottom: 1rem;
                border-bottom: 1px solid rgba(203, 213, 225, 0.3);
            }

            .photo-upload-title {
                font-size: 1.4rem;
                font-weight: 700;
                color: var(--mint-800);
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.75rem;
                font-family: 'Playfair Display', serif;
            }

            .photo-upload-content {
                display: grid;
                grid-template-columns: 1fr 1fr;
                gap: 2.5rem;
                align-items: center;
            }

            .upload-controls {
                display: flex;
                flex-direction: column;
                gap: 1.25rem;
            }

            .photo-upload-info {
                font-size: 0.9rem;
                color: var(--text-secondary);
                margin: 0;
                display: flex;
                align-items: center;
                gap: 0.6rem;
                font-weight: 500;
            }

            .preview-container {
                display: flex;
                flex-direction: column;
                align-items: center;
                gap: 1rem;
            }

            .preview-title {
                font-size: 1.1rem;
                font-weight: 700;
                color: var(--text-primary);
                margin: 0;
                text-transform: uppercase;
                letter-spacing: 1.2px;
                display: flex;
                align-items: center;
                gap: 0.6rem;
                font-family: 'Playfair Display', serif;
            }

            .photo-preview-container {
                position: relative;
                width: 200px;
                height: 200px;
                border-radius: var(--border-radius-md);
                overflow: hidden;
                box-shadow: var(--shadow-sm);
                border: 2px dashed var(--border-color);
                background: white;
                display: flex;
                align-items: center;
                justify-content: center;
                transition: var(--transition-base);
            }

            .photo-preview-container:hover {
                border-color: var(--mint-500);
                transform: scale(1.05);
                box-shadow: var(--mint-glow), 0 8px 20px rgba(20, 184, 166, 0.25);
            }

            .photo-overlay {
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(240, 253, 250, 0.85);
                display: flex;
                flex-direction: column;
                align-items: center;
                justify-content: center;
                color: var(--text-secondary);
                gap: 0.75rem;
                z-index: 1;
            }

            .photo-overlay i {
                font-size: 3.5rem;
                color: var(--mint-400);
            }

            .photo-preview-image {
                width: 100%;
                height: 100%;
                object-fit: cover;
                position: relative;
                z-index: 2;
            }

            .preview-status {
                margin-top: 0.75rem;
            }

            /* Signature Area */
            .ui-signature {
                border: 2px dashed var(--border-color);
                border-radius: var(--border-radius-md);
                background: rgba(255, 255, 255, 0.85);
                transition: var(--transition-base);
                backdrop-filter: blur(6px);
                margin-top: 0.75rem;
            }

            .ui-signature:hover {
                border-color: var(--primary-500);
                box-shadow: var(--neon-glow);
            }

            /* Premium Divider */
            .ui-divider {
                margin: 2rem 0;
                border: none;
                height: 1px;
                background: linear-gradient(90deg, transparent, var(--primary-400), transparent);
                opacity: 0.5;
            }

            /* Premium Button Group */
            .button-group-actions {
                display: flex;
                flex-wrap: wrap;
                gap: 1rem;
                margin-top: 2.5rem;
                justify-content: flex-end;
                align-items: center;
                width: 100%;
                padding-top: 1.5rem;
                border-top: 1px solid rgba(203, 213, 225, 0.3);
            }

            .button-group-left {
                display: flex;
                gap: 1rem;
                order: 2;
            }

            .button-group-right {
                display: flex;
                gap: 1rem;
                order: 1;
            }

            /* Button Group Animation */
            .button-group-actions > div {
                position: relative;
                transition: transform 0.4s ease, opacity 0.4s ease;
                opacity: 0.95;
            }

            .button-group-actions > div:hover {
                transform: translateY(-3px);
                opacity: 1;
                z-index: 2;
            }

            /* Button Spacing and Hover Effects */
            .button-group-actions .ui-button {
                margin: 0 0.3rem;
                transition: all 0.4s ease, box-shadow 0.4s ease;
                position: relative;
            }

            .button-group-actions .ui-button:hover {
                z-index: 3;
                box-shadow: 0 8px 20px rgba(15, 23, 42, 0.2) !important;
            }

            /* Primary Button Enhancements */
            .button-group-actions .ui-button-primary {
                min-width: 150px;
                font-weight: 700 !important;
                letter-spacing: 0.8px;
            }

            /* Secondary Button Enhancements */
            .button-group-actions .ui-button-secondary {
                background: white !important;
                color: var(--text-primary) !important;
                border: 1px solid var(--border-color) !important;
            }

            .button-group-actions .ui-button-secondary:hover {
                background: var(--surface-hover) !important;
                border-color: var(--primary-400) !important;
            }

            /* Responsive Adjustments */
            @media (max-width: 768px) {
                .form-grid {
                    grid-template-columns: 1fr;
                }

                .form-col-2 {
                    grid-column: span 1;
                }

                .ui-button {
                    width: 100%;
                    margin-bottom: 0.75rem;
                }

                .photo-preview-container {
                    width: 160px;
                    height: 160px;
                }

                .button-group-actions {
                    flex-direction: column-reverse;
                    gap: 0.75rem;
                }

                .button-group-left,
                .button-group-right {
                    width: 100%;
                    justify-content: center;
                }

                .button-group-left {
                    order: 1;
                    margin-top: 1.25rem;
                }

                .button-group-right {
                    order: 2;
                    flex-wrap: wrap;
                }

                .button-group-right .ui-button,
                .button-group-left .ui-button {
                    width: 100%;
                }

                .photo-upload-content {
                    grid-template-columns: 1fr;
                }

                .card {
                    margin: 1.25rem 0;
                    padding: 1.5rem;
                    border-radius: var(--border-radius-md);
                }

                .form-title {
                    font-size: 1.6rem;
                }

                .field-group.required-field:before {
                    left: -12px;
                    top: 12px;
                    width: 7px;
                    height: 7px;
                }
            }

            /* Premium Status Dialog */
            .ui-dialog.glass-dialog {
                background: rgba(255, 255, 255, 0.95);
                backdrop-filter: blur(12px);
                -webkit-backdrop-filter: blur(12px);
                border-radius: var(--border-radius-lg);
                border: var(--glass-border);
                box-shadow: var(--shadow-xl), var(--glass-shadow);
                border-top: 4px solid var(--primary-500);
            }

            /* Premium Viewer Dialog */
            .max-w-screen {
                max-width: 95vw !important;
                border-radius: var(--border-radius-lg) !important;
                overflow: hidden !important;
                border: var(--glass-border) !important;
                box-shadow: var(--shadow-xl), var(--glass-shadow) !important;
                backdrop-filter: blur(12px) !important;
                border-top: 4px solid var(--primary-500);
            }

            /* Additional fixes for PrimeFaces components */
            .ui-widget {
                font-family: 'Poppins', -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;
            }

            .ui-button-text-icon-left .ui-button-text {
                padding: 0.3em 0.6em 0.3em 2.2em !important;
            }

            .ui-button-text-icon-right .ui-button-text {
                padding: 0.3em 2.2em 0.3em 0.6em !important;
            }

            /* Premium File Upload Styling */
            .ui-fileupload-choose {
                background: var(--gradient-primary) !important;
                color: white !important;
                border-radius: var(--border-radius-pill) !important;
                padding: 0.75rem 1.75rem !important;
                border: none !important;
                height: 46px;
                font-weight: 600 !important;
                transition: var(--transition-base) !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.6rem !important;
                letter-spacing: 0.5px;
            }

            /* Premium Growl Notifications */
            .ui-growl {
                top: 25px !important;
                right: 25px !important;
            }

            .ui-growl-item-container {
                border-radius: var(--border-radius-md) !important;
                box-shadow: var(--shadow-xl) !important;
                backdrop-filter: blur(10px) !important;
                background: var(--surface-color) !important;
                border: var(--glass-border) !important;
                border-top: 3px solid var(--primary-500);
            }

            /* Input Error Styling */
            .ui-state-error {
                border-color: var(--error-color) !important;
                background: rgba(239, 68, 68, 0.08) !important;
            }

            .ui-message-error {
                color: var(--error-color) !important;
                font-size: 0.8rem !important;
                margin-top: 0.4rem !important;
                font-weight: 500;
            }

            /* Custom Scrollbar */
            ::-webkit-scrollbar {
                width: 10px;
                height: 10px;
            }

            ::-webkit-scrollbar-track {
                background: rgba(203, 213, 225, 0.1);
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb {
                background: linear-gradient(to bottom, var(--primary-400), var(--primary-600));
                border-radius: 10px;
            }

            ::-webkit-scrollbar-thumb:hover {
                background: linear-gradient(to bottom, var(--primary-500), var(--primary-700));
            }

            /* Premium File Uploader Styling */
            .modern-uploader .ui-fileupload-buttonbar {
                background: transparent !important;
                border: 2px dashed var(--border-color) !important;
                border-radius: var(--border-radius-md) !important;
                padding: 2rem !important;
                transition: var(--transition-base) !important;
                position: relative;
            }

            .modern-uploader .ui-fileupload-buttonbar:hover {
                border-color: var(--primary-500) !important;
                background: rgba(14, 165, 233, 0.08) !important;
                box-shadow: var(--neon-glow);
            }

            .modern-uploader .ui-fileupload-choose {
                background: var(--gradient-primary) !important;
                color: white !important;
                border-radius: var(--border-radius-pill) !important;
                padding: 0.75rem 1.75rem !important;
                border: none !important;
                height: 46px;
                font-weight: 600 !important;
                transition: var(--transition-base) !important;
                display: inline-flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.6rem !important;
            }

            .modern-uploader .ui-fileupload-content {
                border: none !important;
                padding: 0 !important;
                margin-top: 1.25rem !important;
            }

            .modern-uploader .ui-fileupload-row > div {
                display: flex !important;
                align-items: center !important;
                padding: 0.85rem !important;
                background: rgba(255, 255, 255, 0.9) !important;
                border-radius: var(--border-radius-sm) !important;
                margin-bottom: 0.6rem !important;
                border: 1px solid var(--border-color) !important;
                transition: var(--transition-base);
            }

            .modern-uploader .ui-fileupload-row > div:hover {
                background: var(--surface-hover) !important;
                transform: translateY(-3px);
                box-shadow: var(--shadow-sm) !important;
                border-color: var(--primary-300);
            }

            /* Drag and Drop Highlight */
            .modern-uploader .ui-fileupload-buttonbar.ui-state-highlight {
                border-color: var(--primary-500) !important;
                background: rgba(14, 165, 233, 0.15) !important;
                box-shadow: 0 0 0 3px rgba(14, 165, 233, 0.15) !important;
            }

            /* Default Avatar Image */
            .photo-preview-container img[src$="default-avatar.png"] {
                filter: sepia(0.3) opacity(0.8);
            }

            /* Section Titles */
            .section-title {
                font-size: 1.5rem;
                font-weight: 700;
                color: var(--primary-800);
                margin: 2rem 0 1.25rem;
                padding-bottom: 0.75rem;
                border-bottom: 1px solid rgba(203, 213, 225, 0.3);
                font-family: 'Playfair Display', serif;
                position: relative;
            }

            .section-title:after {
                content: "";
                position: absolute;
                bottom: -1px;
                left: 0;
                width: 60px;
                height: 2px;
                background: var(--gradient-primary);
                border-radius: 2px;
            }

            /* Approval Section Styling */
            .approval-section {
                border-top: 4px solid var(--purple-500);
                position: relative;
            }

            .approval-section:before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--gradient-purple);
            }

            /* Badge Styling */
            .ui-badge {
                border-radius: 12px !important;
                font-weight: 600 !important;
                font-size: 0.75rem !important;
                padding: 0.35rem 0.75rem !important;
            }

            .badge-lg {
                font-size: 0.85rem !important;
                padding: 0.5rem 1rem !important;
            }

            /* ==========================================================================
               تحسينات جديدة لقسم المرفقات (Attachments) - بالألوان الجديدة
               ========================================================================== */

            /* تصميم جديد ومحسّن لقسم المرفقات باللون البنفسجي */
            .attachments-section {
                margin-top: 2rem;
                padding: 1.5rem;
                background: linear-gradient(135deg, rgba(250, 245, 255, 0.95) 0%, rgba(243, 232, 255, 0.98) 100%);
                border-radius: var(--border-radius-lg);
                border: 1px solid rgba(168, 85, 247, 0.3);
                box-shadow: var(--shadow-md), 0 0 15px rgba(168, 85, 247, 0.1);
                position: relative;
                overflow: hidden;
                transition: var(--transition-base);
            }

            .attachments-section::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 4px;
                background: var(--gradient-purple);
                z-index: 1;
            }

            .attachments-section:hover {
                box-shadow: var(--shadow-lg), 0 0 20px rgba(168, 85, 247, 0.15);
                transform: translateY(-2px);
            }

            .attachments-header {
                display: flex;
                align-items: center;
                justify-content: space-between;
                margin-bottom: 1.5rem;
                padding-bottom: 0.75rem;
                border-bottom: 1px solid rgba(168, 85, 247, 0.2);
            }

            .attachments-title {
                display: flex;
                align-items: center;
                gap: 0.75rem;
            }

            .attachments-title i {
                color: var(--purple-500);
                font-size: 1.5rem;
                filter: drop-shadow(0 0 3px rgba(168, 85, 247, 0.5));
            }

            .attachments-title h4 {
                color: var(--purple-800);
                margin: 0;
                font-family: 'Playfair Display', serif;
                font-weight: 600;
                background: var(--gradient-purple);
                -webkit-background-clip: text;
                -webkit-text-fill-color: transparent;
                background-clip: text;
            }

            .attachments-count {
                background: var(--gradient-purple);
                color: white;
                border-radius: var(--border-radius-pill);
                padding: 0.35rem 0.75rem;
                font-size: 0.8rem;
                font-weight: 600;
                box-shadow: var(--shadow-sm);
            }

            .attachments-grid {
                display: grid;
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
                gap: 1.25rem;
                margin-top: 1rem;
            }

            .attachment-card {
                background: white;
                border-radius: var(--border-radius-lg);
                border: 1px solid rgba(168, 85, 247, 0.2);
                box-shadow: var(--shadow-sm);
                padding: 1.25rem;
                transition: var(--transition-base);
                position: relative;
                overflow: hidden;
                display: flex;
                flex-direction: column;
                gap: 0.75rem;
            }

            .attachment-card::before {
                content: '';
                position: absolute;
                top: 0;
                left: 0;
                right: 0;
                height: 3px;
                background: var(--gradient-purple);
                opacity: 0;
                transition: var(--transition-base);
            }

            .attachment-card:hover {
                transform: translateY(-5px);
                box-shadow: var(--shadow-lg), 0 5px 15px rgba(168, 85, 247, 0.2);
                border-color: var(--purple-300);
            }

            .attachment-card:hover::before {
                opacity: 1;
            }

            .attachment-header {
                display: flex;
                align-items: flex-start;
                gap: 0.75rem;
            }

            .attachment-icon {
                width: 48px;
                height: 48px;
                border-radius: var(--border-radius-md);
                background: linear-gradient(135deg, var(--purple-100), var(--purple-200));
                display: flex;
                align-items: center;
                justify-content: center;
                flex-shrink: 0;
                box-shadow: var(--shadow-sm);
                border: 1px solid var(--purple-200);
            }

            .attachment-icon i {
                font-size: 1.5rem;
                color: var(--purple-600);
            }

            .attachment-info {
                flex: 1;
                min-width: 0;
            }

            .attachment-code {
                font-size: 0.75rem;
                color: var(--purple-600);
                font-weight: 600;
                margin-bottom: 0.25rem;
                font-family: 'Poppins', sans-serif;
            }

            .attachment-name {
                font-weight: 600;
                color: var(--text-primary);
                margin-bottom: 0.25rem;
                font-size: 0.9rem;
                line-height: 1.3;
                overflow: hidden;
                text-overflow: ellipsis;
                display: -webkit-box;
                -webkit-line-clamp: 2;
                -webkit-box-orient: vertical;
            }

            .attachment-meta {
                display: flex;
                align-items: center;
                gap: 0.5rem;
                font-size: 0.75rem;
                color: var(--text-secondary);
            }

            .attachment-actions {
                display: flex;
                gap: 0.5rem;
                margin-top: auto;
                padding-top: 0.75rem;
                border-top: 1px solid rgba(168, 85, 247, 0.1);
            }

            .attachment-action-btn {
                flex: 1;
                padding: 0.5rem;
                border-radius: var(--border-radius-md);
                background: var(--surface-50);
                border: 1px solid var(--purple-100);
                color: var(--purple-700);
                font-size: 0.8rem;
                font-weight: 500;
                display: flex;
                align-items: center;
                justify-content: center;
                gap: 0.4rem;
                transition: var(--transition-base);
                text-decoration: none;
                cursor: pointer;
            }

            .attachment-action-btn:hover {
                background: var(--purple-50);
                color: var(--purple-800);
                border-color: var(--purple-300);
                transform: translateY(-2px);
                box-shadow: var(--shadow-sm);
            }

            .attachment-action-btn.download {
                background: var(--gradient-primary);
                color: white;
                border-color: var(--primary-500);
            }

            .attachment-action-btn.download:hover {
                background: linear-gradient(135deg, var(--primary-600), var(--primary-700));
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4);
            }

            .no-attachments {
                text-align: center;
                padding: 3rem 2rem;
                color: var(--text-secondary);
            }

            .no-attachments i {
                font-size: 3rem;
                color: var(--purple-300);
                margin-bottom: 1rem;
                display: block;
            }

            .no-attachments p {
                margin: 0;
                font-size: 1rem;
                font-family: 'Poppins', sans-serif;
            }

            /* تحسينات للزر Download All */
            .download-all-btn {
                background: var(--gradient-primary) !important;
                color: white !important;
                border: none !important;
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.3) !important;
                border-radius: var(--border-radius-pill) !important;
                padding: 0.65rem 1.5rem !important;
                font-weight: 600 !important;
                display: flex !important;
                align-items: center !important;
                gap: 0.5rem !important;
                transition: var(--transition-base) !important;
            }

            .download-all-btn:hover {
                background: linear-gradient(135deg, var(--primary-600), var(--primary-700)) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 6px 20px rgba(14, 165, 233, 0.4) !important;
            }

            .attachment-action-btn.delete {
                background: var(--gradient-danger) !important;
                color: white !important;
                border-color: var(--danger-500);
            }

            .attachment-action-btn.delete:hover {
                background: linear-gradient(135deg, var(--danger-600), var(--danger-700)) !important;
                border-color: var(--danger-600) !important;
                transform: translateY(-2px);
                box-shadow: 0 4px 12px rgba(239, 68, 68, 0.4);
            }

            /* تحسينات إضافية للأزرار */
            .attachment-action-btn {
                border-radius: var(--border-radius-pill) !important;
                font-weight: 600 !important;
                font-size: 0.8rem !important;
                padding: 0.5rem 1rem !important;
                transition: var(--transition-base) !important;
                text-decoration: none !important;
                display: flex !important;
                align-items: center !important;
                justify-content: center !important;
                gap: 0.4rem !important;
                min-height: 36px !important;
                border: 1px solid transparent !important;
            }

            .attachment-action-btn i {
                font-size: 0.9rem !important;
            }

            /* تأثيرات hover إضافية */
            .attachment-action-btn:hover {
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15) !important;
            }

            /* تخصيص زر Download */
            .attachment-action-btn.download {
                background: var(--gradient-primary) !important;
                color: white !important;
                border: 1px solid var(--primary-500) !important;
            }

            .attachment-action-btn.download:hover {
                background: linear-gradient(135deg, var(--primary-600), var(--primary-700)) !important;
                transform: translateY(-2px) !important;
                box-shadow: 0 4px 12px rgba(14, 165, 233, 0.4) !important;
            }

            /* تحسينات التجاوب */
            @media (max-width: 768px) {
                .attachments-grid {
                    grid-template-columns: 1fr;
                    gap: 1rem;
                }

                .attachments-header {
                    flex-direction: column;
                    align-items: flex-start;
                    gap: 1rem;
                }

                .attachment-card {
                    padding: 1rem;
                }

                .attachment-header {
                    flex-direction: column;
                    align-items: flex-start;
                }

                .attachment-icon {
                    align-self: flex-start;
                }
            }

            @media (max-width: 480px) {
                .attachments-section {
                    padding: 1rem;
                    margin: 1rem 0;
                }

                .attachment-actions {
                    flex-direction: column;
                }

                .attachment-action-btn {
                    width: 100%;
                }
            }
        </style>
    </ui:define>
    <ui:define name="section-content">
        <h:form id="form">
            <p:growl id="messages" showDetail="true" showSummary="false" sticky="true" life="5000" />

            <div class="card main-info-card">
                <div class="form-header">
                    <h3 class="form-title">Employee Certification Form</h3>
                    <div class="form-badge">
                        <p:badge value="#{empCertificationBean.empCertification.certNumber}"
                                 severity="info" styleClass="badge-lg" />
                    </div>
                </div>

                <div class="form-grid">
                    <!-- Certificate Info -->
                    <div class="field-group required-field">
                        <span class="floating-label required">Certificate Number</span>
                        <p:inputText value="#{empCertificationBean.empCertification.certNumber}"
                                     disabled="true" styleClass="block" />
                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">TS Number</span>
                        <p:inputText value="#{empCertificationBean.empCertification.tsNumber}"
                                     disabled="true" styleClass="block" />
                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">Issue Date</span>
                        <p:calendar disabled="#{empCertificationBean.disabled}"
                                    value="#{empCertificationBean.empCertification.issueDate}"
                                    styleClass="block" pattern="dd-MM-yyyy"
                                    showTime="false">
                            <f:convertDateTime pattern="dd-MM-yyyy" timeZone="UTC" />
                        </p:calendar>

                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">Expiry Date</span>
                        <p:calendar value="#{empCertificationBean.empCertification.expiryDate}" pattern="dd-MM-yyyy" showTime="false">
                            <f:convertDateTime pattern="dd-MM-yyyy" timeZone="UTC" />
                        </p:calendar>
                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">Company</span>
                        <p:selectOneMenu
                                style="width:100%;"
                                value="#{empCertificationBean.company}"
                                converter="omnifaces.SelectItemsIndexConverter">
                            <f:selectItem itemLabel="Select Company" itemValue="#{null}" />
                            <f:selectItems value="#{empCertificationBean.companies}"
                                           var="comp" itemLabel="#{comp.name}" itemValue="#{comp}" />
                        </p:selectOneMenu>
                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">Certification Type</span>
                        <p:selectOneMenu
                                style="width:100%;"
                                value="#{empCertificationBean.empCertificationType}"
                                converter="omnifaces.SelectItemsIndexConverter">
                            <f:selectItems
                                    value="#{empCertificationBean.empCertificationTypes}"
                                    var="type" itemLabel="#{type.certName}" itemValue="#{type}" />
                        </p:selectOneMenu>
                    </div>
                </div>

                <!-- Employee Details -->
                <h4 class="section-title">Employee Information</h4>

                <div class="form-grid">
                    <div class="field-group required-field">
                        <span class="floating-label required">Fullname</span>
                        <p:inputText
                                value="#{empCertificationBean.employee.fullName}"
                                styleClass="block" />
                    </div>

                    <div class="field-group required-field">
                        <span class="floating-label required">Id number</span>
                        <p:inputText
                                value="#{empCertificationBean.employee.idNumber}"
                                styleClass="block" />
                    </div>


                    <div class="field-group required-field">
                        <span class="floating-label required">Date of birth</span>
                        <p:calendar value="#{empCertificationBean.employee.dateOfBirth}" pattern="dd-MM-yyyy" showTime="false">
                            <f:convertDateTime pattern="dd-MM-yyyy" timeZone="UTC" />
                        </p:calendar>
                    </div>
                </div>

                <!-- Employee Photo Section - Premium Version باللون الأخضر الفاتح -->
                <div class="photo-upload-section photo-upload-card">
                    <div class="photo-upload-header">
                        <h4 class="photo-upload-title">
                            <i class="pi pi-image" style="margin-right: 8px;"></i>
                            Employee Photo
                        </h4>
                        <p:badge value="#{not empty empCertificationBean.employee.employeePhoto ? 'Uploaded' : 'Pending'}"
                                 severity="#{not empty empCertificationBean.employee.employeePhoto ? 'success' : 'warning'}" />
                    </div>

                    <div class="photo-upload-content">
                        <!-- Upload Controls -->
                        <div class="upload-controls">
                            <p:fileUpload id="photoUpload"

                                          mode="advanced"
                                          dragDropSupport="true"
                                          label="Choose Photo"
                                          uploadLabel="Upload"
                                          ReturnLabel="Return"
                                          chooseIcon="pi pi-camera"
                                          uploadIcon="pi pi-cloud-upload"
                                          ReturnIcon="pi pi-times"
                                          sequential="true"
                                          allowTypes="/(\.|\/)(jpg|jpeg|png|gif|bmp|webp)$/"
                                          fileLimit="1"
                                          multiple="false"
                                          process="@([id$=photoUpload])"

                                          listener="#{empCertificationBean.handlePhotoUpload}"
                                          update="photoPreview messages"
                                          styleClass="modern-uploader" />



                        </div>

                        <!-- Photo Preview -->
                        <div class="preview-container">
                            <h5 class="preview-title">
                                <i class="pi pi-eye" style="margin-right: 8px;"></i>
                                PHOTO PREVIEW
                            </h5>

                            <p:outputPanel id="photoPreview" styleClass="photo-preview-container">
                                <p:graphicImage  stream="false"
                                                 value="#{not empty empCertificationBean.employee.employeePhoto ?
                                            empCertificationBean.photoStreamedContent :
                                            '/resources/images/default-avatar.png'}"
                                                 width="180"
                                                 height="180"
                                                 styleClass="photo-preview-image" />

                                <p:outputPanel rendered="#{empty empCertificationBean.employee.employeePhoto}" styleClass="photo-overlay">
                                    <i class="pi pi-user"></i>
                                    <span>No Photo</span>
                                </p:outputPanel>
                            </p:outputPanel>

                            <div class="preview-status">
                                <p:badge value="#{not empty empCertificationBean.employee.employeePhoto ? 'Ready' : 'Pending'}"
                                         severity="#{not empty empCertificationBean.employee.employeePhoto ? 'success' : 'warning'}" />
                            </div>
                        </div>
                    </div>
                </div>

                <script>
                    function updatePhotoPreview() {
                        // Refresh the photo preview by updating the timestamp parameter
                        var photoElement = document.querySelector('#photoPreview img');
                        if(photoElement) {
                            var src = photoElement.src.split('?')[0];
                            var newTimestamp = new Date().getTime();
                            photoElement.src = src + '?t=' + newTimestamp;

                            // Hide the overlay if image is loaded
                            var overlay = document.querySelector('.photo-overlay');
                            if(overlay) {
                                overlay.style.display = 'none';
                            }
                        }

                        // Update the badge status
                        if(PF('messages')) {
                            PF('messages').renderMessage({
                                summary: "Photo Updated",
                                detail: "Employee photo has been successfully updated.",
                                severity: 'info'
                            });
                        }
                    }
                </script>

                <div class="card approval-section approval-card">
                    <div class="form-header">
                        <h4 class="form-title">
                            <i class="pi pi-check-circle" style="margin-right: 8px;"></i>
                            Approval Process
                        </h4>
                    </div>

                    <div class="form-grid">
                        <!-- Reviewer Engineer Field -->
                        <div class="field-group required-field form-col-2">
                            <span class="floating-label required">Reviewer Engineer</span>
                            <p:selectOneMenu id="selectoneMenu_UserAliasRecpient"
                                             rendered="#{!empCertificationBean.disabled}"
                                             style="width:100%;"
                                             filter="true"
                                             filterMatchMode="contains"
                                             widgetVar="widgetVar_SelectOneMenu"
                                             converter="omnifaces.SelectItemsIndexConverter"
                                             value="#{empCertificationBean.selectedUserAliasRecipient}"
                                             required="true"
                                             requiredMessage="Please select a reviewer engineer">
                                <f:selectItem itemLabel="Select Reviewer Engineer" itemValue="#{null}" />
                                <f:selectItems
                                        itemLabel="(#{userAlias.userCode}) #{userAlias.sysUserBySysUser.displayName} / #{userAlias.organizationByOrganization.name} / #{userAlias.jobPosition.name}"
                                        itemValue="#{userAlias}"
                                        var="userAlias"
                                        value="#{empCertificationBean.userAliasRecipientList}" />

                            </p:selectOneMenu>
                            <p:message for="selectoneMenu_UserAliasRecpient" display="icon" />
                        </div>

                        <!-- Approval Comments Field -->
                        <div class="field-group required-field form-col-2">
                            <span class="floating-label required">Approval Comments</span>
                            <p:inputTextarea id="approvalComment"
                                             value="#{empCertificationBean.comment}"
                                             rows="3"
                                             styleClass="block"
                                             style="width:100%;"
                                             required="true"
                                             requiredMessage="Approval comments are required"
                                             placeholder="Enter your approval comments here..."/>
                            <p:message for="approvalComment" display="icon" />
                        </div>
                    </div>

                    <p:divider />

                    <div class="form-grid">
                        <!-- Inspection By Section -->
                        <div class="#{empCertificationBean.disabled ? 'field-group' : 'field-group form-col-2'}">
                            <h:outputLabel value="Inspection By"
                                           rendered="#{empCertificationBean.disabled}"
                                           styleClass="smat-label" />
                            <p:inputText disabled="true"
                                         rendered="#{empCertificationBean.disabled}"
                                         value="#{empCertificationBean.empCertification.sysUserByInspectedBy.displayName}"
                                         style="font-weight:600;color:var(--success-color);font-size: 1.1rem;" />

                        </div>

                        <!-- Reviewer Section -->
                        <div class="#{empCertificationBean.disabled ? 'field-group' : 'field-group form-col-2'}">
                            <h:outputLabel
                                    value="#{empCertificationBean.disabled ? interfaceLabel.reviewerEngineer : interfaceLabel.inspectionEngineer}"
                                    styleClass="smat-label" />
                            <p:inputText disabled="true"
                                         value="#{loginBean.user.displayName}"
                                         style="font-weight:600;color:var(--success-color);font-size: 1.1rem;" />
                        </div>
                    </div>

                    <!-- Attachments section - باللون البنفسحي الجديد -->
                    <h:panelGroup id="emp_attachments_section" layout="block" styleClass="attachments-section">
                        <div class="attachments-header">
                            <div class="attachments-title">
                                <i class="pi pi-paperclip"></i>
                                <h4>Attachments</h4>
                                <span class="attachments-count">
                                    #{not empty empCertificationBean.attachmentFiles ? empCertificationBean.attachmentFiles.size() : 0} Files
                                </span>
                            </div>
                            <p:commandButton value="Download All" icon="pi pi-download" type="button"
                                             onclick="(function(){
                                                 var container=document.getElementById('emp_attachments_list');
                                                 if(!container) return; var ids=[]; container.querySelectorAll('[data-file-id]').forEach(function(el){ ids.push(el.getAttribute('data-file-id')); });
                                                 if(ids.length==0){ alert('No attachments to download'); return; }
                                                 window.open('#{request.contextPath}/attachments/zipByIds?ids=' + encodeURIComponent(ids.join(',')),'_blank');
                                             })();"
                                             styleClass="download-all-btn"
                                             rendered="#{not empty empCertificationBean.attachmentFiles}" />
                        </div>

                        <!-- Upload Section -->
                        <div class="field">
                            <p:fileUpload id="attachmentsUpload"
                                          mode="advanced"
                                          multiple="true"
                                          dragDropSupport="true"
                                          allowTypes="/(\.|\/)(pdf|jpg|jpeg|png|gif|doc|docx|xls|xlsx|txt)$/"
                                          auto="true"
                                          update=":form:messages :form:emp_attachments_section"
                                          listener="#{empCertificationBean.handleAttachmentUpload}"
                                          label="Choose Files"
                                          uploadLabel="Upload"
                                          cancelLabel="Cancel"
                                          style="width: 100%;" />
                        </div>

                        <!-- Attachments Grid - التصميم الجديد -->
                        <h:panelGroup id="emp_attachments_wrapper" rendered="#{not empty empCertificationBean.attachmentFiles}">
                            <div class="attachments-grid" id="emp_attachments_list">
                                <c:forEach items="#{empCertificationBean.attachmentFiles}" var="archiveDocumentFile" varStatus="loop">
                                    <div class="attachment-card" data-file-id="#{archiveDocumentFile.id}">
                                        <div class="attachment-header">
                                            <div class="attachment-icon">
                                                <i class="pi pi-file"></i>
                                            </div>
                                            <div class="attachment-info">
                                                <div class="attachment-code">[#{archiveDocumentFile.code}]</div>
                                                <div class="attachment-name" title="#{archiveDocumentFile.name}">
                                                    #{archiveDocumentFile.name}
                                                </div>
                                                <div class="attachment-meta">
                                                    <i class="pi pi-calendar"></i>
                                                    <span>Uploaded</span>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="attachment-actions">
                                            <h:outputLink value="#{request.contextPath}/attachments/raw?archDocFileId=#{archiveDocumentFile.id}"
                                                          class="attachment-action-btn download"
                                                          target="_blank"
                                                          title="Download #{archiveDocumentFile.name}">
                                                <i class="pi pi-download"></i>
                                                Download
                                            </h:outputLink>
                                            <p:commandButton styleClass="attachment-action-btn delete"
                                                             icon="pi pi-trash"
                                                             value="Delete"
                                                             title="Delete #{archiveDocumentFile.name}"
                                                             action="#{empCertificationBean.deleteAttachment(archiveDocumentFile.id)}"
                                                             process="@this"
                                                             update=":form:emp_attachments_section :form:messages"
                                                             onclick="if (!confirm('Are you sure you want to delete this attachment?')) return false;" />
                                        </div>
                                    </div>
                                </c:forEach>
                            </div>
                        </h:panelGroup>

                        <!-- Empty State -->
                        <h:panelGroup id="emp_empty_attachments" rendered="#{empty empCertificationBean.attachmentFiles}">
                            <div class="no-attachments">
                                <i class="pi pi-inbox"></i>
                                <p>No attachments uploaded yet</p>
                                <p style="font-size: 0.9rem; margin-top: 0.5rem; color: var(--text-secondary);">
                                    Upload files using the button above
                                </p>
                            </div>
                        </h:panelGroup>
                    </h:panelGroup>

                    <!-- Action Buttons - Reordered for RTL -->
                    <div class="button-group-actions">
                        <!-- Right Side Group (now on left) -->
                        <div class="button-group-right">
                            <!-- Save/Approve Button -->
                            <div>
                                <p:commandButton id="commandButton_save"
                                                 value="#{empCertificationBean.disabled ? 'Approve' : 'Save'}"
                                                 icon="#{empCertificationBean.disabled ? 'pi pi-check-circle' : 'pi pi-save'}"
                                                 pt:data-tooltip="#{empCertificationBean.disabled ? 'Approve' : 'Save'}"
                                                 process="@form"
                                                 action="#{empCertificationBean.doSave}"
                                                 update="@form"
                                                 disabled="#{empCertificationBean.step eq '03'}"
                                                 styleClass="ui-button-primary">
                                </p:commandButton>
                            </div>

                            <!-- Print Button -->
                            <div style="#{empCertificationBean.step eq '03' ? 'display:block;' : 'display:none;'}">
                                <p:commandButton id="commandButton_print"
                                                 action="#{empCertificationBean.doPrint()}"
                                                 value="Print"
                                                 icon="pi pi-print"
                                                 pt:data-tooltip="Print"
                                                 onclick="windows.open('_blank')"
                                                 styleClass="ui-button-purple">
                                </p:commandButton>
                            </div>

                            <!-- download attachment Button -->
                            <div style="#{empCertificationBean.step eq '03' ? 'display:block;' : 'display:none;'}">
                                <p:commandButton id="commandButton_download"
                                                 action="#{empCertificationBean.downloadAttach()}"
                                                 value="download attachments"
                                                 icon="pi pi-print"
                                                 pt:data-tooltip="Print"
                                                 onclick="window.open('#{request.contextPath}/attachments/zip?type=emp&amp;certNo=' + encodeURIComponent('#{empCertificationBean.empCertification.certNumber}'))"
                                                 styleClass="ui-button-mint">
                                </p:commandButton>
                            </div>
                            <!-- Return Button -->

                            <p:button id="commandButton_return_main"
                                      value="Return"
                                      icon="pi pi-arrow-left"
                                      pt:data-tooltip="Return"
                                      styleClass="ui-button-secondary"
                                      outcome="pretty:inspection/my-tasks" />

                        </div>

                        <!-- Left Side Group (now on right) -->
                        <div class="button-group-left">
                            <!-- Return to Issuer Button -->
                            <div style="#{empCertificationBean.disabled and empCertificationBean.step ne '03' ? 'display:block;' : 'display:none;'}">
                                <p:commandButton id="commandButton_return"
                                                 value="Return to Inspector"
                                                 icon="pi pi-undo"
                                                 pt:data-tooltip="Return to Inspector"
                                                 process="@form"
                                                 update="@([id$=messages])"
                                                 action="#{empCertificationBean.returnToIssuer}"
                                                 styleClass="ui-button-hazel">
                                </p:commandButton>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </h:form>
    </ui:define>

    <ui:define name="section-dialogs">
        <p:dialog modal="true" widgetVar="statusDialog"
                  header="#{interfaceLabel.processing}" draggable="false"
                  closable="false" resizable="false" styleClass="glass-dialog">
            <div style="text-align: center; padding: 2.5rem;">
                <i class="pi pi-spinner pi-spin" style="font-size: 3.5rem; color: var(--primary-500);"></i>
                <p style="margin-top: 1.75rem; color: var(--text-primary); font-weight: 600; font-size: 1.1rem;">Processing your request...</p>
                <p style="color: var(--text-secondary); font-size: 0.9rem;">Please wait while we complete your action</p>
            </div>
        </p:dialog>
        <p:dialog header="#{interfaceLabel.viewer}" showEffect="fade"
                  widgetVar="viewerWidgetVar" closable="true" blockScroll="true"
                  dynamic="true" cache="true" fitViewport="true" showHeader="true"
                  contentWidth="100%" contentHeight="100%" resizeObserver="true"
                  resizeObserverCenter="true" styleClass="max-w-screen"
                  iframeStyleClass="max-w-screen" responsive="true" width="92%"
                  height="100%" maximizable="true" minimizable="true">
            <h:form id="form_viewer">
                <p:outputPanel id="manage-viewer-content" class="ui-fluid"
                               layout="inline" style="width:100%;height:100%">
                    <p:scrollPanel
                            style="border:1px solid var(--border-color);width: auto; height:100%"
                            styleClass="" mode="native">
                        <pe:documentViewer id="documentViewer_pdf" height="550"
                                           zoom="page-width" rendered="true"
                                           value="#{certificateViewerBean.file}"></pe:documentViewer>
                    </p:scrollPanel>
                </p:outputPanel>
            </h:form>
        </p:dialog>
    </ui:define>
</ui:composition>