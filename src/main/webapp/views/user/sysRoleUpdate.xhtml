<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:p="http://primefaces.org/ui"
                template="/WEB-INF/template.xhtml">

    <ui:define name="section-head">
        #{interfaceLabel.roleUpdate}
    </ui:define>

    <ui:define name="section-content">
        <h:form id="form_updateSysRole" prependId="true">
            <!-- Growl / Messages -->
            <p:growl id="messages" showDetail="true" life="4000" sticky="false" />

            <!-- Toolbar (Top actions) -->
            <p:toolbar style="margin-bottom:1rem;">
                <p:toolbarGroup align="left">
                    <p:commandButton id="btnBack" value="#{interfaceLabel.back}" icon="pi pi-undo"
                                     styleClass="ui-button-secondary"
                                     action="pretty:roles"
                                     title="#{interfaceLabel.back}" />
                </p:toolbarGroup>

                <p:toolbarGroup align="right">
                    <p:commandButton id="btnUpdateTop" value="#{interfaceLabel.update}"
                                     icon="pi pi-check" styleClass="ui-button-success"
                                     action="#{sysRoleBean.update()}" ajax="true"
                                     update=":form_updateSysRole:messages :form_updateSysRole:rolePermission_datatable" />
                </p:toolbarGroup>
            </p:toolbar>

            <!-- Main card -->
            <div class="card crud-demo">

                <p:panel header="#{interfaceLabel.roleUpdate}" styleClass="ui-panel-header-1" toggleable="false">

                    <!-- Role basic info -->
                    <h:panelGrid columns="2" columnClasses="ui-grid-col-4,ui-grid-col-8"
                                 cellpadding="6" style="width:100%;" layout="grid">
                        <h:outputLabel for="roleName" value="#{interfaceLabel.name}" />
                        <p:inputText id="roleName" value="#{sysRoleBean.sysRole.name}" required="true"
                                     requiredMessage="#{interfaceLabel.name} #{interfaceLabel.isRequired}">
                            <f:ajax render=":form_updateSysRole:messages" />
                        </p:inputText>

                        <h:outputLabel for="roleCode" value="#{interfaceLabel.code}" />
                        <p:inputText id="roleCode" value="#{sysRoleBean.sysRole.code}" required="true"
                                     requiredMessage="#{interfaceLabel.code} #{interfaceLabel.isRequired}">
                            <f:ajax render=":form_updateSysRole:messages" />
                        </p:inputText>

                        <h:outputLabel for="roleDesc" value="#{interfaceLabel.description}" />
                        <p:inputTextarea id="roleDesc" value="#{sysRoleBean.sysRole.description}"
                                         rows="4" autoResize="false" />
                    </h:panelGrid>

                    <!-- Actions under form -->
                    <p:separator />

                    <p:panelGrid columns="3" columnClasses="ui-grid-col-3,ui-grid-col-6,ui-grid-col-3"
                                 style="width:100%; margin-top:0.5rem;" layout="grid">
                        <p:column>
                            <p:commandButton id="btnUpdate" value="#{interfaceLabel.update}"
                                             icon="pi pi-check" styleClass="ui-button-success"
                                             action="#{sysRoleBean.update()}" ajax="true"
                                             update=":form_updateSysRole:messages :form_updateSysRole:rolePermission_datatable" />
                        </p:column>

                        <p:column style="text-align:center;">
                            <!-- placeholder for spacing or future buttons -->
                        </p:column>

                        <p:column style="text-align:right;">
                            <p:commandButton id="btnAddPermissionTop" value="#{interfaceLabel.addPermission}"
                                             icon="pi pi-plus" styleClass="ui-button-primary"
                                             action="#{sysRoleBean.getPermissionSourceList()}"
                                             update=":form_updateSysRole:permissions_datatable"
                                             oncomplete="PF('manageSysPermessionDialog').show()" process="@this" />
                        </p:column>
                    </p:panelGrid>
                </p:panel>

                <!-- Permissions granted section -->
                <p:panel header="#{interfaceLabel.permissionsGrantedGroup}" style="margin-top:1rem;">
                    <p:dataTable id="rolePermission_datatable" var="rolePermissionVar"
                                 value="#{sysRoleBean.rolePermissionList}"
                                 paginator="true" rows="8" paginatorPosition="bottom"
                                 emptyMessage="#{interfaceLabel.noRecordsFound}"
                                 styleClass="p-datatable-sm" responsiveLayout="scroll">

                        <p:column headerText="#{interfaceLabel.permission}">
                            <h:outputText value="#{rolePermissionVar.sysPermission.name}" />
                        </p:column>

                        <p:column headerText="#{interfaceLabel.actions}" style="width:120px;text-align:center;">
                            <p:commandButton id="deletePermBtn" styleClass="ui-button-danger"
                                             icon="pi pi-trash" ajax="true"
                                             action="#{sysRoleBean.deletePermission(rolePermissionVar)}"
                                             update=":form_updateSysRole:rolePermission_datatable :form_updateSysRole:messages"
                                             title="#{interfaceLabel.delete}">
                            </p:commandButton>
                        </p:column>
                    </p:dataTable>

                    <!-- Add permission floating action -->
                    <p:row>
                        <p:column>
                            <p:commandButton id="openPermDialog" value="#{interfaceLabel.addPermission}"
                                             icon="pi pi-plus" styleClass="ui-button-success"
                                             action="#{sysRoleBean.getPermissionSourceList()}"
                                             update=":form_updateSysRole:permissions_datatable"
                                             oncomplete="PF('manageSysPermessionDialog').show()" process="@this" />
                        </p:column>
                    </p:row>
                </p:panel>

                <!-- Permissions dialog -->
                <p:dialog id="dlgPermissions" header="#{interfaceLabel.permissions}" widgetVar="manageSysPermessionDialog"
                          modal="true" resizable="false" width="620" appendTo="@(body)">
                    <p:outputPanel id="sysPermession-content" class="ui-fluid">
                        <p:dataTable id="permissions_datatable" var="permissionVar"
                                     value="#{sysRoleBean.permissionsSource}"
                                     emptyMessage="#{interfaceLabel.noRecordsFound}"
                                     paginator="true" rows="8" paginatorPosition="bottom"
                                     selection="#{sysRoleBean.permissionsTarget}"
                                     rowKey="#{permissionVar.id}"
                                     responsiveLayout="scroll">

                            <p:column selectionMode="multiple" headerText="#{interfaceLabel.select}" style="width:60px" />

                            <p:column headerText="#{interfaceLabel.permission}">
                                <h:outputText value="#{permissionVar.name}" />
                            </p:column>

                            <p:column headerText="#{interfaceLabel.description}">
                                <h:outputText value="#{permissionVar.description}" />
                            </p:column>

                        </p:dataTable>
                    </p:outputPanel>

                    <f:facet name="footer">
                        <p:commandButton value="#{interfaceLabel.addPermission}"
                                         icon="pi pi-check" styleClass="ui-button-success"
                                         action="#{sysRoleBean.addPermission()}"
                                         update=":form_updateSysRole:rolePermission_datatable :form_updateSysRole:messages"
                                         oncomplete="PF('manageSysPermessionDialog').hide()" />
                        <p:commandButton value="#{interfaceLabel.cancel}" icon="pi pi-times"
                                         onclick="PF('manageSysPermessionDialog').hide(); return false;"
                                         styleClass="ui-button-secondary" />
                    </f:facet>
                </p:dialog>

            </div> <!-- end card -->
        </h:form>
    </ui:define>
</ui:composition>
